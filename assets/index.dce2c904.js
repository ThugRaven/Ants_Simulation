var Ve=Object.defineProperty;var Xe=(i,t,e)=>t in i?Ve(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var r=(i,t,e)=>(Xe(i,typeof t!="symbol"?t+"":t,e),e);const Ke=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function e(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerpolicy&&(n.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?n.credentials="include":o.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(o){if(o.ep)return;o.ep=!0;const n=e(o);fetch(o.href,n)}};Ke();const le={WIDTH:1600*3,HEIGHT:1200*3},te={FILL_RATIO:.47,BORDER_SIZE:1};var ut=(i=>(i[i.TO_HOME=0]="TO_HOME",i[i.TO_FOOD=1]="TO_FOOD",i))(ut||{});const he={TO_HOME:[255,0,0],TO_FOOD:[43,255,0]},g={WIDTH:16,HEIGHT:16,SIZE:16},ce=2e-4,z={COLONY_RADIUS:50,COLONY_STARTING_ANTS:50,COLONY_MAX_ANTS:5e3,COLONY_MAX_FOOD:3e4,ANT_CREATION_PERIOD:.15,ANT_COST:30,ANT_REFILL_FOOD_AMOUNT:.25};var f=(i=>(i[i.TO_HOME=0]="TO_HOME",i[i.TO_FOOD=1]="TO_FOOD",i[i.REFILL=2]="REFILL",i))(f||{});const a={IMG_WIDTH:24,IMG_HEIGHT:34,WANDER_DISPLACE_RANGE:.5,WANDER_POINT_MAGNITUDE:100,WANDER_POINT_RADIUS:50,PERCEPTION_RADIUS:80,PERCEPTION_START_ANGLE:7/6*Math.PI,PERCEPTION_END_ANGLE:11/6*Math.PI,PERCEPTION_POINTS_HORIZONTAL:8,PERCEPTION_POINTS_VERTICAL:5,DIRECTION_PERIOD:.1,MARKER_PERIOD:.15,MARKER_DEFAULT_INTENSITY:1,AUTONOMY_MAX:300,AUTONOMY_REFILL:150,FOOD_SIZE:16},Ht=.005,T={SIZE:15,PICK_AMOUNT:2},zt=2,je=4,Ct=g.SIZE,et={MIN_SIZE:1,MAX_SIZE:75,STEP:1};function A(i,t,e,s,o=!0,n=!1){i.beginPath(),i.arc(t,e,s,0,Math.PI*2),o&&i.fill(),n&&i.stroke()}function ct(i,t,e,s,o){i.beginPath(),i.moveTo(t,e),i.lineTo(s,o),i.stroke(),i.closePath()}function Je(i,t,e,s,o){i.rect(t,e,s,o),i.fill()}function ft(i,t){return Math.random()*(t-i)+i}function b(i,t,e){return i=!i,i?(t.style.display="block",e==null||e.classList.add("border-green-500"),e==null||e.classList.remove("border-red-500")):(t.style.display="none",e==null||e.classList.add("border-red-500"),e==null||e.classList.remove("border-green-500")),i}function pt(i,t){return i=!i,i?(t.classList.add("border-green-500"),t.classList.remove("border-red-500")):(t.classList.add("border-red-500"),t.classList.remove("border-green-500")),i}class Z{constructor(t,e,s){r(this,"x");r(this,"y");r(this,"z");this.x=t||0,this.y=e||0,this.z=s||0}set(t,e,s){return t instanceof Z?(this.x=t.x||0,this.y=t.y||0,this.z=t.z||0,this):t instanceof Array?(this.x=t[0]||0,this.y=t[1]||0,this.z=t[2]||0,this):(this.x=t||0,this.y=e||0,this.z=s||0,this)}copy(){return new Z(this.x,this.y,this.z)}add(t,e,s){return t instanceof Z?(this.x+=t.x||0,this.y+=t.y||0,this.z+=t.z||0,this):t instanceof Array?(this.x+=t[0]||0,this.y+=t[1]||0,this.z+=t[2]||0,this):(this.x+=t||0,this.y+=e||0,this.z+=s||0,this)}sub(t,e,s){return t instanceof Z?(this.x-=t.x||0,this.y-=t.y||0,this.z-=t.z||0,this):t instanceof Array?(this.x-=t[0]||0,this.y-=t[1]||0,this.z-=t[2]||0,this):(this.x-=t||0,this.y-=e||0,this.z-=s||0,this)}mult(t,e,s){if(t instanceof Z)return Number.isFinite(t.x)&&Number.isFinite(t.y)&&Number.isFinite(t.z)&&typeof t.x=="number"&&typeof t.y=="number"&&typeof t.z=="number"?(this.x*=t.x,this.y*=t.y,this.z*=t.z):console.warn("Vector.mult:","x contains components that are either undefined or not finite numbers"),this;if(t instanceof Array)return t.every(n=>Number.isFinite(n))&&t.every(n=>typeof n=="number")?t.length===1?(this.x*=t[0],this.y*=t[0],this.z*=t[0]):t.length===2?(this.x*=t[0],this.y*=t[1]):t.length===3&&(this.x*=t[0],this.y*=t[1],this.z*=t[2]):console.warn("Vector.mult:","x contains elements that are either undefined or not finite numbers"),this;const o=[...arguments];return o.every(n=>Number.isFinite(n))&&o.every(n=>typeof n=="number")?(arguments.length===1&&(this.x*=t,this.y*=t,this.z*=t),arguments.length===2&&(this.x*=t,this.y*=e||0),arguments.length===3&&(this.x*=t,this.y*=e||0,this.z*=s||0)):console.warn("Vector.mult:","x, y, or z arguments are either undefined or not a finite number"),this}div(t,e,s){if(t instanceof Z){if(Number.isFinite(t.x)&&Number.isFinite(t.y)&&Number.isFinite(t.z)&&typeof t.x=="number"&&typeof t.y=="number"&&typeof t.z=="number"){if(t.x===0||t.y===0||t.z===0)return console.warn("Vector.div:","divide by 0"),this;this.x/=t.x,this.y/=t.y,this.z/=t.z}else console.warn("Vector.div:","x contains components that are either undefined or not finite numbers");return this}if(t instanceof Array){if(t.every(n=>Number.isFinite(n))&&t.every(n=>typeof n=="number")){if(t.some(n=>n===0))return console.warn("Vector.div:","divide by 0"),this;t.length===1?(this.x/=t[0],this.y/=t[0],this.z/=t[0]):t.length===2?(this.x/=t[0],this.y/=t[1]):t.length===3&&(this.x/=t[0],this.y/=t[1],this.z/=t[2])}else console.warn("Vector.div:","x contains components that are either undefined or not finite numbers");return this}const o=[...arguments];if(o.every(n=>Number.isFinite(n))&&o.every(n=>typeof n=="number")){if(o.some(n=>n===0))return console.warn("Vector.div:","divide by 0"),this;arguments.length===1&&(this.x/=t,this.y/=t,this.z/=t),arguments.length===2&&(this.x/=t,this.y/=e||0),arguments.length===3&&(this.x/=t,this.y/=e||0,this.z/=s||0)}else console.warn("Vector.div:","x, y, or z arguments are either undefined or not a finite number");return this}mag(){return Math.sqrt(this.magSq())}magSq(){const t=this.x,e=this.y,s=this.z;return t*t+e*e+s*s}dist(t){return t.copy().sub(this).mag()}normalize(){const t=this.mag();return t!==0&&(this.x*=1/t,this.y*=1/t,this.z*=1/t),this}limit(t){const e=this.magSq();return e>t*t&&(this.x/=Math.sqrt(e),this.y/=Math.sqrt(e),this.z/=Math.sqrt(e),this.x*=t,this.y*=t,this.z*=t),this}setMag(t){const e=this.normalize();return e.x*=t,e.y*=t,e.z*=t,e}heading(){return Math.atan2(this.y,this.x)}setHeading(t){let e=this.mag();return this.x=e*Math.cos(t),this.y=e*Math.sin(t),this}rotate(t){let e=this.heading()+t;const s=this.mag();return this.x=Math.cos(e)*s,this.y=Math.sin(e)*s,this}equals(t,e,s){let o,n,l;return t instanceof Z?(o=t.x||0,n=t.y||0,l=t.z||0):t instanceof Array?(o=t[0]||0,n=t[1]||0,l=t[2]||0):(o=t||0,n=e||0,l=s||0),this.x===o&&this.y===n&&this.z===l}}function st(i,t,e){return new Z(i,t,e)}class de{constructor(t,e,s,o,n){r(this,"ctx");r(this,"antImageInstance");r(this,"antFoodImageInstance");r(this,"antIcon");r(this,"id");r(this,"pos");r(this,"vel");r(this,"acc");r(this,"maxSpeed");r(this,"maxForce");r(this,"state");r(this,"debug");r(this,"wanderTheta");r(this,"perceptionDraw");r(this,"internalClock");r(this,"markerClock");r(this,"directionClock");r(this,"isDead");r(this,"freedomCoef");r(this,"foodAmount");r(this,"maxAutonomy");this.ctx=t,this.antImageInstance=e,this.antFoodImageInstance=s,this.antIcon=o,this.id=n.id,this.pos=st(n.pos.x,n.pos.y),this.vel=st(0,0),this.acc=st(0,0),this.maxSpeed=3,this.maxForce=.25,this.state=f.TO_FOOD,this.debug=n.debug||!1,this.wanderTheta=ft(0,Math.PI*2),this.perceptionDraw=new Set,this.internalClock=0,this.markerClock=ft(0,a.MARKER_PERIOD),this.directionClock=0,this.isDead=!1,this.freedomCoef=ft(.01,.1),this.foodAmount=0,this.maxAutonomy=a.AUTONOMY_MAX-ft(0,50)}seek(t){this.debug&&(this.ctx.strokeStyle="white",ct(this.ctx,t.x,t.y,this.pos.x,this.pos.y));const e=t.copy().sub(this.pos);e.setMag(this.maxSpeed),e.sub(this.vel),e.limit(this.maxForce),this.applyForce(e)}wander(){const t=this.vel.copy();t.setMag(a.WANDER_POINT_MAGNITUDE),t.add(this.pos);const e=a.WANDER_POINT_RADIUS;this.debug&&(this.ctx.fillStyle="red",A(this.ctx,t.x,t.y,4),this.ctx.strokeStyle="white",A(this.ctx,t.x,t.y,e,!1,!0),ct(this.ctx,this.pos.x,this.pos.y,t.x,t.y));const s=this.wanderTheta+this.vel.heading(),o=e*Math.cos(s),n=e*Math.sin(s);t.add(o,n),this.debug&&(this.ctx.fillStyle="green",A(this.ctx,t.x,t.y,8),ct(this.ctx,this.pos.x,this.pos.y,t.x,t.y));const l=t.sub(this.pos);l.setMag(this.maxForce),l.limit(this.maxForce),this.applyForce(l);const d=a.WANDER_DISPLACE_RANGE;this.wanderTheta+=ft(-d,d)}applyForce(t){this.acc.add(t)}update(t){this.internalClock+=t,this.directionClock+=t,this.internalClock>=a.AUTONOMY_REFILL&&this.state===f.TO_FOOD&&(this.state=f.REFILL),this.internalClock>=this.maxAutonomy&&(this.isDead=!0),this.vel.add(this.acc),this.vel.limit(this.maxSpeed),this.pos.add(this.vel),this.acc.set(0,0)}draw(){this.ctx.translate(this.pos.x,this.pos.y),this.ctx.rotate(this.vel.heading()+Math.PI/2);const t=-a.IMG_WIDTH/2,e=-a.IMG_HEIGHT/2;if(this.state===f.TO_HOME&&this.ctx.drawImage(this.antFoodImageInstance,-a.FOOD_SIZE/2,e-a.FOOD_SIZE/2),this.ctx.drawImage(this.antImageInstance,t,e),this.debug){this.ctx.strokeStyle="#FF0000",this.ctx.lineWidth=2,this.ctx.strokeRect(t,e,a.IMG_WIDTH,a.IMG_HEIGHT),this.ctx.fillStyle="red",A(this.ctx,0,0,4),this.ctx.beginPath(),this.ctx.arc(0,0,a.PERCEPTION_RADIUS,a.PERCEPTION_START_ANGLE,a.PERCEPTION_END_ANGLE),this.ctx.stroke(),this.ctx.strokeStyle="white",this.ctx.beginPath(),this.ctx.arc(0,0,a.PERCEPTION_RADIUS,a.PERCEPTION_END_ANGLE,a.PERCEPTION_START_ANGLE),this.ctx.stroke();const s=a.PERCEPTION_START_ANGLE,o=a.PERCEPTION_END_ANGLE,n=a.PERCEPTION_RADIUS*Math.cos(s),l=a.PERCEPTION_RADIUS*Math.sin(s),d=a.PERCEPTION_RADIUS*Math.cos(o),u=a.PERCEPTION_RADIUS*Math.sin(o);this.ctx.strokeStyle="red",ct(this.ctx,0,0,n,l),ct(this.ctx,0,0,d,u);const I=(a.PERCEPTION_END_ANGLE-a.PERCEPTION_START_ANGLE)/(a.PERCEPTION_POINTS_HORIZONTAL-1),R=a.PERCEPTION_RADIUS/a.PERCEPTION_POINTS_VERTICAL;for(let C=0;C<a.PERCEPTION_POINTS_HORIZONTAL;C++)for(let p=1;p<=a.PERCEPTION_POINTS_VERTICAL;p++){const L=I*C+a.PERCEPTION_START_ANGLE,O=R*p*Math.cos(L),j=R*p*Math.sin(L);this.perceptionDraw.has(p*a.PERCEPTION_POINTS_VERTICAL+C)?(this.ctx.strokeStyle="white",this.ctx.fillStyle="white"):(this.ctx.strokeStyle="red",this.ctx.fillStyle="green"),A(this.ctx,O,j,4),p===a.PERCEPTION_POINTS_VERTICAL&&ct(this.ctx,0,0,O,j)}}this.debug&&(this.ctx.fillStyle="white",A(this.ctx,this.pos.x,this.pos.y,3)),this.ctx.resetTransform()}search(t,e){this.debug&&(this.perceptionDraw=new Set);const s=this.vel.copy();s.setMag(a.IMG_HEIGHT/2),s.add(this.pos);const o=t.getCellFromCoordsSafe(s.x,s.y),n=t.getCellFromCoordsSafe(this.pos.x,this.pos.y);if(n==null||n.addDensity(this.state===f.TO_HOME,this.state===f.REFILL),o&&o.food.quantity>0&&(this.state===f.TO_FOOD||this.state===f.REFILL)){this.state=f.TO_HOME,this.foodAmount=o.pick(),this.vel.setHeading(this.vel.heading()+Math.PI),this.internalClock=0;return}if(n&&n.colony&&(this.state===f.REFILL||this.state===f.TO_HOME)){if(this.state===f.TO_HOME&&(this.vel.setHeading(this.vel.heading()+Math.PI),e.addFood(this.foodAmount)),this.state===f.REFILL&&!e.useFood(z.ANT_REFILL_FOOD_AMOUNT))return;this.state=f.TO_FOOD,this.internalClock=0;return}if(Math.random()<this.freedomCoef)return;const l=(a.PERCEPTION_END_ANGLE-a.PERCEPTION_START_ANGLE)/(a.PERCEPTION_POINTS_HORIZONTAL-1),d=a.PERCEPTION_RADIUS/a.PERCEPTION_POINTS_VERTICAL;let u=a.PERCEPTION_POINTS_VERTICAL+1,I=null,R=0,C=null;const p=this.vel.heading(),L=-a.IMG_WIDTH/2,O=Math.PI/4+p+Math.PI,j=-Math.PI/4+p+Math.PI,kt=L*Math.cos(O),U=L*Math.sin(O),Y=L*Math.cos(j),ot=L*Math.sin(j),D=this.pos.copy().add(kt,U),at=this.pos.copy().add(Y,ot),vt=t.getCellFromCoordsSafe(D.x,D.y),oe=t.getCellFromCoordsSafe(at.x,at.y);if(vt&&vt.wall===1||oe&&oe.wall===1){const x=(vt?D:at).sub(this.pos);x.sub(this.vel),x.mult(-1),this.applyForce(x);return}if(this.directionClock>=a.DIRECTION_PERIOD){for(let V=0;V<a.PERCEPTION_POINTS_HORIZONTAL;V++)for(let x=1;x<=a.PERCEPTION_POINTS_VERTICAL;x++){const ae=l*V+a.PERCEPTION_START_ANGLE+p+Math.PI/2,Ue=d*x*Math.cos(ae),Ye=d*x*Math.sin(ae),rt=this.pos.copy().add(Ue,Ye),lt=t.getCellFromCoordsSafe(rt.x,rt.y);if(lt){if(lt.wall===1&&(x===1||x===2)){const ht=rt.sub(this.pos),re=V+1>a.PERCEPTION_POINTS_HORIZONTAL/2?a.PERCEPTION_POINTS_HORIZONTAL-V:V+1;ht.setMag(this.maxSpeed),ht.sub(this.vel),x===1?ht.limit(this.maxForce*re):x===2&&ht.limit(this.maxForce*.5*re),ht.mult(-1),this.applyForce(ht);break}if(lt.colony&&(this.state===f.REFILL||this.state===f.TO_HOME)){this.seek(rt);return}if(lt.food.quantity>0&&(this.state===f.TO_FOOD||this.state===f.REFILL)){this.debug&&this.perceptionDraw.add(x*a.PERCEPTION_POINTS_VERTICAL+V),x<u&&(u=x,I=rt);break}let Tt=0;this.state===f.TO_HOME||this.state===f.REFILL?Tt=lt.marker.intensity[0]:(this.state===f.TO_FOOD||this.state===f.REFILL)&&(Tt=lt.marker.intensity[1]),Tt>R&&(R=Tt,C=rt)}}if(I){this.seek(I);return}if(C){this.seek(C);return}this.directionClock=0}this.wander()}perception(t){const e=(a.PERCEPTION_END_ANGLE-a.PERCEPTION_START_ANGLE)/(a.PERCEPTION_POINTS_HORIZONTAL-1),s=a.PERCEPTION_RADIUS/a.PERCEPTION_POINTS_VERTICAL;let o=a.PERCEPTION_POINTS_VERTICAL+1,n=null,l=0,d=null;const u=this.vel.heading(),I=this.vel.copy().add(this.acc).limit(this.maxSpeed),R=this.pos.copy().add(I),C=t.getCellFromCoordsSafe(R.x,R.y);if((C==null?void 0:C.wall)===1){const p=R.sub(this.pos);this.debug&&console.log(p),p.x*=p.x!=0?-1:1,p.y*=p.y!=0?-1:1,p.sub(this.vel),this.applyForce(p);return}if(this.directionClock>=a.DIRECTION_PERIOD){for(let p=0;p<a.PERCEPTION_POINTS_HORIZONTAL;p++){const L=e*p+a.PERCEPTION_START_ANGLE+u+Math.PI/2;for(let O=1;O<=a.PERCEPTION_POINTS_VERTICAL;O++){const j=s*O*Math.cos(L),kt=s*O*Math.sin(L),U=this.pos.copy().add(j,kt),Y=t.getCellFromCoordsSafe(U.x,U.y);if(Y){if(Y.wall===1&&(O===1||O===2)){const D=U.sub(this.pos),at=p+1>a.PERCEPTION_POINTS_HORIZONTAL/2?a.PERCEPTION_POINTS_HORIZONTAL-p:p+1;D.setMag(this.maxSpeed),D.sub(this.vel),O===1?D.limit(this.maxForce*at):O===2&&D.limit(this.maxForce*.5*at),D.mult(-1),this.applyForce(D);break}if(Y.colony&&(this.state===f.REFILL||this.state===f.TO_HOME)){this.seek(U);return}if(Y.food.quantity>0&&(this.state===f.TO_FOOD||this.state===f.REFILL)){this.debug&&this.perceptionDraw.add(O*a.PERCEPTION_POINTS_VERTICAL+p),O<o&&(o=O,n=U);break}let ot=0;this.state===f.TO_HOME||this.state===f.REFILL?ot=Y.marker.getToHomeIntensity():(this.state===f.TO_FOOD||this.state===f.REFILL)&&(ot=Y.marker.getToFoodIntensity()),ot>l&&(l=ot,d=U)}}}if(n){this.seek(n);return}if(d){this.seek(d);return}this.directionClock=0}}searchSimple(t,e){this.debug&&(this.perceptionDraw=new Set);const s=t.getCellFromCoordsSafe(this.pos.x,this.pos.y);if(s==null||s.addDensity(this.state===f.TO_HOME,this.state===f.REFILL),s&&s.food.quantity>0&&(this.state===f.TO_FOOD||this.state===f.REFILL)){this.state=f.TO_HOME,this.foodAmount=s.pick(),this.vel.setHeading(this.vel.heading()+Math.PI),this.internalClock=0;return}if(s&&s.colony&&(this.state===f.REFILL||this.state===f.TO_HOME)){if(this.state===f.TO_HOME&&(this.vel.setHeading(this.vel.heading()+Math.PI),e.addFood(this.foodAmount)),this.state===f.REFILL&&!e.useFood(z.ANT_REFILL_FOOD_AMOUNT))return;this.state=f.TO_FOOD,this.internalClock=0;return}Math.random()<this.freedomCoef||(this.perception(t),this.wander())}addMarker(t,e){if(this.markerClock+=e,this.markerClock>=a.MARKER_PERIOD){const[s,o]=t.getCellCoords(this.pos.x,this.pos.y);if(!t.checkCoords(s,o))return;const n=a.MARKER_DEFAULT_INTENSITY*Math.exp(-.15*this.internalClock);let l=-1;switch(this.state){case f.TO_HOME:l=ut.TO_FOOD;break;case f.TO_FOOD:l=ut.TO_HOME;break;case f.REFILL:l=ut.TO_HOME;break}t.addMarker(s,o,l,n),this.markerClock=0}}}class Qe{constructor(t){r(this,"id");r(this,"x");r(this,"y");r(this,"startingAntsCount");r(this,"maxAntsCount");r(this,"ants");r(this,"totalAnts");r(this,"colonyColor");r(this,"antIcon");r(this,"antImageInstance");r(this,"antFoodImageInstance");r(this,"antId");r(this,"isRunning");r(this,"isDrawingAnts");r(this,"isDebugMode");r(this,"colonyClock");r(this,"antsCtx");r(this,"selectedAnt");r(this,"food");r(this,"totalFood");r(this,"maxFood");this.id=t.id,this.x=t.pos.x,this.y=t.pos.y,this.startingAntsCount=z.COLONY_STARTING_ANTS,this.maxAntsCount=z.COLONY_MAX_ANTS,this.ants=[],this.totalAnts=0,this.colonyColor=t.colonyColor||[255,255,255],this.antIcon=null,this.antImageInstance=null,this.antFoodImageInstance=null,this.antId=0,this.isRunning=!1,this.isDrawingAnts=!1,this.isDebugMode=!1,this.colonyClock=0,this.antsCtx=null,this.selectedAnt=null,this.food=0,this.totalFood=0,this.maxFood=z.COLONY_MAX_FOOD}initialize(t,e,s,o,n){this.antIcon=t,this.antImageInstance=e,this.antFoodImageInstance=s,this.antsCtx=o;for(let d=0;d<this.startingAntsCount;d++){const u=new de(o,e,s,t,{id:this.antId+1,pos:{x:this.x,y:this.y}});this.ants.push(u),this.antId++,this.totalAnts++}const l=Math.floor(z.COLONY_RADIUS/g.SIZE);for(let d=0;d<l;d++){const u=n.getCellFromCoordsSafe(this.x-l/2*g.SIZE+d*g.SIZE,this.y),I=n.getCellFromCoordsSafe(this.x,this.y-l/2*g.SIZE+d*g.SIZE);u&&I&&(u.colony=!0,I.colony=!0)}}updateAndDrawAnts(t,e,s=!0){let o=!1;for(let n=0;n<this.ants.length;n++){this.isRunning&&(this.ants[n].searchSimple(t,this),this.ants[n].update(e),this.ants[n].addMarker(t,e),this.ants[n].isDead&&(o=!0));let l=!1;if(s){const d={x:a.IMG_HEIGHT*h,y:a.IMG_HEIGHT*h},u=(Ze+d.x)/h,I=(Be-M+d.y)/h,R=c.x-u/2,C=c.y-M/2/h-I/2;this.ants[n].pos.x>=R&&this.ants[n].pos.x<=R+u&&this.ants[n].pos.y>=C&&this.ants[n].pos.y<=C+I&&(l=!0),this.isDrawingAnts&&l&&this.ants[n].draw()}o&&(console.log("Removed ant: ",this.ants[n]),this.ants.splice(n,1),o=!1)}}updateColony(t){!this.isRunning||(this.colonyClock+=t,this.colonyClock>=z.ANT_CREATION_PERIOD&&this.ants.length<this.maxAntsCount&&this.useFood(z.ANT_COST)&&(this.createAnt(),this.colonyClock=0))}createAnt(t=!1){if((this.ants.length<this.maxAntsCount||t)&&this.antIcon&&this.antImageInstance&&this.antFoodImageInstance&&this.antsCtx){const e=new de(this.antsCtx,this.antImageInstance,this.antFoodImageInstance,this.antIcon,{id:this.antId+1,pos:{x:this.x,y:this.y}});this.ants.push(e),this.antId++,this.totalAnts++,this.isDebugMode&&console.log("Created ant: ",e)}else this.isDebugMode&&console.log("Can't create new ant - max count reached")}selectAnt(t){if(this.ants.length<=0)return null;let e=null,s=1/0;const o=a.IMG_HEIGHT/2;for(const n of this.ants){const l=n.pos.dist(t);l<s&&l<o&&(s=l,e=n)}return this.selectedAnt=e,e}removeAnt(){if(this.selectedAnt==null||this.ants.length<=0)return!1;const t=this.ants.findIndex(e=>e.id===this.selectedAnt.id);return t!=-1?(this.ants.splice(t,1),this.selectedAnt=null,!0):!1}toggleAntDebug(){if(this.ants.length>0)for(const t of this.ants)this.selectedAnt&&t.id===this.selectedAnt.id?t.debug=this.isDebugMode:t.debug=!1}drawColony(t){t.fillStyle=`rgb(${this.colonyColor[0]}, ${this.colonyColor[1]}, ${this.colonyColor[2]})`,A(t,this.x,this.y,z.COLONY_RADIUS)}addFood(t){this.food=Math.min(this.food+t,this.maxFood),this.totalFood+=t}useFood(t){return this.food>=t?(this.food-=t,!0):!1}}class Re{constructor(t){r(this,"width");r(this,"height");this.width=t.width,this.height=t.height}createInstance(t){const e=document.createElement("canvas");e.width=this.width,e.height=this.height,console.log(`Created canvas image instance with size: ${this.width} x ${this.height}`);const s=e.getContext("2d");return s&&t(s,e),e}}class ts{constructor(t){r(this,"width");r(this,"height");r(this,"map");r(this,"fillRatio");r(this,"threshold");this.width=t.width,this.height=t.height,this.map=Array.from(Array(this.width),()=>new Array(this.height)),this.fillRatio=t.fillRatio,this.threshold=(this.width+this.height)/2}generateMap(t){this.randomFillMap();for(let e=0;e<15;e++)this.smoothMap();this.addBorderWalls(),this.processMap();for(let e=0;e<t.width;e++)for(let s=0;s<t.height;s++)t.cells[t.getIndexFromCoords(e,s)].wall=this.map[e][s]?1:0}randomFillMap(){for(let t=0;t<this.width;t++)for(let e=0;e<this.height;e++)this.map[t][e]=ft(0,1)<this.fillRatio?1:0}smoothMap(){const t=[];for(let e=0;e<this.map.length;e++)t[e]=this.map[e].slice();for(let e=0;e<this.width;e++)for(let s=0;s<this.height;s++){const o=this.getNeighbourWallCount(e,s);o>4?t[e][s]=1:o<4&&(t[e][s]=0)}this.map=t}getNeighbourWallCount(t,e){let s=0;for(let o=t-1;o<=t+1;o++)for(let n=e-1;n<=e+1;n++)o>=0&&o<this.width&&n>=0&&n<this.height?(o!==t||n!==e)&&(s+=this.map[o][n]):s++;return s}addBorderWalls(){const t=te.BORDER_SIZE;for(let e=0;e<this.width;e++)for(let s=0;s<t;s++)this.map[e][s]=1,this.map[e][this.height-s-1]=1;for(let e=0;e<t;e++)for(let s=0;s<this.height;s++)this.map[e][s]=1,this.map[this.width-e-1][s]=1}processMap(){const t=this.getRegions(1);if(!t)return;const e=this.threshold;for(const n of t)if(n.length<e)for(const l of n)this.map[l.x][l.y]=0;const s=this.getRegions(0);if(!s)return;const o=this.threshold;for(const n of s)if(n.length<o)for(const l of n)this.map[l.x][l.y]=1}getRegions(t){const e=[],s=Array.from(Array(this.width),()=>new Array(this.height).fill(0));for(let o=0;o<this.width;o++)for(let n=0;n<this.height;n++)if(s[o][n]===0&&this.map[o][n]===t){const l=this.getRegionCells(o,n);if(!l)return;e.push(l);for(const d of l)s[d.x][d.y]=1}return e}getRegionCells(t,e){const s=[],o=Array.from(Array(this.width),()=>new Array(this.height).fill(0)),n=this.map[t][e],l=[];for(l.push({x:t,y:e}),o[t][e]=1;l.length>0;){const d=l.shift();if(!d)return;s.push(d);for(let u=d.x-1;u<=d.x+1;u++)for(let I=d.y-1;I<=d.y+1;I++)u>=0&&u<this.width&&I>=0&&I<this.height&&(I===d.y||u===d.x)&&o[u][I]===0&&this.map[u][I]===n&&(o[u][I]=1,l.push({x:u,y:I}))}return s}}class es{constructor(t){r(this,"measurementArray");r(this,"sampleSize");r(this,"isMeasuring");r(this,"modes");r(this,"mode");this.measurementArray=new Map,this.sampleSize=60,this.isMeasuring=!0,this.modes=[],this.mode=0,this.getModes(t),this.createMeasurementArray(t)}getModes(t){for(const e of t)this.modes.push(e.mode)}changeMode(){this.mode==this.modes.length-1?(this.isMeasuring=!1,this.mode=-1):(this.isMeasuring=!0,this.mode++),this.toggleDisplayVisibility()}toggleDisplayVisibility(){for(const t of this.measurementArray.values()){if(!t.element)return;this.isMeasuring&&t.mode<=this.mode?t.element.style.display="block":t.element.style.display="none"}}createMeasurementArray(t){for(const e of t)for(const s of e.stats)this.measurementArray.set(s.name,{performanceArray:[],title:s.title,mode:e.mode,index:0})}createPerformanceDisplay(t){const e=[];for(const[s,o]of this.measurementArray){const n=document.createElement("span");n.dataset[s.toString()]="",n.title=o.title,this.isMeasuring&&o.mode<=this.mode?n.style.display="block":n.style.display="none",o.element=t.appendChild(n),e.push(o.element)}return e}startMeasurement(t){const e=this.measurementArray.get(t);e&&e.mode<=this.mode&&(e.startTime=performance.now())}endMeasurement(t){const e=this.measurementArray.get(t);e&&e.startTime&&e.mode<=this.mode&&(e.performanceArray[e.index]=performance.now()-e.startTime)}setPerformance(t,e){const s=this.measurementArray.get(t);s&&s.mode<=this.mode&&(s.performanceArray[s.index]=e)}update(){const t=new Map;for(const e of this.measurementArray.keys())t.set(e,0);for(const[e,s]of this.measurementArray)for(let o=0;o<s.performanceArray.length;o++)t.set(e,t.get(e)+s.performanceArray[o]);for(const[e,s]of this.measurementArray){if(s.performanceArray.length===0)break;t.set(e,t.get(e)/s.performanceArray.length),s.mode<=this.mode&&(s.index++,s.index===this.sampleSize&&(s.index=0))}return t}}class it{constructor(t,e){r(this,"canvas");r(this,"width");r(this,"height");r(this,"cellSize");this.canvas=t,this.width=e.width,this.height=e.height,this.cellSize=e.cellSize}create(){return this.canvas.width=this.width,this.canvas.height=this.height,console.log(`Created canvas with size: ${this.width} x ${this.height}`),this.canvas.getContext("2d")}}function ss(i){let t=Math.floor(i.width/i.cellSize),e=Math.floor(i.height/i.cellSize);t%2===0&&t--,e%2===0&&e--;const s=t*i.cellSize,o=e*i.cellSize;return console.log(`Calculate sizes:
${i.width==s?s:`${i.width} -> ${s}`} x ${i.height==o?o:`${i.height} -> ${o}`}`),[s,o]}class is{constructor(t){r(this,"quantity");r(this,"changed");this.quantity=t,this.changed=!0}draw(t,e,s){t.clearRect(e*T.SIZE,s*T.SIZE,T.SIZE,T.SIZE);const o=e*T.SIZE+T.SIZE/2,n=s*T.SIZE+T.SIZE/2;t.fillStyle=`hsl(120, 40%, 43%, ${this.quantity/100})`,A(t,o,n,T.SIZE/2,!0),this.changed=!1}pick(){if(this.changed=!0,this.quantity===0)return 0;let t=0;return this.quantity<T.PICK_AMOUNT?t=this.quantity:t=T.PICK_AMOUNT,this.quantity=Math.max(this.quantity-T.PICK_AMOUNT,0),t}}class ns{constructor(t){r(this,"intensity");this.intensity=t}getToHomeIntensity(){return this.intensity[0]}getToFoodIntensity(){return this.intensity[1]}getMixedColor(){if(this.intensity[0]===0&&this.intensity[1]===0)return[0,0,0];const[t,e,s]=he.TO_HOME,[o,n,l]=he.TO_FOOD,d=[this.intensity[0]*t,this.intensity[0]*e,this.intensity[0]*s];if(this.intensity[1]===0)return[Math.round(d[0]),Math.round(d[1]),Math.round(d[2])];const u=[this.intensity[1]*o,this.intensity[1]*n,this.intensity[1]*l];if(this.intensity[0]===0)return[Math.round(u[0]),Math.round(u[1]),Math.round(u[2])];let I=[d[0]+u[0],d[1]+u[1],d[2]+u[2]];return I=[Math.round(Math.min(I[0],255)),Math.round(Math.min(I[1],255)),Math.round(Math.min(I[2],255))],I}update(){this.intensity[0]>.01?this.intensity[0]-=ce/10:this.intensity[0]=0,this.intensity[1]>.01?this.intensity[1]-=ce:this.intensity[1]=0}}class os{constructor(){r(this,"marker");r(this,"food");r(this,"wall");r(this,"density");r(this,"colony");this.marker=new ns([0,0]),this.food=new is(0),this.wall=0,this.density=[0,0,0],this.colony=!1}update(){this.marker.update()}pick(){return this.food.pick()}drawWall(t,e,s){t.fillRect(e,s,1,1)}addDensity(t=!1,e=!1){!t&&!e?this.density[0]++:e?this.density[2]++:this.density[1]++}}class as{constructor(t){r(this,"width");r(this,"height");r(this,"cellSize");r(this,"cells");this.width=t.width,this.height=t.height,this.cellSize=t.cellSize,this.cells=[];for(let e=0;e<this.width*this.height;e++)this.cells.push(new os)}addBorderWalls(){const t=te.BORDER_SIZE;for(let e=0;e<this.width;e++)for(let s=0;s<t;s++){const o=this.cells[this.getIndexFromCoords(e,s)],n=this.cells[this.getIndexFromCoords(e,this.height-s-1)];o.wall=1,n.wall=1}for(let e=0;e<t;e++)for(let s=0;s<this.height;s++){const o=this.cells[this.getIndexFromCoords(e,s)],n=this.cells[this.getIndexFromCoords(this.width-e-1,s)];o.wall=1,n.wall=1}}update(){for(const t of this.cells)this.updateCell(t)}updateCell(t){t.marker.update();for(let e=0;e<3;e++)t.density[e]>.01?t.density[e]*=.99:t.density[e]=0}addMarker(t,e,s,o){const n=this.cells[this.getIndexFromCoords(t,e)];s===ut.TO_HOME?n.marker.intensity[0]=Math.min(1,Math.max(n.marker.getToHomeIntensity(),o)):s===ut.TO_FOOD&&(n.marker.intensity[1]=Math.min(1,Math.max(n.marker.getToFoodIntensity(),o)))}addFood(t,e,s){const o=this.getIndexFromCoords(t,e);if(o>this.cells.length||o<0)return;const n=this.cells[o];n.food.quantity=Math.min(n.food.quantity+s,100),n.food.changed=!0}drawMarkers(t,e,s=!0){for(let o=0;o<e.data.length;o+=4){const n=this.cells[o/4];e.data[o+0]=n.marker.getToHomeIntensity()*255,e.data[o+1]=n.marker.getToFoodIntensity()*255,e.data[o+2]=0,e.data[o+3]=255,s&&this.updateCell(n)}t.putImageData(e,0,0)}drawFood(t){for(let e=0;e<this.cells.length;e++)if(this.cells[e].food.changed){const[s,o]=this.getCoordsFromIndex(e);this.cells[e].food.draw(t,s,o)}}drawWalls(t){t.fillStyle="rgb(163, 163, 163)";for(let e=0;e<this.width;e++)for(let s=0;s<this.height;s++){const o=this.cells[this.getIndexFromCoords(e,s)];o.wall===1&&o.drawWall(t,e,s)}}drawDensity(t,e,s=!0,o=!1){for(let n=0;n<e.data.length;n+=4){const l=this.cells[n/4],d=l.density;if(o)e.data[n+0]=4*d[0],e.data[n+1]=4*d[1],e.data[n+2]=4*d[2],e.data[n+3]=255;else{const u=d[0]+d[1]+d[2];e.data[n+0]=4*u,e.data[n+1]=u,e.data[n+2]=u,e.data[n+3]=255}s&&this.updateCell(l)}t.putImageData(e,0,0)}isOnFood(t,e){return this.cells[this.getIndexFromCoords(t,e)].food.quantity>0}getIndexFromCoords(t,e){return t+e*this.width}getCoordsFromIndex(t){const e=t%this.width,s=Math.floor(t/this.width);return[e,s]}getCellCoords(t,e){const s=Math.floor(t/g.SIZE),o=Math.floor(e/g.SIZE);return[s,o]}getCellFromCoords(t,e,s=!1){return s||([t,e]=this.getCellCoords(t,e)),this.cells[this.getIndexFromCoords(t,e)]}getCellFromCoordsSafe(t,e){const[s,o]=this.getCellCoords(t,e);return this.checkCoords(s,o)?this.getCellFromCoords(s,o,!0):null}checkCoords(t,e){return t>-1&&t<this.width&&e>-1&&e<this.height}}const K=document.getElementById("canvas-container"),rs=document.getElementById("camera-container"),ls=document.getElementById("btn-fullscreen"),hs=document.getElementById("btn-pan"),cs=document.getElementById("canvas"),Ne=document.getElementById("canvas-markers"),Fe=document.getElementById("canvas-food"),ds=document.getElementById("canvas-colony"),be=document.getElementById("canvas-walls"),wt=document.getElementById("canvas-edit"),Ot=document.getElementById("canvas-edit-preview"),fe=document.getElementById("antIcon"),St=document.getElementById("btn-ant-panel"),ee=document.getElementById("antPanel"),ue=document.querySelector("[data-id]"),ye=document.querySelector("[data-pos]"),me=document.querySelector("[data-vel]"),ge=document.querySelector("[data-state]"),Zt=document.querySelector("[data-lifespan-preview]"),Ie=document.querySelector("[data-lifespan]"),Gt=document.getElementById("btn-track"),fs=document.getElementById("btn-remove"),Ut=document.getElementById("btn-cell-panel"),Le=document.getElementById("cellPanel"),Ee=document.querySelector("[data-cell-preview]"),pe=document.querySelector("[data-intensity-home]"),we=document.querySelector("[data-intensity-food]"),Oe=document.querySelector("[data-cell-food]"),Te=document.querySelector("[data-density]"),Yt=document.getElementById("btn-colony-panel"),De=document.getElementById("colonyPanel"),Ce=document.querySelector("[data-colony-preview]"),xe=document.querySelector("[data-colony-pop]"),Me=document.querySelector("[data-colony-food]"),Ae=document.querySelector("[data-pause]"),ke=document.getElementById("btn-play"),ve=document.getElementById("btn-pause"),Vt=document.getElementById("btn-edit-mode"),He=document.getElementById("editPanel"),Se=document.querySelector("[data-brush-preview]"),us=document.querySelector("[data-brush-size]"),J=document.getElementById("brushSizeInput"),Pt=document.getElementById("btn-wall-brush"),Xt=document.getElementById("btn-food-brush"),ys=document.getElementById("btn-save"),ms=document.getElementById("btn-controls"),gs=document.getElementById("btn-close-controls"),ze=document.getElementById("controlsPanel"),Is=document.querySelector("[data-performance-display]"),Es=document.getElementById("btn-generate-map");let N=!1,yt=!0,B=!1,W=!1,Q=!1,At=!1,q=!1,Kt=!1,jt=!1,$=!1,tt=!1,_t=!0,Rt=!1,It=!1,H=!1,Et=!1,Bt=0;const w=new es([{mode:0,stats:[{name:"fps",title:"Frames per second"},{name:"ms",title:"Milliseconds to render a frame"}]},{mode:1,stats:[{name:"clear",title:"Milliseconds to clear the screen"},{name:"grid",title:"Milliseconds to draw markers/density and update cells"},{name:"food",title:"Milliseconds to draw food"},{name:"ants",title:"Milliseconds to draw and update ants"},{name:"panels",title:"Milliseconds to update info panels"},{name:"all",title:"Milliseconds needed for main loop"}]}]),[ps,Wt,ws,Os,Ts,Cs,xs,Ms]=w.createPerformanceDisplay(Is),M=K.getBoundingClientRect().top;let Lt=0,Dt=0,h=1,dt=!1,Nt=!1,$t=0;const k={x:0,y:0},m={x:0,y:0},c={x:0,y:0};let mt=0,Jt=!1,F=5,Ze=window.innerWidth,Be=window.innerHeight;window.addEventListener("resize",()=>{Ze=window.innerWidth,Be=window.innerHeight;const i={x:0,y:0};i.x=window.innerWidth/2/h-m.x,i.y=window.innerHeight/2/h-m.y,m.x=window.innerWidth/2/h-i.x,m.y=window.innerHeight/2/h-i.y,c.x=(window.innerWidth/2-window.innerWidth/2)/h-i.x,c.y=(window.innerHeight/2-window.innerHeight/2)/h-i.y,c.x=c.x<0?Math.abs(c.x):c.x*-1,c.y=c.y<0?Math.abs(c.y):c.y*-1,nt()});const[P,_]=ss({width:le.WIDTH,height:le.HEIGHT,cellSize:g.SIZE}),As=new it(Ne,{width:P/g.SIZE,height:_/g.SIZE,cellSize:1});Ne.style.transform=`scale(${g.SIZE})`;const S=As.create(),Ss=new it(Fe,{width:P/(g.SIZE/T.SIZE),height:_/(g.SIZE/T.SIZE),cellSize:g.SIZE/T.SIZE});Fe.style.transform=`scale(${g.SIZE/T.SIZE})`;const Ft=Ss.create(),Ps=new it(cs,{width:P,height:_,cellSize:g.SIZE}),X=Ps.create(),_s=new Re({width:a.IMG_WIDTH,height:a.IMG_HEIGHT}),Rs=new Re({width:a.FOOD_SIZE,height:a.FOOD_SIZE}),Ns=new it(ds,{width:P,height:_,cellSize:g.SIZE}),Qt=Ns.create(),Fs=new it(be,{width:P/g.SIZE,height:_/g.SIZE,cellSize:1});be.style.transform=`scale(${g.SIZE})`;const G=Fs.create(),bs=new it(wt,{width:P/g.SIZE,height:_/g.SIZE,cellSize:1});wt.style.transform=`scale(${g.SIZE})`;const v=bs.create(),Ls=new it(Ot,{width:P/g.SIZE,height:_/g.SIZE,cellSize:1});Ot.style.transform=`scale(${g.SIZE})`;const gt=Ls.create(),y=new as({width:P/g.SIZE,height:_/g.SIZE,cellSize:1}),Ds=new ts({width:y.width,height:y.height,fillRatio:te.FILL_RATIO}),bt=S==null?void 0:S.createImageData(y.width,y.height),xt=S==null?void 0:S.createImageData(y.width,y.height),E=new Qe({id:1,pos:{x:P/2,y:_/2}});window.addEventListener("keydown",i=>{switch(console.log(i),i.code){case"Space":i.preventDefault(),ie();break;case"KeyM":Hs();break;case"KeyN":zs();break;case"KeyA":Bs();break;case"KeyD":Zs();break;case"KeyT":$e();break;case"KeyC":ne();break;case"Delete":qe();break;case"Insert":for(let t=0;t<(i.ctrlKey?10:i.shiftKey?100:1);t++)$s();break;case"KeyF":w.changeMode();break;case"ArrowUp":Mt(0,Ct);break;case"ArrowDown":Mt(0,-Ct);break;case"ArrowLeft":Mt(Ct,0);break;case"ArrowRight":Mt(-Ct,0);break;case"Minus":_e(!1);break;case"Equal":_e(!0);break;case"Comma":Pe(-et.STEP);break;case"Period":Pe(et.STEP);break}});K.addEventListener("mousemove",i=>{Lt=i.pageX,Dt=i.pageY-M});K.addEventListener("click",()=>{if(Nt){Nt=!1;return}Ws(),Q&&We()});K.addEventListener("contextmenu",i=>{if(i.preventDefault(),q)return;const t=st(Math.floor((Lt/h-m.x)/g.SIZE),Math.floor((Dt/h-m.y)/g.SIZE));Q&&console.log(`Placed food at: ${t.x}:${t.y}`),y.addFood(t.x,t.y,10)});K.addEventListener("wheel",i=>{Xs(i)});ls.addEventListener("click",()=>{ne()});Gt.addEventListener("click",()=>{$e()});fs.addEventListener("click",()=>{qe()});ke.addEventListener("click",()=>{ie()});ve.addEventListener("click",()=>{ie()});Yt.addEventListener("click",()=>{Rt=b(Rt,De,Yt)});Rt=b(Rt,De,Yt);Ut.addEventListener("click",()=>{It=b(It,Le,Ut)});St.addEventListener("click",()=>{H=b(H,ee,St)});ms.addEventListener("click",()=>{Et=b(Et,ze)});gs.addEventListener("click",()=>{Et=!0,Et=b(Et,ze)});Es.addEventListener("click",()=>{confirm("Are you sure you want to generate a new map?")&&G&&(G.clearRect(0,0,y.width,y.height),Ds.generateMap(y),y.drawWalls(G))});Vt.addEventListener("click",()=>{q=b(q,He,Vt),q?(wt.style.display="block",Ot.style.display="block"):(wt.style.display="none",Ot.style.display="none")});Pt.addEventListener("click",()=>{$=pt($,Pt),$&&(tt=!0,tt=pt($,Xt))});Xt.addEventListener("click",()=>{tt=pt(tt,Xt),tt&&($=!0,$=pt(tt,Pt))});ys.addEventListener("click",()=>{if(v&&G){const i=v.getImageData(0,0,y.width,y.height);G.clearRect(0,0,y.width,y.height);for(let t=0;t<i.data.length;t+=4){const e=y.cells[t/4],s=i.data[t+0],o=i.data[t+1],n=i.data[t+2],l=i.data[t+3];o<=160&&o>0&&o>s&&o>n?e.wall!==1?(e.food.quantity=Math.min(100,Math.round(100*(l/255))+e.food.quantity),e.food.changed=!0):e.wall=1:s>10&&o>10&&n>10&&s===o&&o===n?(e.wall=1,e.food.quantity=0,e.food.changed=!0):l>0&&(e.food.quantity=0,e.food.changed=!0,e.wall=0)}y.addBorderWalls(),y.drawWalls(G),v.clearRect(0,0,y.width,y.height),q=b(q,He,Vt),wt.style.display="none",Ot.style.display="none"}});J.addEventListener("input",()=>{F=parseInt(J.value),se()});function ks(){J.min=et.MIN_SIZE.toString(),J.max=et.MAX_SIZE.toString(),J.step=et.STEP.toString(),J.value=F.toString()}function se(){Se.style.width=`${F}px`,Se.style.height=`${F}px`,us.textContent=`${F} px`}function Pe(i){F=Math.min(et.MAX_SIZE,Math.max(et.MIN_SIZE,F+i)),J.value=F.toString(),se()}ks();se();$=pt($,Pt);vs();Vs();ne();window.requestAnimationFrame(Ge);function vs(){if(!(S==null||Ft==null||X==null||Qt==null||G==null||v==null||gt==null)){if(bt&&(y.drawMarkers(S,bt),y.drawFood(Ft)),fe){const i=new XMLSerializer().serializeToString(fe),t=btoa(i),s="data:image/svg+xml;base64,"+t,o=new Image;o.src=s,o.onload=()=>{const n=_s.createInstance(d=>{d.drawImage(o,0,0)}),l=Rs.createInstance(d=>{const u=a.FOOD_SIZE/2;d.fillStyle="hsl(120, 40%, 43%)",A(d,u,u,a.FOOD_SIZE/2)});E.initialize(o,n,l,X,y)}}E.drawColony(Qt),y.addBorderWalls(),y.drawWalls(G)}}function ie(){_t&&(E.isDrawingAnts=!0,_t=!1),Ae&&(N=!N,E.isRunning=N,Ae.style.display=N?"none":"block",ke.style.display=N?"none":"flex",ve.style.display=N?"flex":"none")}function Hs(){yt=!yt,yt&&(B=!1,W=!1)}function zs(){W=B?!W:W,B=W?B:!B,(B||W)&&(yt=!1),console.log(B,W,yt)}function Zs(){Q=!Q,E.isDebugMode=Q,We(),Q&&(It=!1),It=b(It,Le,Ut)}function We(){E.toggleAntDebug()}function $e(){E.selectedAnt!=null&&(At=!At,At&&(h=3),Gt.classList.toggle("border-green-500"),Gt.classList.toggle("border-red-500"))}function qt(){hs.classList.toggle("bg-neutral-600")}function Bs(){if(_t){_t=!1,E.isDrawingAnts=!1;return}E.isDrawingAnts=!E.isDrawingAnts}function Ws(){const i=st(Lt/h-m.x,Dt/h-m.y);E.selectAnt(i),E.selectedAnt?H=!1:H=!0,H=b(H,ee,St)}function qe(){E.removeAnt()?H=!0:H=!1,H=b(H,ee,St)}function $s(){E.createAnt(!0)}function qs(){const i=E.selectedAnt;if(!i||!ue||!ye||!me||!ge||!Zt||!Ie)return;ue.textContent=i.id.toString(),ye.textContent=`${i.pos.x.toFixed(2)} : ${i.pos.y.toFixed(2)}`,me.textContent=`${i.vel.x.toFixed(2)} : ${i.vel.y.toFixed(2)}`;let t="";switch(i.state){case f.TO_HOME:t="To Home";break;case f.TO_FOOD:t="To Food";break;case f.REFILL:t="Refill";break}ge.textContent=t;const e=a.AUTONOMY_REFILL/i.maxAutonomy,s=i.internalClock/i.maxAutonomy;Zt.style.setProperty("--left",`${e*100}%`),Zt.style.setProperty("--width",`${s*100}%`),Ie.textContent=`${i.internalClock.toFixed(2)} | ${i.maxAutonomy.toFixed(2)}`}function Gs(i,t){const e=y.getCellFromCoordsSafe(i,t);if(!e||!pe||!we||!Oe||!Te||!Ee)return;pe.textContent=e.marker.getToHomeIntensity().toFixed(2),we.textContent=e.marker.getToFoodIntensity().toFixed(2),Oe.textContent=e.food.quantity.toString(),Te.textContent=(e.density[0]+e.density[1]+e.density[2]).toFixed(2);const s=e.marker.getMixedColor();Ee.style.backgroundColor=`rgb(${s[0]}, ${s[1]}, ${s[2]})`}function Us(){if(!E||!xe||!Me||!Ce)return;xe.textContent=`${E.ants.length} | ${E.totalAnts}`,Me.textContent=`${E.food.toFixed(2)} | ${E.totalFood}`;const i=E.colonyColor;Ce.style.backgroundColor=`rgb(${i[0]}, ${i[1]}, ${i[2]})`}function Ys(){const i=w.update();ps.textContent=`${Math.round(i.get("fps")*100)/100} fps`,Wt.textContent=`${Math.round(i.get("ms")*100)/100} ms`,ws.textContent=`${Math.round(i.get("clear")*100)/100} ms`,Os.textContent=`${Math.round(i.get("grid")*100)/100} ms`,Ts.textContent=`${Math.round(i.get("food")*100)/100} ms`,Cs.textContent=`${Math.round(i.get("ants")*100)/100} ms`,xs.textContent=`${Math.round(i.get("panels")*100)/100} ms`,Ms.textContent=`${Math.round(i.get("all")*100)/100} ms`,i.get("ms")>16.7?Wt.classList.add("text-red-500"):Wt.classList.remove("text-red-500")}function Vs(){K.addEventListener("mousedown",i=>{if(clearTimeout($t),i.buttons==zt&&q)jt=!0;else if(i.buttons==zt)return;if(i.buttons==je)dt=!0,Nt=!1,qt(),document.body.classList.add("cursor-grabbing"),k.x=i.clientX/h-m.x,k.y=(i.clientY-M)/h-m.y;else{if(q){Kt=!0;return}dt=!1,$t=setTimeout(()=>{dt=!0,Nt=!0,qt(),document.body.classList.add("cursor-grabbing"),k.x=i.clientX/h-m.x,k.y=(i.clientY-M)/h-m.y},100)}}),K.addEventListener("mousemove",i=>{!dt||i.buttons==zt||Ks(i)}),K.addEventListener("mouseup",()=>{clearTimeout($t),Kt=!1,jt=!1,dt&&(dt=!1,qt(),document.body.classList.remove("cursor-grabbing"))})}function Xs(i){const t={x:0,y:0};t.x=i.clientX/h-m.x,t.y=(i.clientY-M)/h-m.y,h*=.999**i.deltaY,h=Math.min(Math.max(.15,h),16),m.x=i.clientX/h-t.x,m.y=(i.clientY-M)/h-t.y,c.x=(i.clientX-window.innerWidth/2)/h-t.x,c.y=(i.clientY-M-window.innerHeight/2)/h-t.y,c.x=c.x<0?Math.abs(c.x):c.x*-1,c.y=c.y<0?Math.abs(c.y):c.y*-1,nt()}function Ks(i){console.log(i),m.x=i.clientX/h-k.x,m.y=(i.clientY-M)/h-k.y;const t={x:window.innerWidth/2-P/2,y:window.innerHeight/2-_/2},e={x:0,y:0};e.x=(i.clientX-t.x)/h-k.x,e.y=(i.clientY-M-t.y)/h-k.y,console.log("--- START ---"),console.log(m),console.log(t),console.log(h),console.log(e);const s={x:0,y:0};s.x=i.clientX/h-m.x,s.y=(i.clientY-M)/h-m.y,console.log(s),console.log(i.clientX,i.clientY),c.x=(i.clientX-window.innerWidth/2)/h-k.x,c.y=(i.clientY-M-window.innerHeight/2)/h-k.y,console.log(c),console.log(window.innerWidth,window.innerHeight),c.x=c.x<0?Math.abs(c.x):c.x*-1,c.y=c.y<0?Math.abs(c.y):c.y*-1,console.log("--- END ---"),nt()}function Mt(i,t){m.x+=i,m.y+=t,c.x-=i,c.y-=t,nt()}function _e(i){const t={x:0,y:0};t.x=window.innerWidth/2/h-m.x,t.y=window.innerHeight/2/h-m.y,h*=.999**(i?-100:100),h=Math.min(Math.max(.15,h),16),m.x=window.innerWidth/2/h-t.x,m.y=window.innerHeight/2/h-t.y,c.x=(window.innerWidth/2-window.innerWidth/2)/h-t.x,c.y=(window.innerHeight/2-window.innerHeight/2)/h-t.y,c.x=c.x<0?Math.abs(c.x):c.x*-1,c.y=c.y<0?Math.abs(c.y):c.y*-1,nt()}function ne(){const i={x:window.innerWidth/2-P/2,y:window.innerHeight/2-_/2};h=1,m.x=i.x,m.y=i.y,c.x=P/2,c.y=_/2,nt()}function js(i,t){const e={x:window.innerWidth/2/h-i,y:window.innerHeight/2/h-t};m.x=e.x,m.y=e.y,c.x=window.innerWidth/2/h-e.x,c.y=window.innerHeight/2/h-e.y,nt()}function nt(){rs.style.transform=`scale(${h}) translate(${m.x}px, ${m.y}px)`,Jt=!0}function Ge(i){if(S==null||Ft==null||X==null||Qt==null||G==null||v==null||gt==null)return;window.requestAnimationFrame(Ge),w.startMeasurement("all");const t=(i-Bt)/1e3;mt+=t;const e=(Jt||N)&&mt>Ht/h||mt>Ht*10/h;w.isMeasuring&&(w.setPerformance("fps",1/t),w.setPerformance("ms",i-Bt)),w.startMeasurement("clear"),e&&X.clearRect(0,0,P,_),S.clearRect(0,0,y.width,y.height),w.endMeasurement("clear"),w.startMeasurement("grid"),yt&&bt?y.drawMarkers(S,bt,N):B&&!W&&xt?y.drawDensity(S,xt,N):B&&W&&xt?y.drawDensity(S,xt,N,!0):N&&y.update(),w.endMeasurement("grid"),w.startMeasurement("food"),y.drawFood(Ft),w.endMeasurement("food");const s=st(Lt/h-m.x,Dt/h-m.y),o=st(c.x>0?Math.abs(c.x):c.x*-1,c.y>0?Math.abs(c.y):c.y*-1);if(q){gt.clearRect(0,0,y.width,y.height),gt.fillStyle="grey";const n=y.getCellCoords(s.x,s.y);A(gt,n[0],n[1],F),jt?(v.fillStyle="black",A(v,n[0],n[1],F)):Kt&&($?v.fillStyle="rgb(163, 163, 163)":tt&&(v.fillStyle="rgb(66, 153, 66, 0.25)"),A(v,n[0],n[1],F))}if(E.updateColony(t),w.startMeasurement("ants"),e?E.updateAndDrawAnts(y,t):E.updateAndDrawAnts(y,t,!1),w.endMeasurement("ants"),w.startMeasurement("panels"),qs(),At&&E.selectedAnt&&js(E.selectedAnt.pos.x,E.selectedAnt.pos.y),Q&&e&&(X.fillStyle="red",A(X,s.x,s.y,4),Gs(s.x,s.y),mt>Ht/h)){X.fillStyle="rgb(255, 0, 0, 0.1)";const n={x:a.IMG_HEIGHT*h,y:a.IMG_HEIGHT*h},l={x:(window.innerWidth+n.x)/h,y:(window.innerHeight-M+n.y)/h};Je(X,o.x-l.x/2,o.y-M/2/h-l.y/2,l.x,l.y)}Us(),w.endMeasurement("panels"),w.isMeasuring&&(w.endMeasurement("all"),Ys()),e&&(Jt=!1,mt=0),Bt=i}
