var Ie=Object.defineProperty;var pe=(i,t,e)=>t in i?Ie(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var o=(i,t,e)=>(pe(i,typeof t!="symbol"?t+"":t,e),e);const Ce=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const r of l.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function e(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerpolicy&&(l.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?l.credentials="include":s.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(s){if(s.ep)return;s.ep=!0;const l=e(s);fetch(s.href,l)}};Ce();const Yt={WIDTH:1600*3,HEIGHT:1200*3};var U=(i=>(i[i.TO_HOME=0]="TO_HOME",i[i.TO_FOOD=1]="TO_FOOD",i))(U||{});const ft={TO_HOME:[255,0,0],TO_FOOD:[43,255,0]},u={WIDTH:16,HEIGHT:16,SIZE:16},Xt=2e-4,v={COLONY_RADIUS:50,COLONY_STARTING_ANTS:25,COLONY_MAX_ANTS:250,COLONY_MAX_FOOD:1250,ANT_CREATION_PERIOD:.15,ANT_COST:30,ANT_REFILL_FOOD_AMOUNT:1};var f=(i=>(i[i.TO_HOME=0]="TO_HOME",i[i.TO_FOOD=1]="TO_FOOD",i[i.REFILL=2]="REFILL",i))(f||{});const a={IMG_WIDTH:24,IMG_HEIGHT:34,WANDER_DISPLACE_RANGE:.5,WANDER_POINT_MAGNITUDE:100,WANDER_POINT_RADIUS:50,PERCEPTION_RADIUS:150,PERCEPTION_START_ANGLE:7/6*Math.PI,PERCEPTION_END_ANGLE:11/6*Math.PI,PERCEPTION_POINTS_HORIZONTAL:12,PERCEPTION_POINTS_VERTICAL:5,MARKER_PERIOD:.15,MARKER_DEFAULT_INTENSITY:1,AUTONOMY_MAX:300,AUTONOMY_REFILL:150},g={SIZE:15,PICK_AMOUNT:2},_t=2,Oe=4,yt=u.SIZE;function I(i,t,e,n,s=!0,l=!1){i.beginPath(),i.arc(t,e,n,0,Math.PI*2),s&&i.fill(),l&&i.stroke()}function q(i,t,e,n,s){i.beginPath(),i.moveTo(t,e),i.lineTo(n,s),i.stroke(),i.closePath()}function tt(i,t){return Math.random()*(t-i)+i}function S(i,t,e){return i=!i,i?(t.style.display="block",e==null||e.classList.add("border-green-500"),e==null||e.classList.remove("border-red-500")):(t.style.display="none",e==null||e.classList.add("border-red-500"),e==null||e.classList.remove("border-green-500")),i}function at(i,t){return i=!i,i?(t.classList.add("border-green-500"),t.classList.remove("border-red-500")):(t.classList.add("border-red-500"),t.classList.remove("border-green-500")),i}class p{constructor(t,e,n){o(this,"x");o(this,"y");o(this,"z");this.x=t||0,this.y=e||0,this.z=n||0}set(t,e,n){return t instanceof p?(this.x=t.x||0,this.y=t.y||0,this.z=t.z||0,this):t instanceof Array?(this.x=t[0]||0,this.y=t[1]||0,this.z=t[2]||0,this):(this.x=t||0,this.y=e||0,this.z=n||0,this)}copy(){return new p(this.x,this.y,this.z)}add(t,e,n){return t instanceof p?(this.x+=t.x||0,this.y+=t.y||0,this.z+=t.z||0,this):t instanceof Array?(this.x+=t[0]||0,this.y+=t[1]||0,this.z+=t[2]||0,this):(this.x+=t||0,this.y+=e||0,this.z+=n||0,this)}sub(t,e,n){return t instanceof p?(this.x-=t.x||0,this.y-=t.y||0,this.z-=t.z||0,this):t instanceof Array?(this.x-=t[0]||0,this.y-=t[1]||0,this.z-=t[2]||0,this):(this.x-=t||0,this.y-=e||0,this.z-=n||0,this)}mult(t,e,n){if(t instanceof p)return Number.isFinite(t.x)&&Number.isFinite(t.y)&&Number.isFinite(t.z)&&typeof t.x=="number"&&typeof t.y=="number"&&typeof t.z=="number"?(this.x*=t.x,this.y*=t.y,this.z*=t.z):console.warn("Vector.mult:","x contains components that are either undefined or not finite numbers"),this;if(t instanceof Array)return t.every(l=>Number.isFinite(l))&&t.every(l=>typeof l=="number")?t.length===1?(this.x*=t[0],this.y*=t[0],this.z*=t[0]):t.length===2?(this.x*=t[0],this.y*=t[1]):t.length===3&&(this.x*=t[0],this.y*=t[1],this.z*=t[2]):console.warn("Vector.mult:","x contains elements that are either undefined or not finite numbers"),this;const s=[...arguments];return s.every(l=>Number.isFinite(l))&&s.every(l=>typeof l=="number")?(arguments.length===1&&(this.x*=t,this.y*=t,this.z*=t),arguments.length===2&&(this.x*=t,this.y*=e||0),arguments.length===3&&(this.x*=t,this.y*=e||0,this.z*=n||0)):console.warn("Vector.mult:","x, y, or z arguments are either undefined or not a finite number"),this}div(t,e,n){if(t instanceof p){if(Number.isFinite(t.x)&&Number.isFinite(t.y)&&Number.isFinite(t.z)&&typeof t.x=="number"&&typeof t.y=="number"&&typeof t.z=="number"){if(t.x===0||t.y===0||t.z===0)return console.warn("Vector.div:","divide by 0"),this;this.x/=t.x,this.y/=t.y,this.z/=t.z}else console.warn("Vector.div:","x contains components that are either undefined or not finite numbers");return this}if(t instanceof Array){if(t.every(l=>Number.isFinite(l))&&t.every(l=>typeof l=="number")){if(t.some(l=>l===0))return console.warn("Vector.div:","divide by 0"),this;t.length===1?(this.x/=t[0],this.y/=t[0],this.z/=t[0]):t.length===2?(this.x/=t[0],this.y/=t[1]):t.length===3&&(this.x/=t[0],this.y/=t[1],this.z/=t[2])}else console.warn("Vector.div:","x contains components that are either undefined or not finite numbers");return this}const s=[...arguments];if(s.every(l=>Number.isFinite(l))&&s.every(l=>typeof l=="number")){if(s.some(l=>l===0))return console.warn("Vector.div:","divide by 0"),this;arguments.length===1&&(this.x/=t,this.y/=t,this.z/=t),arguments.length===2&&(this.x/=t,this.y/=e||0),arguments.length===3&&(this.x/=t,this.y/=e||0,this.z/=n||0)}else console.warn("Vector.div:","x, y, or z arguments are either undefined or not a finite number");return this}mag(){return Math.sqrt(this.magSq())}magSq(){const t=this.x,e=this.y,n=this.z;return t*t+e*e+n*n}dist(t){return t.copy().sub(this).mag()}normalize(){const t=this.mag();return t!==0&&this.mult(1/t),this}limit(t){const e=this.magSq();return e>t*t&&this.div(Math.sqrt(e)).mult(t),this}setMag(t){return this.normalize().mult(t)}heading(){return Math.atan2(this.y,this.x)}setHeading(t){let e=this.mag();return this.x=e*Math.cos(t),this.y=e*Math.sin(t),this}rotate(t){let e=this.heading()+t;const n=this.mag();return this.x=Math.cos(e)*n,this.y=Math.sin(e)*n,this}equals(t,e,n){let s,l,r;return t instanceof p?(s=t.x||0,l=t.y||0,r=t.z||0):t instanceof Array?(s=t[0]||0,l=t[1]||0,r=t[2]||0):(s=t||0,l=e||0,r=n||0),this.x===s&&this.y===l&&this.z===r}}function Y(i,t,e){return new p(i,t,e)}class Kt{constructor(t,e,n){o(this,"ctx");o(this,"antIcon");o(this,"id");o(this,"pos");o(this,"vel");o(this,"acc");o(this,"maxSpeed");o(this,"maxForce");o(this,"state");o(this,"debug");o(this,"wanderTheta");o(this,"perceptionDraw");o(this,"internalClock");o(this,"markerClock");o(this,"isDead");o(this,"freedomCoef");o(this,"foodAmount");o(this,"maxAutonomy");this.ctx=t,this.antIcon=e,this.id=n.id,this.pos=Y(n.pos.x,n.pos.y),this.vel=Y(0,0),this.acc=Y(0,0),this.maxSpeed=4,this.maxForce=.25,this.state=f.TO_FOOD,this.debug=n.debug||!1,this.wanderTheta=tt(0,Math.PI*2),this.perceptionDraw=new Set,this.internalClock=0,this.markerClock=tt(0,a.MARKER_PERIOD),this.isDead=!1,this.freedomCoef=tt(.01,.1),this.foodAmount=0,this.maxAutonomy=a.AUTONOMY_MAX-tt(0,50)}seek(t){this.debug&&(this.ctx.strokeStyle="white",q(this.ctx,t.x,t.y,this.pos.x,this.pos.y));let e=t.copy().sub(this.pos);e.setMag(this.maxSpeed),e.sub(this.vel),e.limit(this.maxForce),this.applyForce(e)}wander(){let t=this.vel.copy();t.setMag(a.WANDER_POINT_MAGNITUDE),t.add(this.pos);let e=a.WANDER_POINT_RADIUS;this.debug&&(this.ctx.fillStyle="red",I(this.ctx,t.x,t.y,4),this.ctx.strokeStyle="white",I(this.ctx,t.x,t.y,e,!1,!0),q(this.ctx,this.pos.x,this.pos.y,t.x,t.y));let n=this.wanderTheta+this.vel.heading(),s=e*Math.cos(n),l=e*Math.sin(n);t.add(s,l),this.ctx.fillStyle="green",this.debug&&(I(this.ctx,t.x,t.y,8),q(this.ctx,this.pos.x,this.pos.y,t.x,t.y));let r=t.sub(this.pos);r.setMag(this.maxForce),r.limit(this.maxForce),this.applyForce(r);let E=a.WANDER_DISPLACE_RANGE;this.wanderTheta+=tt(-E,E)}applyForce(t){this.acc.add(t)}update(t){this.internalClock+=t,this.internalClock>=a.AUTONOMY_REFILL&&this.state===f.TO_FOOD&&(this.state=f.REFILL),this.internalClock>=this.maxAutonomy&&(this.isDead=!0),this.vel.add(this.acc),this.vel.limit(this.maxSpeed),this.pos.add(this.vel),this.acc.set(0,0)}draw(){this.ctx.save(),this.ctx.translate(this.pos.x,this.pos.y),this.ctx.rotate(this.vel.heading()+Math.PI/2);let t=-a.IMG_WIDTH/2,e=-a.IMG_HEIGHT/2;if(this.state===f.TO_HOME&&(this.ctx.fillStyle="green",I(this.ctx,0,e,10)),this.ctx.drawImage(this.antIcon,t,e,a.IMG_WIDTH,a.IMG_HEIGHT),this.debug){this.ctx.strokeStyle="#FF0000",this.ctx.lineWidth=2,this.ctx.strokeRect(t,e,a.IMG_WIDTH,a.IMG_HEIGHT),this.ctx.fillStyle="red",I(this.ctx,0,0,4),this.ctx.beginPath(),this.ctx.arc(0,0,a.PERCEPTION_RADIUS,a.PERCEPTION_START_ANGLE,a.PERCEPTION_END_ANGLE),this.ctx.stroke(),this.ctx.strokeStyle="white",this.ctx.beginPath(),this.ctx.arc(0,0,a.PERCEPTION_RADIUS,a.PERCEPTION_END_ANGLE,a.PERCEPTION_START_ANGLE),this.ctx.stroke();let n=a.PERCEPTION_START_ANGLE,s=a.PERCEPTION_END_ANGLE,l=a.PERCEPTION_RADIUS*Math.cos(n),r=a.PERCEPTION_RADIUS*Math.sin(n),E=a.PERCEPTION_RADIUS*Math.cos(s),m=a.PERCEPTION_RADIUS*Math.sin(s);this.ctx.strokeStyle="red",q(this.ctx,0,0,l,r),q(this.ctx,0,0,E,m);let T=(a.PERCEPTION_END_ANGLE-a.PERCEPTION_START_ANGLE)/(a.PERCEPTION_POINTS_HORIZONTAL-1),B=a.PERCEPTION_RADIUS/a.PERCEPTION_POINTS_VERTICAL;for(let x=0;x<a.PERCEPTION_POINTS_HORIZONTAL;x++)for(let M=1;M<=a.PERCEPTION_POINTS_VERTICAL;M++){let j=T*x+a.PERCEPTION_START_ANGLE,ct=B*M*Math.cos(j),dt=B*M*Math.sin(j);this.perceptionDraw.has(M*a.PERCEPTION_POINTS_VERTICAL+x)?(this.ctx.strokeStyle="white",this.ctx.fillStyle="white"):(this.ctx.strokeStyle="red",this.ctx.fillStyle="green"),I(this.ctx,ct,dt,4),M===a.PERCEPTION_POINTS_VERTICAL&&q(this.ctx,0,0,ct,dt)}}this.ctx.restore(),this.debug&&(this.ctx.fillStyle="white",I(this.ctx,this.pos.x,this.pos.y,3))}search(t,e){this.debug&&(this.perceptionDraw=new Set);let n=this.vel.copy();n.setMag(a.IMG_HEIGHT/2),n.add(this.pos);let s=t.getCellFromCoordsSafe(n.x,n.y),l=t.getCellFromCoordsSafe(this.pos.x,this.pos.y);if(l==null||l.addDensity(),s&&s.food.quantity>0&&(this.state===f.TO_FOOD||this.state===f.REFILL)){this.state=f.TO_HOME,this.foodAmount=s.pick(),this.vel.setHeading(this.vel.heading()+Math.PI),this.internalClock=0;return}if(l&&l.colony&&(this.state===f.REFILL||this.state===f.TO_HOME)){if(this.state===f.TO_HOME&&(this.vel.setHeading(this.vel.heading()+Math.PI),e.addFood(this.foodAmount)),this.state===f.REFILL&&!e.useFood(v.ANT_REFILL_FOOD_AMOUNT))return;this.state=f.TO_FOOD,this.internalClock=0;return}if(Math.random()<this.freedomCoef)return;let r=(a.PERCEPTION_END_ANGLE-a.PERCEPTION_START_ANGLE)/(a.PERCEPTION_POINTS_HORIZONTAL-1),E=a.PERCEPTION_RADIUS/a.PERCEPTION_POINTS_VERTICAL,m=0,T=null,B=this.vel.heading(),x=-a.IMG_WIDTH/2,M=Math.PI/4+B+Math.PI,j=-Math.PI/4+B+Math.PI,ct=x*Math.cos(M),dt=x*Math.sin(M),ye=x*Math.cos(j),me=x*Math.sin(j),St=this.pos.copy().add(ct,dt),wt=this.pos.copy().add(ye,me),Pt=t.getCellFromCoordsSafe(St.x,St.y),Wt=t.getCellFromCoordsSafe(wt.x,wt.y);if(Pt&&Pt.wall===1||Wt&&Wt.wall===1){let w=(Pt?St:wt).sub(this.pos);w.sub(this.vel),w.mult(-1),this.applyForce(w);return}for(let J=0;J<a.PERCEPTION_POINTS_HORIZONTAL;J++)for(let w=1;w<=a.PERCEPTION_POINTS_VERTICAL;w++){let Ut=r*J+a.PERCEPTION_START_ANGLE+B+Math.PI/2,ge=E*w*Math.cos(Ut),Ee=E*w*Math.sin(Ut),Z=this.pos.copy().add(ge,Ee),$=t.getCellFromCoordsSafe(Z.x,Z.y);if($){if($.wall===1){if(w==1){let Q=Z.sub(this.pos);Q.setMag(this.maxSpeed),Q.sub(this.vel),Q.limit(this.maxForce),this.debug,Q.mult(-1),this.applyForce(Q)}break}if($.colony&&(this.state===f.REFILL||this.state===f.TO_HOME)){this.seek(Z);return}if($.food.quantity>0&&(this.state===f.TO_FOOD||this.state===f.REFILL)){this.debug&&this.perceptionDraw.add(w*a.PERCEPTION_POINTS_VERTICAL+J),this.seek(Z);return}let ut=0;this.state===f.TO_HOME||this.state===f.REFILL?ut=$.marker.intensity[0]:(this.state===f.TO_FOOD||this.state===f.REFILL)&&(ut=$.marker.intensity[1]),ut>m&&(m=ut,T=Z)}}if(T){this.seek(T);return}this.wander()}addMarker(t,e){if(this.markerClock+=e,this.markerClock>=a.MARKER_PERIOD){let[n,s]=t.getCellCoords(this.pos.x,this.pos.y);if(!t.checkCoords(n,s))return;let l=a.MARKER_DEFAULT_INTENSITY*Math.exp(-.15*this.internalClock),r=-1;switch(this.state){case f.TO_HOME:r=U.TO_FOOD;break;case f.TO_FOOD:r=U.TO_HOME;break;case f.REFILL:r=U.TO_HOME;break}t.addMarker(n,s,r,l),this.markerClock=0}}}class Ae{constructor(t){o(this,"id");o(this,"x");o(this,"y");o(this,"startingAntsCount");o(this,"maxAntsCount");o(this,"ants");o(this,"totalAnts");o(this,"colonyColor");o(this,"antIcon");o(this,"antId");o(this,"isRunning");o(this,"isDrawingAnts");o(this,"isDebugMode");o(this,"colonyClock");o(this,"antCtx");o(this,"selectedAnt");o(this,"food");o(this,"totalFood");o(this,"maxFood");this.id=t.id,this.x=t.pos.x,this.y=t.pos.y,this.startingAntsCount=v.COLONY_STARTING_ANTS,this.maxAntsCount=v.COLONY_MAX_ANTS,this.ants=[],this.totalAnts=0,this.colonyColor=t.colonyColor||[255,255,255],this.antIcon=null,this.antId=0,this.isRunning=!1,this.isDrawingAnts=!0,this.isDebugMode=!1,this.colonyClock=0,this.antCtx=null,this.selectedAnt=null,this.food=0,this.totalFood=0,this.maxFood=v.COLONY_MAX_FOOD}initialize(t,e,n){this.antIcon=t,this.antCtx=e;for(let l=0;l<this.startingAntsCount;l++){let r=new Kt(this.antCtx,t,{id:this.antId+1,pos:{x:this.x,y:this.y}});this.ants.push(r),this.antId++,this.totalAnts++}let s=n.getCellFromCoordsSafe(this.x,this.y);s&&(s.colony=!0)}updateAndDrawAnts(t,e){let n=!1;for(let s=0;s<this.ants.length;s++)this.isRunning&&(this.ants[s].search(t,this),this.ants[s].update(e),this.ants[s].addMarker(t,e),this.ants[s].isDead&&(n=!0)),this.isDrawingAnts&&this.ants[s].draw(),n&&(console.log("Removed ant: ",this.ants[s]),this.ants.splice(s,1),n=!1)}updateColony(t){!this.isRunning||(this.colonyClock+=t,this.colonyClock>=v.ANT_CREATION_PERIOD&&this.ants.length<this.maxAntsCount&&this.useFood(v.ANT_COST)&&(this.createAnt(),this.colonyClock=0))}createAnt(){if(this.ants.length<this.maxAntsCount&&this.antIcon&&this.antCtx){let t=new Kt(this.antCtx,this.antIcon,{id:this.antId+1,pos:{x:this.x,y:this.y}});this.ants.push(t),this.antId++,this.totalAnts++,this.isDebugMode&&console.log("Created ant: ",t)}else this.isDebugMode&&console.log("Can't create new ant - max count reached")}selectAnt(t){if(this.ants.length<=0)return null;let e=null,n=1/0,s=a.IMG_HEIGHT/2;for(const l of this.ants){let r=l.pos.dist(t);r<n&&r<s&&(n=r,e=l)}return this.selectedAnt=e,e}removeAnt(){if(this.selectedAnt==null||this.ants.length<=0)return!1;let t=this.ants.findIndex(e=>e.id===this.selectedAnt.id);return t!=-1?(this.ants.splice(t,1),this.selectedAnt=null,!0):!1}toggleAntDebug(){if(this.ants.length>0)for(const t of this.ants)this.selectedAnt&&t.id===this.selectedAnt.id?t.debug=this.isDebugMode:t.debug=!1}drawColony(t){t.fillStyle=`rgb(${this.colonyColor[0]}, ${this.colonyColor[1]}, ${this.colonyColor[2]})`,I(t,this.x,this.y,v.COLONY_RADIUS)}addFood(t){this.food=Math.min(this.food+t,this.maxFood),this.totalFood++}useFood(t){return this.food>=t?(this.food-=t,!0):!1}}class Te{constructor(){o(this,"fpsArray");o(this,"msArray");o(this,"index");o(this,"sampleSize");this.fpsArray=[],this.msArray=[],this.index=0,this.sampleSize=60}update(t,e){let n=0,s=0;this.fpsArray[this.index]=Math.round(t),this.msArray[this.index]=Math.round(e);for(let l=0;l<this.fpsArray.length;l++)n+=this.fpsArray[l],s+=this.msArray[l];return n/=this.fpsArray.length,s/=this.msArray.length,this.index++,this.index===this.sampleSize&&(this.index=0),[n,s]}}class H{constructor(t,e){o(this,"canvas");o(this,"width");o(this,"height");o(this,"cellSize");this.canvas=t,this.width=e.width,this.height=e.height,this.cellSize=e.cellSize}create(){return this.canvas.width=this.width,this.canvas.height=this.height,console.log(`Created canvas with size: ${this.width} x ${this.height}`),this.canvas.getContext("2d")}}function Se(i){let t=Math.round(i.width/i.cellSize),e=Math.round(i.height/i.cellSize),n=t*i.cellSize,s=e*i.cellSize;return console.log(`Calculate sizes:
${i.width==n?n:`${i.width} -> ${n}`} x ${i.height==s?s:`${i.height} -> ${s}`}`),[n,s]}class we{constructor(t){o(this,"quantity");this.quantity=t}draw(t,e,n){let s=e*g.SIZE+g.SIZE/2,l=n*g.SIZE+g.SIZE/2;t.fillStyle=`hsl(120, 40%, 43%, ${this.quantity/100})`,I(t,s,l,g.SIZE/2,!0)}pick(){let t=Math.max(this.quantity-g.PICK_AMOUNT,0);return this.quantity=Math.max(this.quantity-g.PICK_AMOUNT,0),t<g.PICK_AMOUNT?t:g.PICK_AMOUNT}}class Pe{constructor(t){o(this,"intensity");this.intensity=t}draw(t,e,n){let s=new p().set(ft.TO_HOME.slice()),l=new p().set(ft.TO_FOOD.slice()),r=s.mult(this.intensity[0]),E=l.mult(this.intensity[1]),m=r.add(E);m=new p().set(Math.round(Math.min(m.x,255)),Math.round(Math.min(m.y,255)),Math.round(Math.min(m.z,255))),t.fillStyle=`rgb(${m.x}, ${m.y}, ${m.z})`,t.fillRect(e,n,1,1)}getMixedColor(){let[t,e,n]=ft.TO_HOME,[s,l,r]=ft.TO_FOOD,E=[this.intensity[0]*t,this.intensity[0]*e,this.intensity[0]*n],m=[this.intensity[1]*s,this.intensity[1]*l,this.intensity[1]*r],T=[E[0]+m[0],E[1]+m[1],E[2]+m[2]];return T=[Math.round(Math.min(T[0],255)),Math.round(Math.min(T[1],255)),Math.round(Math.min(T[2],255))],T}update(){this.intensity[0]>0?this.intensity[0]-=Xt:this.intensity[0]=0,this.intensity[1]>0?this.intensity[1]-=Xt:this.intensity[1]=0}}class _e{constructor(){o(this,"marker");o(this,"food");o(this,"wall");o(this,"density");o(this,"colony");this.marker=new Pe([0,0]),this.food=new we(0),this.wall=0,this.density=0,this.colony=!1}update(){this.marker.update()}pick(){return this.food.pick()}drawWall(t,e,n){t.fillRect(e,n,1,1)}addDensity(){this.density++}}class xe{constructor(t){o(this,"width");o(this,"height");o(this,"cellSize");o(this,"cells");this.width=t.width,this.height=t.height,this.cellSize=t.cellSize,this.cells=[];for(let e=0;e<this.width*this.height;e++)this.cells.push(new _e)}initializeBorderWalls(){for(let t=0;t<this.width;t++){let e=this.cells[this.getIndexFromCoords(t,0)],n=this.cells[this.getIndexFromCoords(t,this.height-1)];e.wall=1,n.wall=1}for(let t=1;t<this.height-1;t++){let e=this.cells[this.getIndexFromCoords(0,t)],n=this.cells[this.getIndexFromCoords(this.width-1,t)];e.wall=1,n.wall=1}}update(){for(const t of this.cells)this.updateCell(t)}updateCell(t){t.marker.update(),t.density*=.99}addMarker(t,e,n,s){let l=this.cells[this.getIndexFromCoords(t,e)];n===U.TO_HOME?(l.marker.intensity[0]>0&&(s/=2),l.marker.intensity[0]=Math.min(1,l.marker.intensity[0]+s)):n===U.TO_FOOD&&(l.marker.intensity[1]>0&&(s/=2),l.marker.intensity[1]=Math.min(1,l.marker.intensity[1]+s))}addFood(t,e,n){let s=this.getIndexFromCoords(t,e);if(s>this.cells.length||s<0)return;let l=this.cells[s];l.food.quantity=Math.min(l.food.quantity+n,100)}drawMarkers(t,e,n=!0){for(let s=0;s<e.data.length;s+=4){let l=this.cells[s/4],r=l.marker.getMixedColor();e.data[s+0]=r[0],e.data[s+1]=r[1],e.data[s+2]=r[2],e.data[s+3]=255,n&&this.updateCell(l)}t.putImageData(e,0,0)}drawFood(t){for(let e=0;e<this.width;e++)for(let n=0;n<this.height;n++){let s=this.cells[this.getIndexFromCoords(e,n)];s.food.quantity>0&&s.food.draw(t,e,n)}}drawWalls(t){t.fillStyle="rgb(163, 163, 163)";for(let e=0;e<this.width;e++)for(let n=0;n<this.height;n++){let s=this.cells[this.getIndexFromCoords(e,n)];s.wall===1&&s.drawWall(t,e,n)}}drawDensity(t,e,n=!0){for(let s=0;s<e.data.length;s+=4){let l=this.cells[s/4],r=l.density;e.data[s+0]=4*r,e.data[s+1]=r,e.data[s+2]=r,e.data[s+3]=255,n&&this.updateCell(l)}t.putImageData(e,0,0)}isOnFood(t,e){return this.cells[this.getIndexFromCoords(t,e)].food.quantity>0}getIndexFromCoords(t,e){return t+e*this.width}getCellCoords(t,e){let n=Math.floor(t/u.SIZE),s=Math.floor(e/u.SIZE);return[n,s]}getCellFromCoords(t,e,n=!1){return n||([t,e]=this.getCellCoords(t,e)),this.cells[this.getIndexFromCoords(t,e)]}getCellFromCoordsSafe(t,e){let[n,s]=this.getCellCoords(t,e);return this.checkCoords(n,s)?this.getCellFromCoords(n,s,!0):null}checkCoords(t,e){return t>-1&&t<this.width&&e>-1&&e<this.height}}const N=document.getElementById("canvas-container"),Me=document.getElementById("camera-container"),be=document.getElementById("btn-fullscreen"),Re=document.getElementById("btn-pan"),Ne=document.getElementById("canvas"),te=document.getElementById("canvas-markers"),ee=document.getElementById("canvas-food"),Fe=document.getElementById("canvas-colony"),ie=document.getElementById("canvas-walls"),rt=document.getElementById("canvas-edit"),ht=document.getElementById("canvas-edit-preview"),Vt=document.getElementById("antIcon"),Et=document.getElementById("btn-ant-panel"),$t=document.getElementById("antPanel"),Le=document.querySelector("[data-id]"),ve=document.querySelector("[data-pos]"),ke=document.querySelector("[data-vel]"),De=document.querySelector("[data-state]"),Nt=document.getElementById("btn-track"),ze=document.getElementById("btn-remove"),Ft=document.getElementById("btn-cell-panel"),se=document.getElementById("cellPanel"),He=document.querySelector("[data-cell-preview]"),Be=document.querySelector("[data-intensity-home]"),Ze=document.querySelector("[data-intensity-food]"),$e=document.querySelector("[data-cell-food]"),Lt=document.getElementById("btn-colony-panel"),ne=document.getElementById("colonyPanel"),qe=document.querySelector("[data-colony-preview]"),Ge=document.querySelector("[data-colony-pop]"),We=document.querySelector("[data-colony-food]"),Ue=document.querySelector("[data-pause]"),le=document.getElementById("btn-play"),oe=document.getElementById("btn-pause"),vt=document.getElementById("btn-edit-mode"),ae=document.getElementById("editPanel"),jt=document.querySelector("[data-brush-preview]"),Ye=document.querySelector("[data-brush-size]"),kt=document.getElementById("brushSizeInput"),It=document.getElementById("btn-wall-brush"),Dt=document.getElementById("btn-food-brush"),Xe=document.getElementById("btn-save"),Ke=document.getElementById("btn-controls"),Ve=document.getElementById("btn-close-controls"),re=document.getElementById("controlsPanel"),je=document.querySelector("[data-fps]"),xt=document.querySelector("[data-ms]");let b=!1,it=!0,st=!1,k=!1,gt=!1,F=!1,zt=!1,Ht=!1,R=!1,D=!1,Bt=!1,pt=!1,nt=!1,_=!1,lt=!1,Mt=0,Je=new Te,K=N.getBoundingClientRect().top,At=0,Tt=0,h=1,G=!1,Ct=!1,bt=0,W={x:0,y:0},d={x:0,y:0},L=5,[O,A]=Se({width:Yt.WIDTH,height:Yt.HEIGHT,cellSize:u.SIZE}),Qe=new H(te,{width:O/u.SIZE,height:A/u.SIZE,cellSize:1});te.style.transform=`scale(${u.SIZE})`;let C=Qe.create(),ti=new H(ee,{width:O/(u.SIZE/g.SIZE),height:A/(u.SIZE/g.SIZE),cellSize:u.SIZE/g.SIZE});ee.style.transform=`scale(${u.SIZE/g.SIZE})`;let ot=ti.create(),ei=new H(Ne,{width:O,height:A,cellSize:u.SIZE}),z=ei.create(),ii=new H(Fe,{width:O,height:A,cellSize:u.SIZE}),Zt=ii.create(),si=new H(ie,{width:O/u.SIZE,height:A/u.SIZE,cellSize:1});ie.style.transform=`scale(${u.SIZE})`;let X=si.create(),ni=new H(rt,{width:O/u.SIZE,height:A/u.SIZE,cellSize:1});rt.style.transform=`scale(${u.SIZE})`;let P=ni.create(),li=new H(ht,{width:O/u.SIZE,height:A/u.SIZE,cellSize:1});ht.style.transform=`scale(${u.SIZE})`;let et=li.create(),c=new xe({width:O/u.SIZE,height:A/u.SIZE,cellSize:1}),Ot=C==null?void 0:C.createImageData(c.width,c.height),Jt=C==null?void 0:C.createImageData(c.width,c.height),y=new Ae({id:1,pos:{x:O/2,y:A/2}});window.addEventListener("keydown",i=>{switch(i.code){case"Space":qt();break;case"KeyM":ai();break;case"KeyN":ri();break;case"KeyA":ci();break;case"KeyD":hi();break;case"KeyT":de();break;case"KeyC":Gt();break;case"Delete":ue();break;case"KeyF":Bt=!Bt;break;case"ArrowUp":mt(0,yt);break;case"ArrowDown":mt(0,-yt);break;case"ArrowLeft":mt(yt,0);break;case"ArrowRight":mt(-yt,0);break;case"Minus":Qt(!1);break;case"Equal":Qt(!0);break}});N.addEventListener("mousemove",i=>{At=i.pageX,Tt=i.pageY-K});N.addEventListener("click",()=>{if(Ct){Ct=!1;return}di(),k&&ce()});N.addEventListener("contextmenu",i=>{i.preventDefault();let t=Y(Math.floor((At/h-d.x)/u.SIZE),Math.floor((Tt/h-d.y)/u.SIZE));k&&console.log(`Placed food at: ${t.x}:${t.y}`),c.addFood(t.x,t.y,10)});N.addEventListener("wheel",i=>{Ei(i)});be.addEventListener("click",()=>{Gt()});Nt.addEventListener("click",()=>{de()});ze.addEventListener("click",()=>{ue()});le.addEventListener("click",()=>{qt()});oe.addEventListener("click",()=>{qt()});Lt.addEventListener("click",()=>{pt=S(pt,ne,Lt)});pt=S(pt,ne,Lt);Ft.addEventListener("click",()=>{nt=S(nt,se,Ft)});Et.addEventListener("click",()=>{_=S(_,$t,Et)});Ke.addEventListener("click",()=>{lt=S(lt,re)});Ve.addEventListener("click",()=>{lt=!0,lt=S(lt,re)});vt.addEventListener("click",()=>{F=S(F,ae,vt),F?(rt.style.display="block",ht.style.display="block"):(rt.style.display="none",ht.style.display="none")});It.addEventListener("click",()=>{R=at(R,It),R&&(D=!0,D=at(R,Dt))});Dt.addEventListener("click",()=>{D=at(D,Dt),D&&(R=!0,R=at(D,It))});Xe.addEventListener("click",()=>{if(P&&X){let i=P.getImageData(0,0,c.width,c.height);X.clearRect(0,0,c.width,c.height);for(let t=0;t<i.data.length;t+=4){let e=c.cells[t/4],n=i.data[t+0],s=i.data[t+1],l=i.data[t+2],r=i.data[t+3];s<=160&&s>0&&s>n&&s>l?e.wall!==1?e.food.quantity=Math.round(100*(r/255)):e.wall=1:n>10&&s>10&&l>10&&n===s&&s===l?(e.wall=1,e.food.quantity=0):r>0&&(e.food.quantity=0,e.wall=0)}c.initializeBorderWalls(),c.drawWalls(X),P.clearRect(0,0,c.width,c.height),F=S(F,ae,vt),rt.style.display="none",ht.style.display="none"}});kt.addEventListener("input",()=>{L=parseInt(kt.value),he()});function he(){jt.style.width=`${L}px`,jt.style.height=`${L}px`,Ye.textContent=`${L} px`}kt.value=L.toString();he();R=at(R,It);oi();gi();Gt();window.requestAnimationFrame(fe);function oi(){if(!(C==null||ot==null||z==null||Zt==null||X==null||P==null||et==null)){if(Ot&&(c.drawMarkers(C,Ot),c.drawFood(ot)),Vt){let i=new XMLSerializer().serializeToString(Vt),t=btoa(i),n="data:image/svg+xml;base64,"+t,s=new Image;s.src=n,s.onload=()=>{z.drawImage(s,100,50,24,34),y.initialize(s,z,c)}}y.drawColony(Zt),c.initializeBorderWalls(),c.drawWalls(X)}}function qt(){b=!b,y.isRunning=b,Ue.style.display=b?"none":"block",le.style.display=b?"none":"flex",oe.style.display=b?"flex":"none"}function ai(){it=!it,it&&(st=!1)}function ri(){st=!st,st&&(it=!1)}function hi(){k=!k,y.isDebugMode=k,ce(),k&&(nt=!1),nt=S(nt,se,Ft)}function ce(){y.toggleAntDebug()}function de(){y.selectedAnt!=null&&(gt=!gt,gt&&(h=3),Nt.classList.toggle("border-green-500"),Nt.classList.toggle("border-red-500"))}function Rt(){Re.classList.toggle("bg-neutral-600")}function ci(){y.isDrawingAnts=!y.isDrawingAnts}function di(){let i=Y(At/h-d.x,Tt/h-d.y);y.selectAnt(i),y.selectedAnt?_=!1:_=!0,_=S(_,$t,Et)}function ue(){y.removeAnt()?_=!0:_=!1,_=S(_,$t,Et)}function ui(){let i=y.selectedAnt;if(!i)return;Le.textContent=i.id.toString(),ve.textContent=`${i.pos.x.toFixed(2)} : ${i.pos.y.toFixed(2)}`,ke.textContent=`${i.vel.x.toFixed(2)} : ${i.vel.y.toFixed(2)}`;let t="";switch(i.state){case f.TO_HOME:t="To Home";break;case f.TO_FOOD:t="To Food";break;case f.REFILL:t="Refill";break}De.textContent=t}function fi(i,t){let e=c.getCellFromCoordsSafe(i,t);if(!e)return;Be.textContent=e.marker.intensity[0].toFixed(2),Ze.textContent=e.marker.intensity[1].toFixed(2),$e.textContent=e.food.quantity.toString();let n=e.marker.getMixedColor();He.style.backgroundColor=`rgb(${n[0]}, ${n[1]}, ${n[2]})`}function yi(){if(!y)return;Ge.textContent=`${y.ants.length} | ${y.totalAnts}`,We.textContent=`${y.food} | ${y.totalFood}`;let i=y.colonyColor;qe.style.backgroundColor=`rgb(${i[0]}, ${i[1]}, ${i[2]})`}function mi(i,t){let[e,n]=Je.update(i,t);je.textContent=`${Math.round(e*100)/100} fps`,xt.textContent=`${Math.round(n*100)/100} ms`,n>16.7?xt.classList.add("text-red-500"):xt.classList.remove("text-red-500")}function gi(){N.addEventListener("mousedown",i=>{if(clearTimeout(bt),i.buttons==_t&&F)Ht=!0;else if(i.buttons==_t)return;if(i.buttons==Oe)G=!0,Ct=!1,Rt(),document.body.classList.add("cursor-grabbing"),W.x=i.clientX/h-d.x,W.y=(i.clientY-K)/h-d.y;else{if(F){zt=!0;return}G=!1,bt=setTimeout(()=>{G=!0,Ct=!0,Rt(),document.body.classList.add("cursor-grabbing"),W.x=i.clientX/h-d.x,W.y=(i.clientY-K)/h-d.y},100)}}),N.addEventListener("mousemove",i=>{!G||i.buttons==_t||Ii(i)}),N.addEventListener("mouseup",()=>{clearTimeout(bt),zt=!1,Ht=!1,G&&(G=!1,Rt(),document.body.classList.remove("cursor-grabbing"))})}function Ei(i){let t={x:0,y:0};t.x=i.clientX/h-d.x,t.y=(i.clientY-K)/h-d.y,h*=.999**i.deltaY,h=Math.min(Math.max(.15,h),16),d.x=i.clientX/h-t.x,d.y=(i.clientY-K)/h-t.y,V()}function Ii(i){d.x=i.clientX/h-W.x,d.y=(i.clientY-K)/h-W.y,V()}function mt(i,t){d.x+=i,d.y+=t,V()}function Qt(i){let t={x:0,y:0};t.x=window.innerWidth/2/h-d.x,t.y=window.innerWidth/2/h-d.y,h*=.999**(i?-100:100),h=Math.min(Math.max(.15,h),16),d.x=window.innerWidth/2/h-t.x,d.y=window.innerWidth/2/h-t.y,V()}function Gt(){let i={x:window.innerWidth/2-O/2,y:window.innerHeight/2-A/2};h=1,d.x=i.x,d.y=i.y,V()}function pi(i,t){let e={x:window.innerWidth/2/h-i,y:window.innerHeight/2/h-t};d.x=e.x,d.y=e.y,V()}function V(){Me.style.transform=`scale(${h}) translate(${d.x}px, ${d.y}px)`}function fe(i){if(C==null||ot==null||z==null||Zt==null||X==null||P==null||et==null)return;window.requestAnimationFrame(fe);const t=(i-Mt)/1e3;Bt&&mi(1/t,i-Mt),z.clearRect(0,0,O,A),C.clearRect(0,0,c.width,c.height),ot.clearRect(0,0,O/(u.SIZE/g.SIZE),A/(u.SIZE/g.SIZE)),it&&Ot?c.drawMarkers(C,Ot,b):st&&Jt?c.drawDensity(C,Jt,b):b&&c.update(),c.drawFood(ot);let e=Y(At/h-d.x,Tt/h-d.y);if(F){et.clearRect(0,0,c.width,c.height),et.fillStyle="grey";let n=c.getCellCoords(e.x,e.y);I(et,n[0],n[1],L),Ht?(P.fillStyle="black",I(P,n[0],n[1],L)):zt&&(R?P.fillStyle="rgb(163, 163, 163)":D&&(P.fillStyle="rgb(66, 153, 66, 0.25)"),I(P,n[0],n[1],L))}y.updateColony(t),y.updateAndDrawAnts(c,t),ui(),gt&&y.selectedAnt&&pi(y.selectedAnt.pos.x,y.selectedAnt.pos.y),k&&(z.fillStyle="red",I(z,e.x,e.y,4),fi(e.x,e.y)),yi(),Mt=i}
