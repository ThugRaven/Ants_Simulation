var Te=Object.defineProperty;var xe=(s,t,e)=>t in s?Te(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var l=(s,t,e)=>(xe(s,typeof t!="symbol"?t+"":t,e),e);const Pe=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function e(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerpolicy&&(o.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?o.credentials="include":n.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=e(n);fetch(n.href,o)}};Pe();const Kt={WIDTH:1600*3,HEIGHT:1200*3},$t={FILL_RATIO:.47,BORDER_SIZE:1};var Q=(s=>(s[s.TO_HOME=0]="TO_HOME",s[s.TO_FOOD=1]="TO_FOOD",s))(Q||{});const jt={TO_HOME:[255,0,0],TO_FOOD:[43,255,0]},u={WIDTH:16,HEIGHT:16,SIZE:16},Jt=2e-4,v={COLONY_RADIUS:50,COLONY_STARTING_ANTS:50,COLONY_MAX_ANTS:500,COLONY_MAX_FOOD:3e4,ANT_CREATION_PERIOD:.15,ANT_COST:30,ANT_REFILL_FOOD_AMOUNT:.25};var y=(s=>(s[s.TO_HOME=0]="TO_HOME",s[s.TO_FOOD=1]="TO_FOOD",s[s.REFILL=2]="REFILL",s))(y||{});const r={IMG_WIDTH:24,IMG_HEIGHT:34,WANDER_DISPLACE_RANGE:.5,WANDER_POINT_MAGNITUDE:100,WANDER_POINT_RADIUS:50,PERCEPTION_RADIUS:80,PERCEPTION_START_ANGLE:7/6*Math.PI,PERCEPTION_END_ANGLE:11/6*Math.PI,PERCEPTION_POINTS_HORIZONTAL:8,PERCEPTION_POINTS_VERTICAL:5,DIRECTION_PERIOD:.1,MARKER_PERIOD:.15,MARKER_DEFAULT_INTENSITY:1,AUTONOMY_MAX:300,AUTONOMY_REFILL:150,FOOD_SIZE:16},p={SIZE:15,PICK_AMOUNT:2},_t=2,_e=4,yt=u.SIZE,q={MIN_SIZE:1,MAX_SIZE:75,STEP:1};function O(s,t,e,i,n=!0,o=!1){s.beginPath(),s.arc(t,e,i,0,Math.PI*2),n&&s.fill(),o&&s.stroke()}function V(s,t,e,i,n){s.beginPath(),s.moveTo(t,e),s.lineTo(i,n),s.stroke(),s.closePath()}function K(s,t){return Math.random()*(t-s)+s}function S(s,t,e){return s=!s,s?(t.style.display="block",e==null||e.classList.add("border-green-500"),e==null||e.classList.remove("border-red-500")):(t.style.display="none",e==null||e.classList.add("border-red-500"),e==null||e.classList.remove("border-green-500")),s}function dt(s,t){return s=!s,s?(t.classList.add("border-green-500"),t.classList.remove("border-red-500")):(t.classList.add("border-red-500"),t.classList.remove("border-green-500")),s}class R{constructor(t,e,i){l(this,"x");l(this,"y");l(this,"z");this.x=t||0,this.y=e||0,this.z=i||0}set(t,e,i){return t instanceof R?(this.x=t.x||0,this.y=t.y||0,this.z=t.z||0,this):t instanceof Array?(this.x=t[0]||0,this.y=t[1]||0,this.z=t[2]||0,this):(this.x=t||0,this.y=e||0,this.z=i||0,this)}copy(){return new R(this.x,this.y,this.z)}add(t,e,i){return t instanceof R?(this.x+=t.x||0,this.y+=t.y||0,this.z+=t.z||0,this):t instanceof Array?(this.x+=t[0]||0,this.y+=t[1]||0,this.z+=t[2]||0,this):(this.x+=t||0,this.y+=e||0,this.z+=i||0,this)}sub(t,e,i){return t instanceof R?(this.x-=t.x||0,this.y-=t.y||0,this.z-=t.z||0,this):t instanceof Array?(this.x-=t[0]||0,this.y-=t[1]||0,this.z-=t[2]||0,this):(this.x-=t||0,this.y-=e||0,this.z-=i||0,this)}mult(t,e,i){if(t instanceof R)return Number.isFinite(t.x)&&Number.isFinite(t.y)&&Number.isFinite(t.z)&&typeof t.x=="number"&&typeof t.y=="number"&&typeof t.z=="number"?(this.x*=t.x,this.y*=t.y,this.z*=t.z):console.warn("Vector.mult:","x contains components that are either undefined or not finite numbers"),this;if(t instanceof Array)return t.every(o=>Number.isFinite(o))&&t.every(o=>typeof o=="number")?t.length===1?(this.x*=t[0],this.y*=t[0],this.z*=t[0]):t.length===2?(this.x*=t[0],this.y*=t[1]):t.length===3&&(this.x*=t[0],this.y*=t[1],this.z*=t[2]):console.warn("Vector.mult:","x contains elements that are either undefined or not finite numbers"),this;const n=[...arguments];return n.every(o=>Number.isFinite(o))&&n.every(o=>typeof o=="number")?(arguments.length===1&&(this.x*=t,this.y*=t,this.z*=t),arguments.length===2&&(this.x*=t,this.y*=e||0),arguments.length===3&&(this.x*=t,this.y*=e||0,this.z*=i||0)):console.warn("Vector.mult:","x, y, or z arguments are either undefined or not a finite number"),this}div(t,e,i){if(t instanceof R){if(Number.isFinite(t.x)&&Number.isFinite(t.y)&&Number.isFinite(t.z)&&typeof t.x=="number"&&typeof t.y=="number"&&typeof t.z=="number"){if(t.x===0||t.y===0||t.z===0)return console.warn("Vector.div:","divide by 0"),this;this.x/=t.x,this.y/=t.y,this.z/=t.z}else console.warn("Vector.div:","x contains components that are either undefined or not finite numbers");return this}if(t instanceof Array){if(t.every(o=>Number.isFinite(o))&&t.every(o=>typeof o=="number")){if(t.some(o=>o===0))return console.warn("Vector.div:","divide by 0"),this;t.length===1?(this.x/=t[0],this.y/=t[0],this.z/=t[0]):t.length===2?(this.x/=t[0],this.y/=t[1]):t.length===3&&(this.x/=t[0],this.y/=t[1],this.z/=t[2])}else console.warn("Vector.div:","x contains components that are either undefined or not finite numbers");return this}const n=[...arguments];if(n.every(o=>Number.isFinite(o))&&n.every(o=>typeof o=="number")){if(n.some(o=>o===0))return console.warn("Vector.div:","divide by 0"),this;arguments.length===1&&(this.x/=t,this.y/=t,this.z/=t),arguments.length===2&&(this.x/=t,this.y/=e||0),arguments.length===3&&(this.x/=t,this.y/=e||0,this.z/=i||0)}else console.warn("Vector.div:","x, y, or z arguments are either undefined or not a finite number");return this}mag(){return Math.sqrt(this.magSq())}magSq(){const t=this.x,e=this.y,i=this.z;return t*t+e*e+i*i}dist(t){return t.copy().sub(this).mag()}normalize(){const t=this.mag();return t!==0&&this.mult(1/t),this}limit(t){const e=this.magSq();return e>t*t&&this.div(Math.sqrt(e)).mult(t),this}setMag(t){return this.normalize().mult(t)}heading(){return Math.atan2(this.y,this.x)}setHeading(t){let e=this.mag();return this.x=e*Math.cos(t),this.y=e*Math.sin(t),this}rotate(t){let e=this.heading()+t;const i=this.mag();return this.x=Math.cos(e)*i,this.y=Math.sin(e)*i,this}equals(t,e,i){let n,o,a;return t instanceof R?(n=t.x||0,o=t.y||0,a=t.z||0):t instanceof Array?(n=t[0]||0,o=t[1]||0,a=t[2]||0):(n=t||0,o=e||0,a=i||0),this.x===n&&this.y===o&&this.z===a}}function tt(s,t,e){return new R(s,t,e)}class Qt{constructor(t,e,i,n,o){l(this,"ctx");l(this,"antImageInstance");l(this,"antFoodImageInstance");l(this,"antIcon");l(this,"id");l(this,"pos");l(this,"vel");l(this,"acc");l(this,"maxSpeed");l(this,"maxForce");l(this,"state");l(this,"debug");l(this,"wanderTheta");l(this,"perceptionDraw");l(this,"internalClock");l(this,"markerClock");l(this,"directionClock");l(this,"isDead");l(this,"freedomCoef");l(this,"foodAmount");l(this,"maxAutonomy");this.ctx=t,this.antImageInstance=e,this.antFoodImageInstance=i,this.antIcon=n,this.id=o.id,this.pos=tt(o.pos.x,o.pos.y),this.vel=tt(0,0),this.acc=tt(0,0),this.maxSpeed=3,this.maxForce=.25,this.state=y.TO_FOOD,this.debug=o.debug||!1,this.wanderTheta=K(0,Math.PI*2),this.perceptionDraw=new Set,this.internalClock=0,this.markerClock=K(0,r.MARKER_PERIOD),this.directionClock=0,this.isDead=!1,this.freedomCoef=K(.01,.1),this.foodAmount=0,this.maxAutonomy=r.AUTONOMY_MAX-K(0,50)}seek(t){this.debug&&(this.ctx.strokeStyle="white",V(this.ctx,t.x,t.y,this.pos.x,this.pos.y));let e=t.copy().sub(this.pos);e.setMag(this.maxSpeed),e.sub(this.vel),e.limit(this.maxForce),this.applyForce(e)}wander(){let t=this.vel.copy();t.setMag(r.WANDER_POINT_MAGNITUDE),t.add(this.pos);let e=r.WANDER_POINT_RADIUS;this.debug&&(this.ctx.fillStyle="red",O(this.ctx,t.x,t.y,4),this.ctx.strokeStyle="white",O(this.ctx,t.x,t.y,e,!1,!0),V(this.ctx,this.pos.x,this.pos.y,t.x,t.y));let i=this.wanderTheta+this.vel.heading(),n=e*Math.cos(i),o=e*Math.sin(i);t.add(n,o),this.debug&&(this.ctx.fillStyle="green",O(this.ctx,t.x,t.y,8),V(this.ctx,this.pos.x,this.pos.y,t.x,t.y));let a=t.sub(this.pos);a.setMag(this.maxForce),a.limit(this.maxForce),this.applyForce(a);let h=r.WANDER_DISPLACE_RANGE;this.wanderTheta+=K(-h,h)}applyForce(t){this.acc.add(t)}update(t){this.internalClock+=t,this.directionClock+=t,this.internalClock>=r.AUTONOMY_REFILL&&this.state===y.TO_FOOD&&(this.state=y.REFILL),this.internalClock>=this.maxAutonomy&&(this.isDead=!0),this.vel.add(this.acc),this.vel.limit(this.maxSpeed),this.pos.add(this.vel),this.acc.set(0,0)}draw(){this.ctx.save(),this.ctx.translate(this.pos.x,this.pos.y),this.ctx.rotate(this.vel.heading()+Math.PI/2);let t=-r.IMG_WIDTH/2,e=-r.IMG_HEIGHT/2;if(this.state===y.TO_HOME&&this.ctx.drawImage(this.antFoodImageInstance,-r.FOOD_SIZE/2,e-r.FOOD_SIZE/2),this.ctx.drawImage(this.antImageInstance,t,e),this.debug){this.ctx.strokeStyle="#FF0000",this.ctx.lineWidth=2,this.ctx.strokeRect(t,e,r.IMG_WIDTH,r.IMG_HEIGHT),this.ctx.fillStyle="red",O(this.ctx,0,0,4),this.ctx.beginPath(),this.ctx.arc(0,0,r.PERCEPTION_RADIUS,r.PERCEPTION_START_ANGLE,r.PERCEPTION_END_ANGLE),this.ctx.stroke(),this.ctx.strokeStyle="white",this.ctx.beginPath(),this.ctx.arc(0,0,r.PERCEPTION_RADIUS,r.PERCEPTION_END_ANGLE,r.PERCEPTION_START_ANGLE),this.ctx.stroke();let i=r.PERCEPTION_START_ANGLE,n=r.PERCEPTION_END_ANGLE,o=r.PERCEPTION_RADIUS*Math.cos(i),a=r.PERCEPTION_RADIUS*Math.sin(i),h=r.PERCEPTION_RADIUS*Math.cos(n),f=r.PERCEPTION_RADIUS*Math.sin(n);this.ctx.strokeStyle="red",V(this.ctx,0,0,o,a),V(this.ctx,0,0,h,f);let g=(r.PERCEPTION_END_ANGLE-r.PERCEPTION_START_ANGLE)/(r.PERCEPTION_POINTS_HORIZONTAL-1),st=r.PERCEPTION_RADIUS/r.PERCEPTION_POINTS_VERTICAL;for(let k=0;k<r.PERCEPTION_POINTS_HORIZONTAL;k++)for(let x=1;x<=r.PERCEPTION_POINTS_VERTICAL;x++){let Z=g*k+r.PERCEPTION_START_ANGLE,nt=st*x*Math.cos(Z),ot=st*x*Math.sin(Z);this.perceptionDraw.has(x*r.PERCEPTION_POINTS_VERTICAL+k)?(this.ctx.strokeStyle="white",this.ctx.fillStyle="white"):(this.ctx.strokeStyle="red",this.ctx.fillStyle="green"),O(this.ctx,nt,ot,4),x===r.PERCEPTION_POINTS_VERTICAL&&V(this.ctx,0,0,nt,ot)}}this.ctx.restore(),this.debug&&(this.ctx.fillStyle="white",O(this.ctx,this.pos.x,this.pos.y,3))}search(t,e){this.debug&&(this.perceptionDraw=new Set);let i=this.vel.copy();i.setMag(r.IMG_HEIGHT/2),i.add(this.pos);let n=t.getCellFromCoordsSafe(i.x,i.y),o=t.getCellFromCoordsSafe(this.pos.x,this.pos.y);if(o==null||o.addDensity(),n&&n.food.quantity>0&&(this.state===y.TO_FOOD||this.state===y.REFILL)){this.state=y.TO_HOME,this.foodAmount=n.pick(),this.vel.setHeading(this.vel.heading()+Math.PI),this.internalClock=0;return}if(o&&o.colony&&(this.state===y.REFILL||this.state===y.TO_HOME)){if(this.state===y.TO_HOME&&(this.vel.setHeading(this.vel.heading()+Math.PI),e.addFood(this.foodAmount)),this.state===y.REFILL&&!e.useFood(v.ANT_REFILL_FOOD_AMOUNT))return;this.state=y.TO_FOOD,this.internalClock=0;return}if(Math.random()<this.freedomCoef)return;let a=(r.PERCEPTION_END_ANGLE-r.PERCEPTION_START_ANGLE)/(r.PERCEPTION_POINTS_HORIZONTAL-1),h=r.PERCEPTION_RADIUS/r.PERCEPTION_POINTS_VERTICAL,f=r.PERCEPTION_POINTS_VERTICAL+1,g=null,st=0,k=null,x=this.vel.heading(),Z=-r.IMG_WIDTH/2,nt=Math.PI/4+x+Math.PI,ot=-Math.PI/4+x+Math.PI,Ce=Z*Math.cos(nt),Oe=Z*Math.sin(nt),Ae=Z*Math.cos(ot),Me=Z*Math.sin(ot),Tt=this.pos.copy().add(Ce,Oe),xt=this.pos.copy().add(Ae,Me),Pt=t.getCellFromCoordsSafe(Tt.x,Tt.y),Yt=t.getCellFromCoordsSafe(xt.x,xt.y);if(Pt&&Pt.wall===1||Yt&&Yt.wall===1){let C=(Pt?Tt:xt).sub(this.pos);C.sub(this.vel),C.mult(-1),this.applyForce(C);return}if(this.directionClock>=r.DIRECTION_PERIOD){for(let D=0;D<r.PERCEPTION_POINTS_HORIZONTAL;D++)for(let C=1;C<=r.PERCEPTION_POINTS_VERTICAL;C++){let Vt=a*D+r.PERCEPTION_START_ANGLE+x+Math.PI/2,Se=h*C*Math.cos(Vt),we=h*C*Math.sin(Vt),G=this.pos.copy().add(Se,we),U=t.getCellFromCoordsSafe(G.x,G.y);if(U){if(U.wall===1&&(C===1||C===2)){let Y=G.sub(this.pos),Xt=D+1>r.PERCEPTION_POINTS_HORIZONTAL/2?r.PERCEPTION_POINTS_HORIZONTAL-D:D+1;Y.setMag(this.maxSpeed),Y.sub(this.vel),C===1?Y.limit(this.maxForce*Xt):C===2&&Y.limit(this.maxForce*.5*Xt),Y.mult(-1),this.applyForce(Y);break}if(U.colony&&(this.state===y.REFILL||this.state===y.TO_HOME)){this.seek(G);return}if(U.food.quantity>0&&(this.state===y.TO_FOOD||this.state===y.REFILL)){this.debug&&this.perceptionDraw.add(C*r.PERCEPTION_POINTS_VERTICAL+D),C<f&&(f=C,g=G);break}let mt=0;this.state===y.TO_HOME||this.state===y.REFILL?mt=U.marker.intensity[0]:(this.state===y.TO_FOOD||this.state===y.REFILL)&&(mt=U.marker.intensity[1]),mt>st&&(st=mt,k=G)}}if(g){this.seek(g);return}if(k){this.seek(k);return}this.directionClock=0}this.wander()}addMarker(t,e){if(this.markerClock+=e,this.markerClock>=r.MARKER_PERIOD){let[i,n]=t.getCellCoords(this.pos.x,this.pos.y);if(!t.checkCoords(i,n))return;let o=r.MARKER_DEFAULT_INTENSITY*Math.exp(-.15*this.internalClock),a=-1;switch(this.state){case y.TO_HOME:a=Q.TO_FOOD;break;case y.TO_FOOD:a=Q.TO_HOME;break;case y.REFILL:a=Q.TO_HOME;break}t.addMarker(i,n,a,o),this.markerClock=0}}}class Re{constructor(t){l(this,"id");l(this,"x");l(this,"y");l(this,"startingAntsCount");l(this,"maxAntsCount");l(this,"ants");l(this,"totalAnts");l(this,"colonyColor");l(this,"antIcon");l(this,"antImageInstance");l(this,"antFoodImageInstance");l(this,"antId");l(this,"isRunning");l(this,"isDrawingAnts");l(this,"isDebugMode");l(this,"colonyClock");l(this,"antsCtx");l(this,"selectedAnt");l(this,"food");l(this,"totalFood");l(this,"maxFood");this.id=t.id,this.x=t.pos.x,this.y=t.pos.y,this.startingAntsCount=v.COLONY_STARTING_ANTS,this.maxAntsCount=v.COLONY_MAX_ANTS,this.ants=[],this.totalAnts=0,this.colonyColor=t.colonyColor||[255,255,255],this.antIcon=null,this.antImageInstance=null,this.antFoodImageInstance=null,this.antId=0,this.isRunning=!1,this.isDrawingAnts=!0,this.isDebugMode=!1,this.colonyClock=0,this.antsCtx=null,this.selectedAnt=null,this.food=0,this.totalFood=0,this.maxFood=v.COLONY_MAX_FOOD}initialize(t,e,i,n,o){this.antIcon=t,this.antImageInstance=e,this.antFoodImageInstance=i,this.antsCtx=n;for(let h=0;h<this.startingAntsCount;h++){let f=new Qt(n,e,i,t,{id:this.antId+1,pos:{x:this.x,y:this.y}});this.ants.push(f),this.antId++,this.totalAnts++}let a=Math.floor(v.COLONY_RADIUS/u.SIZE);for(let h=0;h<a;h++){let f=o.getCellFromCoordsSafe(this.x-a/2*u.SIZE+h*u.SIZE,this.y),g=o.getCellFromCoordsSafe(this.x,this.y-a/2*u.SIZE+h*u.SIZE);f&&g&&(f.colony=!0,g.colony=!0)}}updateAndDrawAnts(t,e){let i=!1;for(let n=0;n<this.ants.length;n++)this.isRunning&&(this.ants[n].search(t,this),this.ants[n].update(e),this.ants[n].addMarker(t,e),this.ants[n].isDead&&(i=!0)),this.isDrawingAnts&&this.ants[n].draw(),i&&(console.log("Removed ant: ",this.ants[n]),this.ants.splice(n,1),i=!1)}updateColony(t){!this.isRunning||(this.colonyClock+=t,this.colonyClock>=v.ANT_CREATION_PERIOD&&this.ants.length<this.maxAntsCount&&this.useFood(v.ANT_COST)&&(this.createAnt(),this.colonyClock=0))}createAnt(){if(this.ants.length<this.maxAntsCount&&this.antIcon&&this.antImageInstance&&this.antFoodImageInstance&&this.antsCtx){let t=new Qt(this.antsCtx,this.antImageInstance,this.antFoodImageInstance,this.antIcon,{id:this.antId+1,pos:{x:this.x,y:this.y}});this.ants.push(t),this.antId++,this.totalAnts++,this.isDebugMode&&console.log("Created ant: ",t)}else this.isDebugMode&&console.log("Can't create new ant - max count reached")}selectAnt(t){if(this.ants.length<=0)return null;let e=null,i=1/0,n=r.IMG_HEIGHT/2;for(const o of this.ants){let a=o.pos.dist(t);a<i&&a<n&&(i=a,e=o)}return this.selectedAnt=e,e}removeAnt(){if(this.selectedAnt==null||this.ants.length<=0)return!1;let t=this.ants.findIndex(e=>e.id===this.selectedAnt.id);return t!=-1?(this.ants.splice(t,1),this.selectedAnt=null,!0):!1}toggleAntDebug(){if(this.ants.length>0)for(const t of this.ants)this.selectedAnt&&t.id===this.selectedAnt.id?t.debug=this.isDebugMode:t.debug=!1}drawColony(t){t.fillStyle=`rgb(${this.colonyColor[0]}, ${this.colonyColor[1]}, ${this.colonyColor[2]})`,O(t,this.x,this.y,v.COLONY_RADIUS)}addFood(t){this.food=Math.min(this.food+t,this.maxFood),this.totalFood+=t}useFood(t){return this.food>=t?(this.food-=t,!0):!1}}class le{constructor(t){l(this,"width");l(this,"height");this.width=t.width,this.height=t.height}createInstance(t){let e=document.createElement("canvas");e.width=this.width,e.height=this.height,console.log(`Created canvas image instance with size: ${this.width} x ${this.height}`);let i=e.getContext("2d");return i&&t(i),e}}class be{constructor(t){l(this,"width");l(this,"height");l(this,"map");l(this,"fillRatio");l(this,"threshold");this.width=t.width,this.height=t.height,this.map=Array.from(Array(this.width),()=>new Array(this.height)),this.fillRatio=t.fillRatio,this.threshold=(this.width+this.height)/2}generateMap(t){this.randomFillMap();for(let e=0;e<15;e++)this.smoothMap();this.addBorderWalls(),this.processMap();for(let e=0;e<t.width;e++)for(let i=0;i<t.height;i++)t.cells[t.getIndexFromCoords(e,i)].wall=this.map[e][i]?1:0}randomFillMap(){for(let t=0;t<this.width;t++)for(let e=0;e<this.height;e++)this.map[t][e]=K(0,1)<this.fillRatio?1:0}smoothMap(){let t=[];for(let e=0;e<this.map.length;e++)t[e]=this.map[e].slice();for(let e=0;e<this.width;e++)for(let i=0;i<this.height;i++){let n=this.getNeighbourWallCount(e,i);n>4?t[e][i]=1:n<4&&(t[e][i]=0)}this.map=t}getNeighbourWallCount(t,e){let i=0;for(let n=t-1;n<=t+1;n++)for(let o=e-1;o<=e+1;o++)n>=0&&n<this.width&&o>=0&&o<this.height?(n!==t||o!==e)&&(i+=this.map[n][o]):i++;return i}addBorderWalls(){let t=$t.BORDER_SIZE;for(let e=0;e<this.width;e++)for(let i=0;i<t;i++)this.map[e][i]=1,this.map[e][this.height-i-1]=1;for(let e=0;e<t;e++)for(let i=0;i<this.height;i++)this.map[e][i]=1,this.map[this.width-e-1][i]=1}processMap(){let t=this.getRegions(1);if(!t)return;let e=this.threshold;for(const o of t)if(o.length<e)for(const a of o)this.map[a.x][a.y]=0;let i=this.getRegions(0);if(!i)return;let n=this.threshold;for(const o of i)if(o.length<n)for(const a of o)this.map[a.x][a.y]=1}getRegions(t){let e=[],i=Array.from(Array(this.width),()=>new Array(this.height).fill(0));for(let n=0;n<this.width;n++)for(let o=0;o<this.height;o++)if(i[n][o]===0&&this.map[n][o]===t){let a=this.getRegionCells(n,o);if(!a)return;e.push(a);for(const h of a)i[h.x][h.y]=1}return e}getRegionCells(t,e){let i=[],n=Array.from(Array(this.width),()=>new Array(this.height).fill(0)),o=this.map[t][e],a=[];for(a.push({x:t,y:e}),n[t][e]=1;a.length>0;){let h=a.shift();if(!h)return;i.push(h);for(let f=h.x-1;f<=h.x+1;f++)for(let g=h.y-1;g<=h.y+1;g++)f>=0&&f<this.width&&g>=0&&g<this.height&&(g===h.y||f===h.x)&&n[f][g]===0&&this.map[f][g]===o&&(n[f][g]=1,a.push({x:f,y:g}))}return i}}class Fe{constructor(t){l(this,"measurementArray");l(this,"sampleSize");l(this,"isMeasuring");l(this,"modes");l(this,"mode");this.measurementArray=new Map,this.sampleSize=60,this.isMeasuring=!0,this.modes=[],this.mode=0,this.getModes(t),this.createMeasurementArray(t)}getModes(t){for(const e of t)this.modes.push(e.mode)}changeMode(){this.mode==this.modes.length-1?(this.isMeasuring=!1,this.mode=-1):(this.isMeasuring=!0,this.mode++),this.toggleDisplayVisibility()}toggleDisplayVisibility(){for(const t of this.measurementArray.values()){if(!t.element)return;this.isMeasuring&&t.mode<=this.mode?t.element.style.display="block":t.element.style.display="none"}}createMeasurementArray(t){for(const e of t)for(const i of e.stats)this.measurementArray.set(i.name,{performanceArray:[],title:i.title,mode:e.mode,index:0})}createPerformanceDisplay(t){let e=[];for(const[i,n]of this.measurementArray){let o=document.createElement("span");o.dataset[i.toString()]="",o.title=n.title,this.isMeasuring&&n.mode<=this.mode?o.style.display="block":o.style.display="none",n.element=t.appendChild(o),e.push(n.element)}return e}startMeasurement(t){let e=this.measurementArray.get(t);e&&e.mode<=this.mode&&(e.startTime=performance.now())}endMeasurement(t){let e=this.measurementArray.get(t);e&&e.startTime&&e.mode<=this.mode&&(e.performanceArray[e.index]=performance.now()-e.startTime)}setPerformance(t,e){let i=this.measurementArray.get(t);i&&i.mode<=this.mode&&(i.performanceArray[i.index]=e)}update(){let t=new Map;for(const e of this.measurementArray.keys())t.set(e,0);for(const[e,i]of this.measurementArray)for(let n=0;n<i.performanceArray.length;n++)t.set(e,t.get(e)+i.performanceArray[n]);for(const[e,i]of this.measurementArray){if(i.performanceArray.length===0)break;t.set(e,t.get(e)/i.performanceArray.length),i.mode<=this.mode&&(i.index++,i.index===this.sampleSize&&(i.index=0))}return t}}class W{constructor(t,e){l(this,"canvas");l(this,"width");l(this,"height");l(this,"cellSize");this.canvas=t,this.width=e.width,this.height=e.height,this.cellSize=e.cellSize}create(){return this.canvas.width=this.width,this.canvas.height=this.height,console.log(`Created canvas with size: ${this.width} x ${this.height}`),this.canvas.getContext("2d")}}function Ne(s){let t=Math.floor(s.width/s.cellSize),e=Math.floor(s.height/s.cellSize);t%2===0&&t--,e%2===0&&e--;let i=t*s.cellSize,n=e*s.cellSize;return console.log(`Calculate sizes:
${s.width==i?i:`${s.width} -> ${i}`} x ${s.height==n?n:`${s.height} -> ${n}`}`),[i,n]}class Le{constructor(t){l(this,"quantity");l(this,"changed");this.quantity=t,this.changed=!0}draw(t,e,i){t.clearRect(e*p.SIZE,i*p.SIZE,p.SIZE,p.SIZE);let n=e*p.SIZE+p.SIZE/2,o=i*p.SIZE+p.SIZE/2;t.fillStyle=`hsl(120, 40%, 43%, ${this.quantity/100})`,O(t,n,o,p.SIZE/2,!0),this.changed=!1}pick(){if(this.changed=!0,this.quantity===0)return 0;let t=0;return this.quantity<p.PICK_AMOUNT?t=this.quantity:t=p.PICK_AMOUNT,this.quantity=Math.max(this.quantity-p.PICK_AMOUNT,0),t}}class ke{constructor(t){l(this,"intensity");this.intensity=t}getMixedColor(){if(this.intensity[0]===0&&this.intensity[1]===0)return[0,0,0];let[t,e,i]=jt.TO_HOME,[n,o,a]=jt.TO_FOOD,h=[this.intensity[0]*t,this.intensity[0]*e,this.intensity[0]*i];if(this.intensity[1]===0)return[Math.round(h[0]),Math.round(h[1]),Math.round(h[2])];let f=[this.intensity[1]*n,this.intensity[1]*o,this.intensity[1]*a];if(this.intensity[0]===0)return[Math.round(f[0]),Math.round(f[1]),Math.round(f[2])];let g=[h[0]+f[0],h[1]+f[1],h[2]+f[2]];return g=[Math.round(Math.min(g[0],255)),Math.round(Math.min(g[1],255)),Math.round(Math.min(g[2],255))],g}update(){this.intensity[0]>.01?this.intensity[0]-=Jt:this.intensity[0]=0,this.intensity[1]>.01?this.intensity[1]-=Jt:this.intensity[1]=0}}class De{constructor(){l(this,"marker");l(this,"food");l(this,"wall");l(this,"density");l(this,"colony");this.marker=new ke([0,0]),this.food=new Le(0),this.wall=0,this.density=0,this.colony=!1}update(){this.marker.update()}pick(){return this.food.pick()}drawWall(t,e,i){t.fillRect(e,i,1,1)}addDensity(){this.density++}}class ve{constructor(t){l(this,"width");l(this,"height");l(this,"cellSize");l(this,"cells");this.width=t.width,this.height=t.height,this.cellSize=t.cellSize,this.cells=[];for(let e=0;e<this.width*this.height;e++)this.cells.push(new De)}addBorderWalls(){let t=$t.BORDER_SIZE;for(let e=0;e<this.width;e++)for(let i=0;i<t;i++){let n=this.cells[this.getIndexFromCoords(e,i)],o=this.cells[this.getIndexFromCoords(e,this.height-i-1)];n.wall=1,o.wall=1}for(let e=0;e<t;e++)for(let i=0;i<this.height;i++){let n=this.cells[this.getIndexFromCoords(e,i)],o=this.cells[this.getIndexFromCoords(this.width-e-1,i)];n.wall=1,o.wall=1}}update(){for(const t of this.cells)this.updateCell(t)}updateCell(t){t.marker.update(),t.density>.01?t.density*=.99:t.density=0}addMarker(t,e,i,n){let o=this.cells[this.getIndexFromCoords(t,e)];i===Q.TO_HOME?o.marker.intensity[0]=Math.min(1,Math.max(o.marker.intensity[0],n)):i===Q.TO_FOOD&&(o.marker.intensity[1]=Math.min(1,Math.max(o.marker.intensity[1],n)))}addFood(t,e,i){let n=this.getIndexFromCoords(t,e);if(n>this.cells.length||n<0)return;let o=this.cells[n];o.food.quantity=Math.min(o.food.quantity+i,100),o.food.changed=!0}drawMarkers(t,e,i=!0){for(let n=0;n<e.data.length;n+=4){let o=this.cells[n/4],a=o.marker.getMixedColor();e.data[n+0]=a[0],e.data[n+1]=a[1],e.data[n+2]=a[2],e.data[n+3]=255,i&&this.updateCell(o)}t.putImageData(e,0,0)}drawFood(t){for(let e=0;e<this.cells.length;e++)if(this.cells[e].food.changed){let[i,n]=this.getCoordsFromIndex(e);this.cells[e].food.draw(t,i,n)}}drawWalls(t){t.fillStyle="rgb(163, 163, 163)";for(let e=0;e<this.width;e++)for(let i=0;i<this.height;i++){let n=this.cells[this.getIndexFromCoords(e,i)];n.wall===1&&n.drawWall(t,e,i)}}drawDensity(t,e,i=!0){for(let n=0;n<e.data.length;n+=4){let o=this.cells[n/4],a=o.density;e.data[n+0]=4*a,e.data[n+1]=a,e.data[n+2]=a,e.data[n+3]=255,i&&this.updateCell(o)}t.putImageData(e,0,0)}isOnFood(t,e){return this.cells[this.getIndexFromCoords(t,e)].food.quantity>0}getIndexFromCoords(t,e){return t+e*this.width}getCoordsFromIndex(t){let e=t%this.width,i=Math.floor(t/this.width);return[e,i]}getCellCoords(t,e){let i=Math.floor(t/u.SIZE),n=Math.floor(e/u.SIZE);return[i,n]}getCellFromCoords(t,e,i=!1){return i||([t,e]=this.getCellCoords(t,e)),this.cells[this.getIndexFromCoords(t,e)]}getCellFromCoordsSafe(t,e){let[i,n]=this.getCellCoords(t,e);return this.checkCoords(i,n)?this.getCellFromCoords(i,n,!0):null}checkCoords(t,e){return t>-1&&t<this.width&&e>-1&&e<this.height}}const z=document.getElementById("canvas-container"),ze=document.getElementById("camera-container"),Ze=document.getElementById("btn-fullscreen"),He=document.getElementById("btn-pan"),Be=document.getElementById("canvas"),ae=document.getElementById("canvas-markers"),re=document.getElementById("canvas-food"),$e=document.getElementById("canvas-colony"),he=document.getElementById("canvas-walls"),ut=document.getElementById("canvas-edit"),ft=document.getElementById("canvas-edit-preview"),te=document.getElementById("antIcon"),Et=document.getElementById("btn-ant-panel"),qt=document.getElementById("antPanel"),qe=document.querySelector("[data-id]"),We=document.querySelector("[data-pos]"),Ge=document.querySelector("[data-vel]"),Ue=document.querySelector("[data-state]"),ee=document.querySelector("[data-lifespan-preview]"),Ye=document.querySelector("[data-lifespan]"),Lt=document.getElementById("btn-track"),Ve=document.getElementById("btn-remove"),kt=document.getElementById("btn-cell-panel"),ce=document.getElementById("cellPanel"),Xe=document.querySelector("[data-cell-preview]"),Ke=document.querySelector("[data-intensity-home]"),je=document.querySelector("[data-intensity-food]"),Je=document.querySelector("[data-cell-food]"),Qe=document.querySelector("[data-density]"),Dt=document.getElementById("btn-colony-panel"),de=document.getElementById("colonyPanel"),ti=document.querySelector("[data-colony-preview]"),ei=document.querySelector("[data-colony-pop]"),ii=document.querySelector("[data-colony-food]"),si=document.querySelector("[data-pause]"),ue=document.getElementById("btn-play"),fe=document.getElementById("btn-pause"),vt=document.getElementById("btn-edit-mode"),me=document.getElementById("editPanel"),ie=document.querySelector("[data-brush-preview]"),ni=document.querySelector("[data-brush-size]"),H=document.getElementById("brushSizeInput"),pt=document.getElementById("btn-wall-brush"),zt=document.getElementById("btn-food-brush"),oi=document.getElementById("btn-save"),li=document.getElementById("btn-controls"),ai=document.getElementById("btn-close-controls"),ye=document.getElementById("controlsPanel"),ri=document.querySelector("[data-performance-display]"),hi=document.getElementById("btn-generate-map");let b=!1,at=!0,rt=!1,B=!1,It=!1,N=!1,Zt=!1,Ht=!1,F=!1,$=!1,Ct=!1,ht=!1,_=!1,ct=!1,Rt=0,E=new Fe([{mode:0,stats:[{name:"fps",title:"Frames per second"},{name:"ms",title:"Milliseconds to render a frame"}]},{mode:1,stats:[{name:"clear",title:"Milliseconds to clear the screen"},{name:"grid",title:"Milliseconds to draw markers/density and update cells"},{name:"food",title:"Milliseconds to draw food"},{name:"ants",title:"Milliseconds to draw and update ants"},{name:"panels",title:"Milliseconds to update info panels"},{name:"all",title:"Milliseconds needed for main loop"}]}]),[ci,bt,di,ui,fi,mi,yi,gi]=E.createPerformanceDisplay(ri),et=z.getBoundingClientRect().top,St=0,wt=0,d=1,X=!1,Ot=!1,Ft=0,j={x:0,y:0},m={x:0,y:0},M=5,[w,T]=Ne({width:Kt.WIDTH,height:Kt.HEIGHT,cellSize:u.SIZE}),Ii=new W(ae,{width:w/u.SIZE,height:T/u.SIZE,cellSize:1});ae.style.transform=`scale(${u.SIZE})`;let A=Ii.create(),Ei=new W(re,{width:w/(u.SIZE/p.SIZE),height:T/(u.SIZE/p.SIZE),cellSize:u.SIZE/p.SIZE});re.style.transform=`scale(${u.SIZE/p.SIZE})`;let At=Ei.create(),pi=new W(Be,{width:w,height:T,cellSize:u.SIZE}),J=pi.create(),Ci=new le({width:r.IMG_WIDTH,height:r.IMG_HEIGHT}),Oi=new le({width:r.FOOD_SIZE,height:r.FOOD_SIZE}),Ai=new W($e,{width:w,height:T,cellSize:u.SIZE}),Bt=Ai.create(),Mi=new W(he,{width:w/u.SIZE,height:T/u.SIZE,cellSize:1});he.style.transform=`scale(${u.SIZE})`;let L=Mi.create(),Si=new W(ut,{width:w/u.SIZE,height:T/u.SIZE,cellSize:1});ut.style.transform=`scale(${u.SIZE})`;let P=Si.create(),wi=new W(ft,{width:w/u.SIZE,height:T/u.SIZE,cellSize:1});ft.style.transform=`scale(${u.SIZE})`;let lt=wi.create(),c=new ve({width:w/u.SIZE,height:T/u.SIZE,cellSize:1}),Ti=new be({width:c.width,height:c.height,fillRatio:$t.FILL_RATIO}),Mt=A==null?void 0:A.createImageData(c.width,c.height),se=A==null?void 0:A.createImageData(c.width,c.height),I=new Re({id:1,pos:{x:w/2,y:T/2}});window.addEventListener("keydown",s=>{switch(s.code){case"Space":s.preventDefault(),Gt();break;case"KeyM":_i();break;case"KeyN":Ri();break;case"KeyA":Fi();break;case"KeyD":bi();break;case"KeyT":Ie();break;case"KeyC":Ut();break;case"Delete":Ee();break;case"KeyF":E.changeMode();break;case"ArrowUp":gt(0,yt);break;case"ArrowDown":gt(0,-yt);break;case"ArrowLeft":gt(yt,0);break;case"ArrowRight":gt(-yt,0);break;case"Minus":oe(!1);break;case"Equal":oe(!0);break;case"Comma":ne(-q.STEP);break;case"Period":ne(q.STEP);break}});z.addEventListener("mousemove",s=>{St=s.pageX,wt=s.pageY-et});z.addEventListener("click",()=>{if(Ot){Ot=!1;return}Ni(),B&&ge()});z.addEventListener("contextmenu",s=>{if(s.preventDefault(),N)return;let t=tt(Math.floor((St/d-m.x)/u.SIZE),Math.floor((wt/d-m.y)/u.SIZE));B&&console.log(`Placed food at: ${t.x}:${t.y}`),c.addFood(t.x,t.y,10)});z.addEventListener("wheel",s=>{Zi(s)});Ze.addEventListener("click",()=>{Ut()});Lt.addEventListener("click",()=>{Ie()});Ve.addEventListener("click",()=>{Ee()});ue.addEventListener("click",()=>{Gt()});fe.addEventListener("click",()=>{Gt()});Dt.addEventListener("click",()=>{Ct=S(Ct,de,Dt)});Ct=S(Ct,de,Dt);kt.addEventListener("click",()=>{ht=S(ht,ce,kt)});Et.addEventListener("click",()=>{_=S(_,qt,Et)});li.addEventListener("click",()=>{ct=S(ct,ye)});ai.addEventListener("click",()=>{ct=!0,ct=S(ct,ye)});hi.addEventListener("click",()=>{confirm("Are you sure you want to generate a new map?")&&L&&(L.clearRect(0,0,c.width,c.height),Ti.generateMap(c),c.drawWalls(L))});vt.addEventListener("click",()=>{N=S(N,me,vt),N?(ut.style.display="block",ft.style.display="block"):(ut.style.display="none",ft.style.display="none")});pt.addEventListener("click",()=>{F=dt(F,pt),F&&($=!0,$=dt(F,zt))});zt.addEventListener("click",()=>{$=dt($,zt),$&&(F=!0,F=dt($,pt))});oi.addEventListener("click",()=>{if(P&&L){let s=P.getImageData(0,0,c.width,c.height);L.clearRect(0,0,c.width,c.height);for(let t=0;t<s.data.length;t+=4){let e=c.cells[t/4],i=s.data[t+0],n=s.data[t+1],o=s.data[t+2],a=s.data[t+3];n<=160&&n>0&&n>i&&n>o?e.wall!==1?(e.food.quantity=Math.round(100*(a/255)),e.food.changed=!0):e.wall=1:i>10&&n>10&&o>10&&i===n&&n===o?(e.wall=1,e.food.quantity=0,e.food.changed=!0):a>0&&(e.food.quantity=0,e.food.changed=!0,e.wall=0)}c.addBorderWalls(),c.drawWalls(L),P.clearRect(0,0,c.width,c.height),N=S(N,me,vt),ut.style.display="none",ft.style.display="none"}});H.addEventListener("input",()=>{M=parseInt(H.value),Wt()});function xi(){H.min=q.MIN_SIZE.toString(),H.max=q.MAX_SIZE.toString(),H.step=q.STEP.toString(),H.value=M.toString()}function Wt(){ie.style.width=`${M}px`,ie.style.height=`${M}px`,ni.textContent=`${M} px`}function ne(s){M=Math.min(q.MAX_SIZE,Math.max(q.MIN_SIZE,M+s)),H.value=M.toString(),Wt()}xi();Wt();F=dt(F,pt);Pi();zi();Ut();window.requestAnimationFrame(pe);function Pi(){if(!(A==null||At==null||J==null||Bt==null||L==null||P==null||lt==null)){if(Mt&&(c.drawMarkers(A,Mt),c.drawFood(At)),te){let s=new XMLSerializer().serializeToString(te),t=btoa(s),i="data:image/svg+xml;base64,"+t,n=new Image;n.src=i,n.onload=()=>{let o=Ci.createInstance(h=>{h.drawImage(n,0,0)}),a=Oi.createInstance(h=>{let f=r.FOOD_SIZE/2;h.fillStyle="hsl(120, 40%, 43%)",O(h,f,f,r.FOOD_SIZE/2)});I.initialize(n,o,a,J,c)}}I.drawColony(Bt),c.addBorderWalls(),c.drawWalls(L)}}function Gt(){b=!b,I.isRunning=b,si.style.display=b?"none":"block",ue.style.display=b?"none":"flex",fe.style.display=b?"flex":"none"}function _i(){at=!at,at&&(rt=!1)}function Ri(){rt=!rt,rt&&(at=!1)}function bi(){B=!B,I.isDebugMode=B,ge(),B&&(ht=!1),ht=S(ht,ce,kt)}function ge(){I.toggleAntDebug()}function Ie(){I.selectedAnt!=null&&(It=!It,It&&(d=3),Lt.classList.toggle("border-green-500"),Lt.classList.toggle("border-red-500"))}function Nt(){He.classList.toggle("bg-neutral-600")}function Fi(){I.isDrawingAnts=!I.isDrawingAnts}function Ni(){let s=tt(St/d-m.x,wt/d-m.y);I.selectAnt(s),I.selectedAnt?_=!1:_=!0,_=S(_,qt,Et)}function Ee(){I.removeAnt()?_=!0:_=!1,_=S(_,qt,Et)}function Li(){let s=I.selectedAnt;if(!s)return;qe.textContent=s.id.toString(),We.textContent=`${s.pos.x.toFixed(2)} : ${s.pos.y.toFixed(2)}`,Ge.textContent=`${s.vel.x.toFixed(2)} : ${s.vel.y.toFixed(2)}`;let t="";switch(s.state){case y.TO_HOME:t="To Home";break;case y.TO_FOOD:t="To Food";break;case y.REFILL:t="Refill";break}Ue.textContent=t;let e=r.AUTONOMY_REFILL/s.maxAutonomy,i=s.internalClock/s.maxAutonomy;ee.style.setProperty("--left",`${e*100}%`),ee.style.setProperty("--width",`${i*100}%`),Ye.textContent=`${s.internalClock.toFixed(2)} | ${s.maxAutonomy.toFixed(2)}`}function ki(s,t){let e=c.getCellFromCoordsSafe(s,t);if(!e)return;Ke.textContent=e.marker.intensity[0].toFixed(2),je.textContent=e.marker.intensity[1].toFixed(2),Je.textContent=e.food.quantity.toString(),Qe.textContent=e.density.toFixed(2);let i=e.marker.getMixedColor();Xe.style.backgroundColor=`rgb(${i[0]}, ${i[1]}, ${i[2]})`}function Di(){if(!I)return;ei.textContent=`${I.ants.length} | ${I.totalAnts}`,ii.textContent=`${I.food.toFixed(2)} | ${I.totalFood}`;let s=I.colonyColor;ti.style.backgroundColor=`rgb(${s[0]}, ${s[1]}, ${s[2]})`}function vi(){let s=E.update();ci.textContent=`${Math.round(s.get("fps")*100)/100} fps`,bt.textContent=`${Math.round(s.get("ms")*100)/100} ms`,di.textContent=`${Math.round(s.get("clear")*100)/100} ms`,ui.textContent=`${Math.round(s.get("grid")*100)/100} ms`,fi.textContent=`${Math.round(s.get("food")*100)/100} ms`,mi.textContent=`${Math.round(s.get("ants")*100)/100} ms`,yi.textContent=`${Math.round(s.get("panels")*100)/100} ms`,gi.textContent=`${Math.round(s.get("all")*100)/100} ms`,s.get("ms")>16.7?bt.classList.add("text-red-500"):bt.classList.remove("text-red-500")}function zi(){z.addEventListener("mousedown",s=>{if(clearTimeout(Ft),s.buttons==_t&&N)Ht=!0;else if(s.buttons==_t)return;if(s.buttons==_e)X=!0,Ot=!1,Nt(),document.body.classList.add("cursor-grabbing"),j.x=s.clientX/d-m.x,j.y=(s.clientY-et)/d-m.y;else{if(N){Zt=!0;return}X=!1,Ft=setTimeout(()=>{X=!0,Ot=!0,Nt(),document.body.classList.add("cursor-grabbing"),j.x=s.clientX/d-m.x,j.y=(s.clientY-et)/d-m.y},100)}}),z.addEventListener("mousemove",s=>{!X||s.buttons==_t||Hi(s)}),z.addEventListener("mouseup",()=>{clearTimeout(Ft),Zt=!1,Ht=!1,X&&(X=!1,Nt(),document.body.classList.remove("cursor-grabbing"))})}function Zi(s){let t={x:0,y:0};t.x=s.clientX/d-m.x,t.y=(s.clientY-et)/d-m.y,d*=.999**s.deltaY,d=Math.min(Math.max(.15,d),16),m.x=s.clientX/d-t.x,m.y=(s.clientY-et)/d-t.y,it()}function Hi(s){m.x=s.clientX/d-j.x,m.y=(s.clientY-et)/d-j.y,it()}function gt(s,t){m.x+=s,m.y+=t,it()}function oe(s){let t={x:0,y:0};t.x=window.innerWidth/2/d-m.x,t.y=window.innerWidth/2/d-m.y,d*=.999**(s?-100:100),d=Math.min(Math.max(.15,d),16),m.x=window.innerWidth/2/d-t.x,m.y=window.innerWidth/2/d-t.y,it()}function Ut(){let s={x:window.innerWidth/2-w/2,y:window.innerHeight/2-T/2};d=1,m.x=s.x,m.y=s.y,it()}function Bi(s,t){let e={x:window.innerWidth/2/d-s,y:window.innerHeight/2/d-t};m.x=e.x,m.y=e.y,it()}function it(){ze.style.transform=`scale(${d}) translate(${m.x}px, ${m.y}px)`}function pe(s){if(A==null||At==null||J==null||Bt==null||L==null||P==null||lt==null)return;window.requestAnimationFrame(pe),E.startMeasurement("all");const t=(s-Rt)/1e3;E.isMeasuring&&(E.setPerformance("fps",1/t),E.setPerformance("ms",s-Rt)),E.startMeasurement("clear"),J.clearRect(0,0,w,T),A.clearRect(0,0,c.width,c.height),E.endMeasurement("clear"),E.startMeasurement("grid"),at&&Mt?c.drawMarkers(A,Mt,b):rt&&se?c.drawDensity(A,se,b):b&&c.update(),E.endMeasurement("grid"),E.startMeasurement("food"),c.drawFood(At),E.endMeasurement("food");let e=tt(St/d-m.x,wt/d-m.y);if(N){lt.clearRect(0,0,c.width,c.height),lt.fillStyle="grey";let i=c.getCellCoords(e.x,e.y);O(lt,i[0],i[1],M),Ht?(P.fillStyle="black",O(P,i[0],i[1],M)):Zt&&(F?P.fillStyle="rgb(163, 163, 163)":$&&(P.fillStyle="rgb(66, 153, 66, 0.25)"),O(P,i[0],i[1],M))}I.updateColony(t),E.startMeasurement("ants"),I.updateAndDrawAnts(c,t),E.endMeasurement("ants"),E.startMeasurement("panels"),Li(),It&&I.selectedAnt&&Bi(I.selectedAnt.pos.x,I.selectedAnt.pos.y),B&&(J.fillStyle="red",O(J,e.x,e.y,4),ki(e.x,e.y)),Di(),E.endMeasurement("panels"),E.isMeasuring&&(E.endMeasurement("all"),vi()),Rt=s}
