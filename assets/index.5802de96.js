var Ls=Object.defineProperty;var bs=(i,t,e)=>t in i?Ls(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var a=(i,t,e)=>(bs(i,typeof t!="symbol"?t+"":t,e),e);const Ns=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function e(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerpolicy&&(o.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?o.credentials="include":n.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(n){if(n.ep)return;n.ep=!0;const o=e(n);fetch(n.href,o)}};Ns();const ze={WIDTH:1600*3,HEIGHT:1200*3},Rt={FILL_RATIO:.47,FILL_RATIO_FOOD:.37,THRESHOLD:50,THRESHOLD_FOOD:20,BORDER_SIZE:5};var nt=(i=>(i[i.TO_HOME=0]="TO_HOME",i[i.TO_FOOD=1]="TO_FOOD",i))(nt||{});const Ze={TO_HOME:[255,0,0],TO_FOOD:[43,255,0]},g={WIDTH:16,HEIGHT:16,SIZE:16},Be=2e-4/10,V={COLONY_RADIUS:3,COLONY_STARTING_ANTS:50,COLONY_MAX_ANTS:5e3,COLONY_MAX_FOOD:3e5,ANT_CREATION_PERIOD:.15,ANT_COST:30,ANT_REFILL_FOOD_AMOUNT:.25};var tt=(i=>(i[i.ADVANCED=0]="ADVANCED",i[i.SIMPLE=1]="SIMPLE",i))(tt||{}),h=(i=>(i[i.TO_HOME=0]="TO_HOME",i[i.TO_FOOD=1]="TO_FOOD",i[i.REFILL=2]="REFILL",i))(h||{});const r={IMG_WIDTH:24,IMG_HEIGHT:34,DIRECTION_NOISE_RANGE:Math.PI*.05,WANDER_DISPLACE_RANGE:.5,WANDER_POINT_MAGNITUDE:100,WANDER_POINT_RADIUS:50,PERCEPTION_RADIUS:80,PERCEPTION_START_ANGLE:7/6*Math.PI,PERCEPTION_END_ANGLE:11/6*Math.PI,PERCEPTION_POINTS_HORIZONTAL:8,PERCEPTION_POINTS_VERTICAL:5,DIRECTION_PERIOD:.25,MARKER_PERIOD:.15,MARKER_DEFAULT_INTENSITY:1,AUTONOMY_MAX:300,AUTONOMY_REFILL:150,FOOD_SIZE:16},qe=.005,_={SIZE:15,PICK_AMOUNT:2},le=2,vs=4,lt=g.SIZE,it={MIN_SIZE:1,MAX_SIZE:75,STEP:1};function D(i,t,e,s,n=!0,o=!1){i.beginPath(),i.arc(t,e,s,0,Math.PI*2),n&&i.fill(),o&&i.stroke()}function Tt(i,t,e,s,n){i.beginPath(),i.moveTo(t,e),i.lineTo(s,n),i.stroke(),i.closePath()}function P(i,t){return Math.random()*(t-i)+i}function A(i,t,e){return i=!i,i?(t.style.display="block",e==null||e.classList.add("border-green-500"),e==null||e.classList.remove("border-red-500")):(t.style.display="none",e==null||e.classList.add("border-red-500"),e==null||e.classList.remove("border-green-500")),i}function M(i,t){return i=!i,i?(t.classList.add("border-green-500"),t.classList.remove("border-red-500")):(t.classList.add("border-red-500"),t.classList.remove("border-green-500")),i}function ft(i=!1,t=""){const s=new URL(window.location.href).searchParams.get("seed");if(i&&s!=null)return s;if(i)return"";{const n=Math.random().toString(36).slice(2,7);return t!=""?t:n}}class et{constructor(t,e,s){a(this,"x");a(this,"y");a(this,"z");this.x=t||0,this.y=e||0,this.z=s||0}set(t,e,s){return t instanceof et?(this.x=t.x||0,this.y=t.y||0,this.z=t.z||0,this):t instanceof Array?(this.x=t[0]||0,this.y=t[1]||0,this.z=t[2]||0,this):(this.x=t||0,this.y=e||0,this.z=s||0,this)}copy(){return new et(this.x,this.y,this.z)}add(t,e,s){return t instanceof et?(this.x+=t.x||0,this.y+=t.y||0,this.z+=t.z||0,this):t instanceof Array?(this.x+=t[0]||0,this.y+=t[1]||0,this.z+=t[2]||0,this):(this.x+=t||0,this.y+=e||0,this.z+=s||0,this)}sub(t,e,s){return t instanceof et?(this.x-=t.x||0,this.y-=t.y||0,this.z-=t.z||0,this):t instanceof Array?(this.x-=t[0]||0,this.y-=t[1]||0,this.z-=t[2]||0,this):(this.x-=t||0,this.y-=e||0,this.z-=s||0,this)}multSimple(t){return this.x*=t,this.y*=t,this.z*=t,this}mult(t,e,s){if(t instanceof et)return Number.isFinite(t.x)&&Number.isFinite(t.y)&&Number.isFinite(t.z)&&typeof t.x=="number"&&typeof t.y=="number"&&typeof t.z=="number"?(this.x*=t.x,this.y*=t.y,this.z*=t.z):console.warn("Vector.mult:","x contains components that are either undefined or not finite numbers"),this;if(t instanceof Array)return t.every(o=>Number.isFinite(o))&&t.every(o=>typeof o=="number")?t.length===1?(this.x*=t[0],this.y*=t[0],this.z*=t[0]):t.length===2?(this.x*=t[0],this.y*=t[1]):t.length===3&&(this.x*=t[0],this.y*=t[1],this.z*=t[2]):console.warn("Vector.mult:","x contains elements that are either undefined or not finite numbers"),this;const n=[...arguments];return n.every(o=>Number.isFinite(o))&&n.every(o=>typeof o=="number")?(arguments.length===1&&(this.x*=t,this.y*=t,this.z*=t),arguments.length===2&&(this.x*=t,this.y*=e||0),arguments.length===3&&(this.x*=t,this.y*=e||0,this.z*=s||0)):console.warn("Vector.mult:","x, y, or z arguments are either undefined or not a finite number"),this}div(t,e,s){if(t instanceof et){if(Number.isFinite(t.x)&&Number.isFinite(t.y)&&Number.isFinite(t.z)&&typeof t.x=="number"&&typeof t.y=="number"&&typeof t.z=="number"){if(t.x===0||t.y===0||t.z===0)return console.warn("Vector.div:","divide by 0"),this;this.x/=t.x,this.y/=t.y,this.z/=t.z}else console.warn("Vector.div:","x contains components that are either undefined or not finite numbers");return this}if(t instanceof Array){if(t.every(o=>Number.isFinite(o))&&t.every(o=>typeof o=="number")){if(t.some(o=>o===0))return console.warn("Vector.div:","divide by 0"),this;t.length===1?(this.x/=t[0],this.y/=t[0],this.z/=t[0]):t.length===2?(this.x/=t[0],this.y/=t[1]):t.length===3&&(this.x/=t[0],this.y/=t[1],this.z/=t[2])}else console.warn("Vector.div:","x contains components that are either undefined or not finite numbers");return this}const n=[...arguments];if(n.every(o=>Number.isFinite(o))&&n.every(o=>typeof o=="number")){if(n.some(o=>o===0))return console.warn("Vector.div:","divide by 0"),this;arguments.length===1&&(this.x/=t,this.y/=t,this.z/=t),arguments.length===2&&(this.x/=t,this.y/=e||0),arguments.length===3&&(this.x/=t,this.y/=e||0,this.z/=s||0)}else console.warn("Vector.div:","x, y, or z arguments are either undefined or not a finite number");return this}mag(){return Math.sqrt(this.magSq())}magSq(){const t=this.x,e=this.y,s=this.z;return t*t+e*e+s*s}dot(t,e,s){return this.x*(t||0)+this.y*(e||0)+this.z*(s||0)}dist(t){return t.copy().sub(this).mag()}normalize(){const t=this.mag();return t!==0&&(this.x*=1/t,this.y*=1/t,this.z*=1/t),this}limit(t){const e=this.magSq();return e>t*t&&(this.x/=Math.sqrt(e),this.y/=Math.sqrt(e),this.z/=Math.sqrt(e),this.x*=t,this.y*=t,this.z*=t),this}setMag(t){const e=this.normalize();return e.x*=t,e.y*=t,e.z*=t,e}heading(){return Math.atan2(this.y,this.x)}setHeading(t){let e=this.mag();return this.x=e*Math.cos(t),this.y=e*Math.sin(t),this}rotate(t){let e=this.heading()+t;const s=this.mag();return this.x=Math.cos(e)*s,this.y=Math.sin(e)*s,this}equals(t,e,s){let n,o,l;return t instanceof et?(n=t.x||0,o=t.y||0,l=t.z||0):t instanceof Array?(n=t[0]||0,o=t[1]||0,l=t[2]||0):(n=t||0,o=e||0,l=s||0),this.x===n&&this.y===o&&this.z===l}}function H(i,t,e){return new et(i,t,e)}class Yt{constructor(t,e,s,n,o){a(this,"ctx");a(this,"antImageInstance");a(this,"antFoodImageInstance");a(this,"antIcon");a(this,"id");a(this,"pos");a(this,"vel");a(this,"acc");a(this,"maxSpeed");a(this,"maxForce");a(this,"state");a(this,"debug");a(this,"wanderTheta");a(this,"perceptionDraw");a(this,"internalClock");a(this,"markerClock");a(this,"directionClock");a(this,"isDead");a(this,"freedomCoef");a(this,"foodAmount");a(this,"maxAutonomy");this.ctx=t,this.antImageInstance=e,this.antFoodImageInstance=s,this.antIcon=n,this.id=o.id,this.pos=H(o.pos.x,o.pos.y),this.vel=H(0,0),this.acc=H(0,0),this.maxSpeed=3,this.maxForce=.25,this.state=h.TO_FOOD,this.debug=o.debug||!1,this.wanderTheta=P(0,Math.PI*2),this.perceptionDraw=new Set,this.internalClock=0,this.markerClock=P(0,r.MARKER_PERIOD),this.directionClock=0,this.isDead=!1,this.freedomCoef=P(.01,.1),this.foodAmount=0,this.maxAutonomy=r.AUTONOMY_MAX-P(0,50)}seek(t){this.debug&&(this.ctx.strokeStyle="white",Tt(this.ctx,t.x,t.y,this.pos.x,this.pos.y));const e=t.copy().sub(this.pos);e.setMag(this.maxSpeed),e.sub(this.vel),e.limit(this.maxForce),this.applyForce(e)}wander(){const t=this.vel.copy();t.setMag(r.WANDER_POINT_MAGNITUDE),t.add(this.pos);const e=r.WANDER_POINT_RADIUS;this.debug&&(this.ctx.fillStyle="red",D(this.ctx,t.x,t.y,4),this.ctx.strokeStyle="white",D(this.ctx,t.x,t.y,e,!1,!0),Tt(this.ctx,this.pos.x,this.pos.y,t.x,t.y));const s=this.wanderTheta+this.vel.heading(),n=e*Math.cos(s),o=e*Math.sin(s);t.add(n,o),this.debug&&(this.ctx.fillStyle="green",D(this.ctx,t.x,t.y,8),Tt(this.ctx,this.pos.x,this.pos.y,t.x,t.y));const l=t.sub(this.pos);l.setMag(this.maxForce),l.limit(this.maxForce),this.applyForce(l);const c=r.WANDER_DISPLACE_RANGE;this.wanderTheta+=P(-c,c)}applyForce(t){this.acc.add(t)}update(t){this.internalClock+=t,this.directionClock+=t,this.internalClock>=r.AUTONOMY_REFILL&&this.state===h.TO_FOOD&&(this.state=h.REFILL),this.internalClock>=this.maxAutonomy&&(this.isDead=!0),this.vel.add(this.acc),this.vel.limit(this.maxSpeed),this.pos.add(this.vel),this.acc.set(0,0)}draw(){this.ctx.translate(this.pos.x,this.pos.y),this.ctx.rotate(this.vel.heading()+Math.PI/2);const t=-r.IMG_WIDTH/2,e=-r.IMG_HEIGHT/2;if(this.state===h.TO_HOME&&this.ctx.drawImage(this.antFoodImageInstance,-r.FOOD_SIZE/2,e-r.FOOD_SIZE/2),this.ctx.drawImage(this.antImageInstance,t,e),this.debug){this.ctx.strokeStyle="#FF0000",this.ctx.lineWidth=2,this.ctx.strokeRect(t,e,r.IMG_WIDTH,r.IMG_HEIGHT),this.ctx.fillStyle="red",D(this.ctx,0,0,4),this.ctx.beginPath(),this.ctx.arc(0,0,r.PERCEPTION_RADIUS,r.PERCEPTION_START_ANGLE,r.PERCEPTION_END_ANGLE),this.ctx.stroke(),this.ctx.strokeStyle="white",this.ctx.beginPath(),this.ctx.arc(0,0,r.PERCEPTION_RADIUS,r.PERCEPTION_END_ANGLE,r.PERCEPTION_START_ANGLE),this.ctx.stroke();const s=r.PERCEPTION_START_ANGLE,n=r.PERCEPTION_END_ANGLE,o=r.PERCEPTION_RADIUS*Math.cos(s),l=r.PERCEPTION_RADIUS*Math.sin(s),c=r.PERCEPTION_RADIUS*Math.cos(n),I=r.PERCEPTION_RADIUS*Math.sin(n);this.ctx.strokeStyle="red",Tt(this.ctx,0,0,o,l),Tt(this.ctx,0,0,c,I);const E=(r.PERCEPTION_END_ANGLE-r.PERCEPTION_START_ANGLE)/(r.PERCEPTION_POINTS_HORIZONTAL-1),u=r.PERCEPTION_RADIUS/r.PERCEPTION_POINTS_VERTICAL;for(let T=0;T<r.PERCEPTION_POINTS_HORIZONTAL;T++)for(let O=1;O<=r.PERCEPTION_POINTS_VERTICAL;O++){const x=E*T+r.PERCEPTION_START_ANGLE,C=u*O*Math.cos(x),b=u*O*Math.sin(x);this.perceptionDraw.has(O*r.PERCEPTION_POINTS_VERTICAL+T)?(this.ctx.strokeStyle="white",this.ctx.fillStyle="white"):(this.ctx.strokeStyle="red",this.ctx.fillStyle="green"),D(this.ctx,C,b,4),O===r.PERCEPTION_POINTS_VERTICAL&&Tt(this.ctx,0,0,C,b)}}this.debug&&(this.ctx.fillStyle="white",D(this.ctx,this.pos.x,this.pos.y,3)),this.ctx.resetTransform()}search(t,e){this.debug&&(this.perceptionDraw=new Set);const s=this.vel.copy();s.setMag(r.IMG_HEIGHT/2),s.add(this.pos);const n=t.getCellFromCoordsSafe(s.x,s.y),o=t.getCellFromCoordsSafe(this.pos.x,this.pos.y);if(o==null||o.addDensity(this.state===h.TO_HOME,this.state===h.REFILL),n&&n.food.quantity>0&&(this.state===h.TO_FOOD||this.state===h.REFILL)){this.state=h.TO_HOME,this.foodAmount=n.pick(),this.vel.setHeading(this.vel.heading()+Math.PI),this.internalClock=0;return}if(o&&o.colony&&(this.state===h.REFILL||this.state===h.TO_HOME)){if(this.state===h.TO_HOME&&(this.vel.setHeading(this.vel.heading()+Math.PI),e.addFood(this.foodAmount)),this.state===h.REFILL&&!e.useFood(V.ANT_REFILL_FOOD_AMOUNT))return;this.state=h.TO_FOOD,this.internalClock=0;return}if(Math.random()<this.freedomCoef)return;const l=(r.PERCEPTION_END_ANGLE-r.PERCEPTION_START_ANGLE)/(r.PERCEPTION_POINTS_HORIZONTAL-1),c=r.PERCEPTION_RADIUS/r.PERCEPTION_POINTS_VERTICAL;let I=r.PERCEPTION_POINTS_VERTICAL+1,E=null,u=0,T=null;const O=this.vel.heading(),x=-r.IMG_WIDTH/2,C=Math.PI/4+O+Math.PI,b=-Math.PI/4+O+Math.PI,j=x*Math.cos(C),ot=x*Math.sin(C),at=x*Math.cos(b),It=x*Math.sin(b),Q=this.pos.copy().add(j,ot),Et=this.pos.copy().add(at,It),re=t.getCellFromCoordsSafe(Q.x,Q.y),Ne=t.getCellFromCoordsSafe(Et.x,Et.y);if(re&&re.wall===1||Ne&&Ne.wall===1){const F=(re?Q:Et).sub(this.pos);F.sub(this.vel),F.mult(-1),this.applyForce(F);return}if(this.directionClock>=r.DIRECTION_PERIOD){for(let rt=0;rt<r.PERCEPTION_POINTS_HORIZONTAL;rt++)for(let F=1;F<=r.PERCEPTION_POINTS_VERTICAL;F++){const ve=l*rt+r.PERCEPTION_START_ANGLE+O+Math.PI/2,Ds=c*F*Math.cos(ve),ks=c*F*Math.sin(ve),pt=this.pos.copy().add(Ds,ks),Ot=t.getCellFromCoordsSafe(pt.x,pt.y);if(Ot){if(Ot.wall===1&&(F===1||F===2)){const Ct=pt.sub(this.pos),He=rt+1>r.PERCEPTION_POINTS_HORIZONTAL/2?r.PERCEPTION_POINTS_HORIZONTAL-rt:rt+1;Ct.setMag(this.maxSpeed),Ct.sub(this.vel),F===1?Ct.limit(this.maxForce*He):F===2&&Ct.limit(this.maxForce*.5*He),Ct.mult(-1),this.applyForce(Ct);break}if(Ot.colony&&(this.state===h.REFILL||this.state===h.TO_HOME)){this.seek(pt);return}if(Ot.food.quantity>0&&(this.state===h.TO_FOOD||this.state===h.REFILL)){this.debug&&this.perceptionDraw.add(F*r.PERCEPTION_POINTS_VERTICAL+rt),F<I&&(I=F,E=pt);break}let Wt=0;this.state===h.TO_HOME||this.state===h.REFILL?Wt=Ot.marker.intensity[0]:(this.state===h.TO_FOOD||this.state===h.REFILL)&&(Wt=Ot.marker.intensity[1]),Wt>u&&(u=Wt,T=pt)}}if(E){this.seek(E);return}if(T){this.seek(T);return}this.directionClock=0}this.wander()}perception(t){const e=(r.PERCEPTION_END_ANGLE-r.PERCEPTION_START_ANGLE)/(r.PERCEPTION_POINTS_HORIZONTAL-1),s=r.PERCEPTION_RADIUS/r.PERCEPTION_POINTS_VERTICAL;let n=r.PERCEPTION_POINTS_VERTICAL+1,o=null,l=0,c=null;const I=this.vel.heading(),E=this.vel.copy().add(this.acc).limit(this.maxSpeed),u=this.pos.copy().add(E),T=t.getCellFromCoordsSafe(u.x,u.y);if((T==null?void 0:T.wall)===1){const O=u.sub(this.pos);this.debug&&console.log(O),O.x*=O.x!=0?-1:1,O.y*=O.y!=0?-1:1,O.sub(this.vel),this.applyForce(O);return}if(this.directionClock>=r.DIRECTION_PERIOD){for(let O=0;O<r.PERCEPTION_POINTS_HORIZONTAL;O++){const x=e*O+r.PERCEPTION_START_ANGLE+I+Math.PI/2;for(let C=1;C<=r.PERCEPTION_POINTS_VERTICAL;C++){const b=s*C*Math.cos(x),j=s*C*Math.sin(x),ot=this.pos.copy().add(b,j),at=t.getCellFromCoordsSafe(ot.x,ot.y);if(at){if(at.wall===1&&(C===1||C===2)){const Q=ot.sub(this.pos),Et=O+1>r.PERCEPTION_POINTS_HORIZONTAL/2?r.PERCEPTION_POINTS_HORIZONTAL-O:O+1;Q.setMag(this.maxSpeed),Q.sub(this.vel),C===1?Q.limit(this.maxForce*Et):C===2&&Q.limit(this.maxForce*.5*Et),Q.mult(-1),this.applyForce(Q);break}if(at.colony&&(this.state===h.REFILL||this.state===h.TO_HOME)){this.seek(ot);return}if(at.food.quantity>0&&(this.state===h.TO_FOOD||this.state===h.REFILL)){this.debug&&this.perceptionDraw.add(C*r.PERCEPTION_POINTS_VERTICAL+O),C<n&&(n=C,o=ot);break}let It=0;this.state===h.TO_HOME||this.state===h.REFILL?It=at.marker.getToHomeIntensity():(this.state===h.TO_FOOD||this.state===h.REFILL)&&(It=at.marker.getToFoodIntensity()),It>l&&(l=It,c=ot)}}}if(o){this.seek(o);return}if(c){this.seek(c);return}this.directionClock=0}}searchSimple(t,e){this.debug&&(this.perceptionDraw=new Set);const s=t.getCellFromCoordsSafe(this.pos.x,this.pos.y);if(s==null||s.addDensity(this.state===h.TO_HOME,this.state===h.REFILL),s&&s.food.quantity>0&&(this.state===h.TO_FOOD||this.state===h.REFILL)){this.state=h.TO_HOME,this.foodAmount=s.pick(),this.vel.setHeading(this.vel.heading()+Math.PI),this.internalClock=0;return}if(s&&s.colony&&(this.state===h.REFILL||this.state===h.TO_HOME)){if(this.state===h.TO_HOME&&(this.vel.setHeading(this.vel.heading()+Math.PI),e.addFood(this.foodAmount)),this.state===h.REFILL&&!e.useFood(V.ANT_REFILL_FOOD_AMOUNT))return;this.state=h.TO_FOOD,this.internalClock=0;return}Math.random()<this.freedomCoef||(this.perception(t),this.wander())}addMarker(t,e){if(this.markerClock+=e,this.markerClock>=r.MARKER_PERIOD){const[s,n]=t.getCellCoords(this.pos.x,this.pos.y);if(!t.checkCoords(s,n))return;const o=r.MARKER_DEFAULT_INTENSITY*Math.exp(-.15*this.internalClock);let l=-1;switch(this.state){case h.TO_HOME:l=nt.TO_FOOD;break;case h.TO_FOOD:l=nt.TO_HOME;break;case h.REFILL:l=nt.TO_HOME;break}t.addMarker(s,n,l,o),this.markerClock=0}}}class Hs{constructor(t,e=.1){a(this,"angle");a(this,"targetAngle");a(this,"rotationSpeed");a(this,"vector");a(this,"targetVector");this.angle=t,this.targetAngle=t,this.rotationSpeed=e,this.vector=H(),this.targetVector=H(),this.updateVector(),this.targetVector=this.vector.copy()}update(){this.updateVector();const t=H(-this.vector.y,this.vector.x),e=this.targetVector.copy().dot(t.x,t.y);this.angle+=this.rotationSpeed*e}setDirectionImmediate(t){this.targetVector=t.copy(),this.vector=t.copy(),this.angle=t.heading(),this.targetAngle=this.angle}setDirectionAngle(t){this.targetAngle=t,this.updateTargetVector()}setAndAddDirectionAngle(t){this.targetAngle+=t,this.updateTargetVector()}addImmediate(t){this.setAndAddDirectionAngle(t),this.angle=this.targetAngle,this.updateVector()}getVec(){return this.vector}updateVector(){this.vector.x=Math.cos(this.angle),this.vector.y=Math.sin(this.angle)}updateTargetVector(){this.targetVector.x=Math.cos(this.targetAngle),this.targetVector.y=Math.sin(this.targetAngle)}}class Gt{constructor(t,e,s,n,o){a(this,"ctx");a(this,"antImageInstance");a(this,"antFoodImageInstance");a(this,"antIcon");a(this,"id");a(this,"pos");a(this,"direction");a(this,"maxSpeed");a(this,"state");a(this,"debug");a(this,"internalClock");a(this,"markerPeriod");a(this,"markerClock");a(this,"markerIntensityClock");a(this,"directionPeriod");a(this,"directionClock");a(this,"isDead");a(this,"freedomCoef");a(this,"foodAmount");a(this,"maxAutonomy");a(this,"hits");a(this,"foundCell");this.ctx=t,this.antImageInstance=e,this.antFoodImageInstance=s,this.antIcon=n,this.id=o.id,this.pos=H(o.pos.x,o.pos.y),this.direction=new Hs(P(-Math.PI*2,Math.PI*2)),this.maxSpeed=2,this.state=h.TO_FOOD,this.debug=o.debug||!1,this.internalClock=0,this.markerPeriod=r.MARKER_PERIOD+P(-r.MARKER_PERIOD*.25,r.MARKER_PERIOD*.25),this.markerClock=P(0,r.MARKER_PERIOD),this.markerIntensityClock=0,this.directionPeriod=r.DIRECTION_PERIOD+P(-r.DIRECTION_PERIOD*.25,r.DIRECTION_PERIOD*.25),this.directionClock=P(0,r.DIRECTION_PERIOD),this.isDead=!1,this.freedomCoef=P(.01,.1),this.foodAmount=0,this.maxAutonomy=r.AUTONOMY_MAX-P(0,50),this.hits=0,this.foundCell=!1}updatePosition(t){const e=this.direction.getVec(),s=t.rayCast(this.pos.copy(),this.direction.vector.heading(),r.IMG_HEIGHT/2+this.maxSpeed);if(s!=null&&s.cell){const n=e.copy();this.hits>16?n.setHeading(n.heading()+Math.PI/2):this.hits>8?(n.x*=s.normal.x!=0?1:-1,n.y*=s.normal.y!=0?1:-1):(n.x*=s.normal.x!=0?-1:1,n.y*=s.normal.y!=0?-1:1),this.hits+=4,this.direction.setDirectionImmediate(n)}else this.hits=Math.max(0,this.hits-1),this.pos.add(e.multSimple(this.maxSpeed))}find(t){if(this.directionClock>=this.directionPeriod){this.directionClock=0;let e=0,s=1,n=this.direction.getVec(),o=null;const l=n.heading();for(let c=0;c<32;c++){const I=P(-Math.PI*.3333333333333333,Math.PI*.3333333333333333),E=P(g.SIZE*3,g.SIZE*12),u=l+I,T=H(Math.cos(u),Math.sin(u)),O=t.rayCast(this.pos.copy(),u,E);if(O!=null&&O.cell)continue;const x=this.pos.copy().add(T.multSimple(E)),C=t.getCellFromCoordsSafe(x.x,x.y);if(C&&this.debug&&(C.density=[C.density[0],C.density[1],100]),!C)continue;if(C.food.quantity>0&&this.state===h.TO_FOOD||this.state===h.TO_HOME&&C.colony){n=T,this.direction.setDirectionAngle(n.heading()),this.foundCell=!0;return}const b=C.dist*C.dist,j=C.getIntensity(this.state)*b;j>e&&(e=j,n=T,o=C),j<s&&(s=j)}if(e==s){this.foundCell=!1;return}e?(o&&this.debug&&(o.density=[0,100,0]),this.direction.setDirectionAngle(n.heading()),this.foundCell=!0):this.foundCell=!1}}update(t,e,s){this.internalClock+=e,this.markerIntensityClock+=e,this.directionClock+=e,this.internalClock>=r.AUTONOMY_REFILL&&this.state===h.TO_FOOD&&(this.state=h.REFILL),this.internalClock>=this.maxAutonomy&&(this.isDead=!0),this.direction.update(),this.foundCell?this.direction.setAndAddDirectionAngle(P(-r.DIRECTION_NOISE_RANGE/5,r.DIRECTION_NOISE_RANGE/5)):this.direction.setAndAddDirectionAngle(P(-r.DIRECTION_NOISE_RANGE,r.DIRECTION_NOISE_RANGE)),this.updatePosition(t);const n=t.getCellFromCoordsSafe(this.pos.x,this.pos.y);if(n==null||n.addDensity(this.state===h.TO_HOME,this.state===h.REFILL),n&&n.food.quantity>0&&(this.state===h.TO_FOOD||this.state===h.REFILL)){this.state=h.TO_HOME,this.foodAmount=n.pick(),this.direction.addImmediate(Math.PI),this.internalClock=0,this.markerIntensityClock=0;return}if(n&&n.food.quantity>0&&this.state===h.TO_HOME&&(this.markerIntensityClock=0),n&&n.colony&&this.state===h.TO_FOOD&&(this.markerIntensityClock=0),n&&n.colony&&(this.state===h.REFILL||this.state===h.TO_HOME)){if(this.state===h.TO_HOME&&(this.direction.addImmediate(Math.PI),s.addFood(this.foodAmount)),this.state===h.REFILL&&!s.useFood(V.ANT_REFILL_FOOD_AMOUNT))return;this.state=h.TO_FOOD,this.internalClock=0,this.markerIntensityClock=0;return}}draw(){this.ctx.translate(this.pos.x,this.pos.y),this.ctx.rotate(this.direction.vector.heading()+Math.PI/2);const t=-r.IMG_WIDTH/2,e=-r.IMG_HEIGHT/2;this.state===h.TO_HOME&&this.ctx.drawImage(this.antFoodImageInstance,-r.FOOD_SIZE/2,e-r.FOOD_SIZE/2),this.ctx.drawImage(this.antImageInstance,t,e),this.debug&&(this.ctx.strokeStyle="#FF0000",this.ctx.lineWidth=2,this.ctx.strokeRect(t,e,r.IMG_WIDTH,r.IMG_HEIGHT),this.ctx.fillStyle="red",D(this.ctx,0,0,4)),this.debug&&(this.ctx.fillStyle="white",D(this.ctx,this.pos.x,this.pos.y,3)),this.ctx.resetTransform()}addMarker(t,e){if(this.markerClock+=e,this.markerClock>=this.markerPeriod){const[s,n]=t.getCellCoords(this.pos.x,this.pos.y);if(!t.checkCoords(s,n))return;const o=r.MARKER_DEFAULT_INTENSITY*Math.exp(-.15*this.markerIntensityClock);if(o<.01){this.markerClock=0;return}let l=-1;switch(this.state){case h.TO_HOME:l=nt.TO_FOOD;break;case h.TO_FOOD:l=nt.TO_HOME;break;case h.REFILL:l=nt.TO_HOME;break}t.addMarker(s,n,l,o),this.markerClock=0}}}class zs{constructor(t){a(this,"id");a(this,"x");a(this,"y");a(this,"startingAntsCount");a(this,"maxAntsCount");a(this,"ants");a(this,"totalAnts");a(this,"colonyColor");a(this,"antIcon");a(this,"antImageInstance");a(this,"antFoodImageInstance");a(this,"antId");a(this,"isRunning");a(this,"isDrawingAnts");a(this,"isDebugMode");a(this,"colonyClock");a(this,"antsCtx");a(this,"selectedAnt");a(this,"simulationType");a(this,"food");a(this,"totalFood");a(this,"maxFood");this.id=t.id,this.x=t.pos.x,this.y=t.pos.y,this.startingAntsCount=V.COLONY_STARTING_ANTS,this.maxAntsCount=V.COLONY_MAX_ANTS,this.ants=[],this.totalAnts=0,this.colonyColor=t.colonyColor||[255,255,255],this.antIcon=null,this.antImageInstance=null,this.antFoodImageInstance=null,this.antId=0,this.isRunning=!1,this.isDrawingAnts=!1,this.isDebugMode=!1,this.colonyClock=0,this.antsCtx=null,this.selectedAnt=null,this.simulationType=tt.ADVANCED,this.food=0,this.totalFood=0,this.maxFood=V.COLONY_MAX_FOOD}initialize(t,e,s,n,o){this.antIcon=t,this.antImageInstance=e,this.antFoodImageInstance=s,this.antsCtx=n;for(let l=0;l<this.startingAntsCount;l++){if(this.simulationType===tt.ADVANCED){const c=new Gt(n,e,s,t,{id:this.antId+1,pos:{x:this.x,y:this.y}});this.ants.push(c)}else{const c=new Yt(n,e,s,t,{id:this.antId+1,pos:{x:this.x,y:this.y}});this.ants.push(c)}this.antId++,this.totalAnts++}this.drawAndFillMidpointCircle(o,this.x,this.y,V.COLONY_RADIUS)}reset(t){if(!(!this.antsCtx||!this.antImageInstance||!this.antFoodImageInstance||!this.antIcon)){this.ants=[],this.antId=0,this.totalAnts=0,this.colonyClock=0,this.food=0,this.totalFood=0,this.selectedAnt=null;for(let e=0;e<this.startingAntsCount;e++){if(this.simulationType===tt.ADVANCED){const s=new Gt(this.antsCtx,this.antImageInstance,this.antFoodImageInstance,this.antIcon,{id:this.antId+1,pos:{x:this.x,y:this.y}});this.ants.push(s)}else{const s=new Yt(this.antsCtx,this.antImageInstance,this.antFoodImageInstance,this.antIcon,{id:this.antId+1,pos:{x:this.x,y:this.y}});this.ants.push(s)}this.antId++,this.totalAnts++}this.drawAndFillMidpointCircle(t,this.x,this.y,V.COLONY_RADIUS)}}drawMidpointCircle(t,e,s,n){let o=n,l=0,c=1-n;if(this.drawSymmetricPoints(t,e,s,o,l),n>0)for(;o>l;)l++,c<=0?c=c+2*l+1:(o--,c=c+2*l-2*o+1),this.drawSymmetricPoints(t,e,s,o,l)}drawSymmetricPoints(t,e,s,n,o){n*=g.SIZE,o*=g.SIZE;const l=t.getCellFromCoordsSafe(e+n,s+o);l&&(l.colony=!0);const c=t.getCellFromCoordsSafe(e-n,s+o);c&&(c.colony=!0);const I=t.getCellFromCoordsSafe(e+n,s-o);I&&(I.colony=!0);const E=t.getCellFromCoordsSafe(e-n,s-o);E&&(E.colony=!0);const u=t.getCellFromCoordsSafe(e+o,s+n);u&&(u.colony=!0);const T=t.getCellFromCoordsSafe(e-o,s+n);T&&(T.colony=!0);const O=t.getCellFromCoordsSafe(e+o,s-n);O&&(O.colony=!0);const x=t.getCellFromCoordsSafe(e-o,s-n);x&&(x.colony=!0)}drawAndFillMidpointCircle(t,e,s,n){let o=n,l=0,c=1-n;if(this.drawAndFillSymmetricLines(t,e,s,o,l),n>0)for(;o>l;)l++,c<=0?c=c+2*l+1:(o--,c=c+2*l-2*o+1),this.drawAndFillSymmetricLines(t,e,s,o,l)}drawAndFillSymmetricLines(t,e,s,n,o){n*=g.SIZE,o*=g.SIZE,this.drawHorizontalLine(t,e-n,e+n,s+o),this.drawHorizontalLine(t,e-n,e+n,s-o),this.drawHorizontalLine(t,e-o,e+o,s+n),this.drawHorizontalLine(t,e-o,e+o,s-n)}drawHorizontalLine(t,e,s,n){for(let o=e;o<=s;o++){const l=t.getCellFromCoordsSafe(o,n);l&&(l.colony=!0)}}updateAndDrawAnts(t,e,s=!0){let n=!1;const o=r.IMG_HEIGHT*d,l=(Cs+o)/d,c=(Ts-R+o)/d,I=f.x-l/2,E=f.y-R/2/d-c/2;for(let u=0;u<this.ants.length;u++)this.isRunning&&(this.simulationType===tt.ADVANCED?(this.ants[u].find(t),this.ants[u].update(t,e,this),this.ants[u].addMarker(t,e)):(this.ants[u].searchSimple(t,this),this.ants[u].update(e),this.ants[u].addMarker(t,e)),this.ants[u].isDead&&(n=!0)),s&&this.isDrawingAnts&&this.ants[u].pos.x>=I&&this.ants[u].pos.x<=I+l&&this.ants[u].pos.y>=E&&this.ants[u].pos.y<=E+c&&this.ants[u].draw(),n&&(console.log("Removed ant: ",this.ants[u]),this.ants.splice(u,1),n=!1)}updateColony(t){!this.isRunning||(this.colonyClock+=t,this.colonyClock>=V.ANT_CREATION_PERIOD&&this.ants.length<this.maxAntsCount&&this.useFood(V.ANT_COST)&&(this.createAnt(),this.colonyClock=0))}createAnt(t=!1){if((this.ants.length<this.maxAntsCount||t)&&this.antIcon&&this.antImageInstance&&this.antFoodImageInstance&&this.antsCtx){if(this.simulationType===tt.ADVANCED){const e=new Gt(this.antsCtx,this.antImageInstance,this.antFoodImageInstance,this.antIcon,{id:this.antId+1,pos:{x:this.x,y:this.y}});this.ants.push(e),this.isDebugMode&&console.log("Created ant: ",e)}else{const e=new Yt(this.antsCtx,this.antImageInstance,this.antFoodImageInstance,this.antIcon,{id:this.antId+1,pos:{x:this.x,y:this.y}});this.ants.push(e),this.isDebugMode&&console.log("Created ant: ",e)}this.antId++,this.totalAnts++}else this.isDebugMode&&console.log("Can't create new ant - max count reached")}selectAnt(t){if(this.ants.length<=0)return null;let e=null,s=1/0;const n=r.IMG_HEIGHT/2;for(const o of this.ants){const l=o.pos.dist(t);l<s&&l<n&&(s=l,e=o)}return this.selectedAnt=e,e}removeAnt(){if(this.selectedAnt==null||this.ants.length<=0)return!1;const t=this.ants.findIndex(e=>{var s;return e.id===((s=this.selectedAnt)==null?void 0:s.id)});return t!=-1?(this.ants.splice(t,1),this.selectedAnt=null,!0):!1}toggleAntDebug(){if(this.ants.length>0)for(const t of this.ants)this.selectedAnt&&t.id===this.selectedAnt.id?t.debug=this.isDebugMode:t.debug=!1}drawColony(t){t.fillStyle=`rgb(${this.colonyColor[0]}, ${this.colonyColor[1]}, ${this.colonyColor[2]})`,D(t,this.x,this.y,V.COLONY_RADIUS*g.SIZE+g.SIZE/2)}addFood(t){this.food=Math.min(this.food+t,this.maxFood),this.totalFood+=t}useFood(t){return this.food>=t?(this.food-=t,!0):!1}}class ds{constructor(t){a(this,"width");a(this,"height");this.width=t.width,this.height=t.height}createInstance(t){const e=document.createElement("canvas");e.width=this.width,e.height=this.height,console.log(`Created canvas image instance with size: ${this.width} x ${this.height}`);const s=e.getContext("2d");return s&&t(s,e),e}}class Zs{constructor(t){a(this,"measurementArray");a(this,"sampleSize");a(this,"isMeasuring");a(this,"modes");a(this,"mode");this.measurementArray=new Map,this.sampleSize=60,this.isMeasuring=!0,this.modes=[],this.mode=0,this.getModes(t),this.createMeasurementArray(t)}getModes(t){for(const e of t)this.modes.push(e.mode)}changeMode(){this.mode==this.modes.length-1?(this.isMeasuring=!1,this.mode=-1):(this.isMeasuring=!0,this.mode++),this.toggleDisplayVisibility()}toggleDisplayVisibility(){for(const t of this.measurementArray.values()){if(!t.element)return;this.isMeasuring&&t.mode<=this.mode?t.element.style.display="block":t.element.style.display="none"}}createMeasurementArray(t){for(const e of t)for(const s of e.stats)this.measurementArray.set(s.name,{performanceArray:[],title:s.title,mode:e.mode,index:0})}createPerformanceDisplay(t){const e=[];for(const[s,n]of this.measurementArray){const o=document.createElement("span");o.dataset[s.toString()]="",o.title=n.title,this.isMeasuring&&n.mode<=this.mode?o.style.display="block":o.style.display="none",n.element=t.appendChild(o),e.push(n.element)}return e}startMeasurement(t){const e=this.measurementArray.get(t);e&&e.mode<=this.mode&&(e.startTime=performance.now())}endMeasurement(t){const e=this.measurementArray.get(t);e&&e.startTime&&e.mode<=this.mode&&(e.performanceArray[e.index]=performance.now()-e.startTime)}setPerformance(t,e){const s=this.measurementArray.get(t);s&&s.mode<=this.mode&&(s.performanceArray[s.index]=e)}update(){const t=new Map;for(const e of this.measurementArray.keys())t.set(e,0);for(const[e,s]of this.measurementArray)for(let n=0;n<s.performanceArray.length;n++)t.set(e,t.get(e)+s.performanceArray[n]);for(const[e,s]of this.measurementArray){if(s.performanceArray.length===0)break;t.set(e,t.get(e)/s.performanceArray.length),s.mode<=this.mode&&(s.index++,s.index===this.sampleSize&&(s.index=0))}return t}}class Bs{calculateDistances(t){for(let e=0;e<t.width;e++)for(let s=0;s<t.height;s++){const n=t.cells[t.getIndexFromCoords(e,s)];n.wall?n.dist=this.getMinDistance(e,s,t,!1,10):n.dist=this.getMinDistance(e,s,t,!0,3)}}calculateFoodDistances(t){for(let e=0;e<t.width;e++)for(let s=0;s<t.height;s++){const n=t.cells[t.getIndexFromCoords(e,s)];if(n.food.quantity>0){const o=Math.round(this.getMinDistance(e,s,t,!1,3,!0)*100);n.food.quantity=o,n.food.changed=!0}}}getMinDistance(t,e,s,n,o,l=!1){let c=o;for(let I=-o;I<=o;I++)for(let E=-o;E<=o;E++){const u=s.cells[s.getIndexFromCoords(t+I,e+E)];if(u){if(l){if(u.food.quantity==0&&!u.wall){const T=H(I,E).mag();T<c&&(c=T)}}else if(u.wall&&n||!u.wall&&!n){const T=H(I,E).mag();T<c&&(c=T)}}}return c=Math.min(1,c/o)}}class mt{constructor(t,e){a(this,"canvas");a(this,"width");a(this,"height");a(this,"cellSize");this.canvas=t,this.width=e.width,this.height=e.height,this.cellSize=e.cellSize}create(){return this.canvas.width=this.width,this.canvas.height=this.height,console.log(`Created canvas with size: ${this.width} x ${this.height}`),this.canvas.getContext("2d")}}function qs(i){let t=Math.floor(i.width/i.cellSize),e=Math.floor(i.height/i.cellSize);t%2===0&&t--,e%2===0&&e--;const s=t*i.cellSize,n=e*i.cellSize;return console.log(`Calculate sizes:
${i.width==s?s:`${i.width} -> ${s}`} x ${i.height==n?n:`${i.height} -> ${n}`}`),[s,n]}class Ws{constructor(t){a(this,"quantity");a(this,"changed");this.quantity=t,this.changed=!0}draw(t,e,s){t.clearRect(e*_.SIZE,s*_.SIZE,_.SIZE,_.SIZE);const n=e*_.SIZE+_.SIZE/2,o=s*_.SIZE+_.SIZE/2;t.fillStyle=`hsl(120, 40%, 43%, ${this.quantity/100})`,D(t,n,o,_.SIZE/2,!0),this.changed=!1}pick(){if(this.changed=!0,this.quantity===0)return 0;let t=0;return this.quantity<_.PICK_AMOUNT?t=this.quantity:t=_.PICK_AMOUNT,this.quantity=Math.max(this.quantity-_.PICK_AMOUNT,0),t}}class $s{constructor(t){a(this,"intensity");this.intensity=t}getToHomeIntensity(){return this.intensity[0]}getToFoodIntensity(){return this.intensity[1]}getMixedColor(){if(this.intensity[0]===0&&this.intensity[1]===0)return[0,0,0];const[t,e,s]=Ze.TO_HOME,[n,o,l]=Ze.TO_FOOD,c=[this.intensity[0]*t,this.intensity[0]*e,this.intensity[0]*s];if(this.intensity[1]===0)return[Math.round(c[0]),Math.round(c[1]),Math.round(c[2])];const I=[this.intensity[1]*n,this.intensity[1]*o,this.intensity[1]*l];if(this.intensity[0]===0)return[Math.round(I[0]),Math.round(I[1]),Math.round(I[2])];let E=[c[0]+I[0],c[1]+I[1],c[2]+I[2]];return E=[Math.round(Math.min(E[0],255)),Math.round(Math.min(E[1],255)),Math.round(Math.min(E[2],255))],E}update(){this.intensity[0]>.01?this.intensity[0]-=Be:this.intensity[0]=0,this.intensity[1]>.01?this.intensity[1]-=Be:this.intensity[1]=0}}class We{constructor(){a(this,"marker");a(this,"food");a(this,"wall");a(this,"density");a(this,"colony");a(this,"dist");a(this,"minIntensity");this.marker=new $s([0,0]),this.food=new Ws(0),this.wall=0,this.density=[0,0,0],this.colony=!1,this.dist=0,this.minIntensity=.1}update(){this.marker.update()}pick(){return this.food.pick()}drawWall(t,e,s,n){if(n){const o=Math.min(1,1-this.dist+.15);t.fillStyle=`rgb(${163*o}, ${163*o}, ${163*o})`}t.fillRect(e,s,1,1)}addDensity(t=!1,e=!1){!t&&!e?this.density[0]++:e?this.density[2]++:this.density[1]++}getIntensity(t){return Math.max(this.minIntensity,t===h.TO_FOOD?this.marker.getToFoodIntensity():t===h.TO_HOME?this.marker.getToHomeIntensity():Math.max(this.marker.getToFoodIntensity(),this.marker.getToHomeIntensity()))}}class Vs{constructor(t){a(this,"width");a(this,"height");a(this,"cellSize");a(this,"cells");this.width=t.width,this.height=t.height,this.cellSize=t.cellSize,this.cells=[];for(let e=0;e<this.width*this.height;e++)this.cells.push(new We)}reset(){this.cells=[];for(let t=0;t<this.width*this.height;t++)this.cells.push(new We)}addBorderWalls(){const t=Rt.BORDER_SIZE;for(let e=0;e<this.width;e++)for(let s=0;s<t;s++){const n=this.cells[this.getIndexFromCoords(e,s)],o=this.cells[this.getIndexFromCoords(e,this.height-s-1)];n.wall=1,o.wall=1}for(let e=0;e<t;e++)for(let s=0;s<this.height;s++){const n=this.cells[this.getIndexFromCoords(e,s)],o=this.cells[this.getIndexFromCoords(this.width-e-1,s)];n.wall=1,o.wall=1}}generateWalls(t){for(let e=0;e<this.width;e++)for(let s=0;s<this.height;s++)this.cells[this.getIndexFromCoords(e,s)].wall=t[e][s]?1:0}generateFood(t){var e;for(let s=0;s<this.width;s++)for(let n=0;n<this.height;n++)this.cells[this.getIndexFromCoords(s,n)].food.quantity=(e=t[s][n])!=null?e:0,this.cells[this.getIndexFromCoords(s,n)].food.changed=!0}update(){for(const t of this.cells)this.updateCell(t)}updateCell(t){t.marker.update();for(let e=0;e<3;e++)t.density[e]>.01?t.density[e]*=.99:t.density[e]=0}addMarker(t,e,s,n){const o=this.cells[this.getIndexFromCoords(t,e)];s===nt.TO_HOME?o.marker.intensity[0]=Math.min(1,Math.max(o.marker.getToHomeIntensity(),n)):s===nt.TO_FOOD&&(o.marker.intensity[1]=Math.min(1,Math.max(o.marker.getToFoodIntensity(),n)))}addFood(t,e,s){const n=this.getIndexFromCoords(t,e);if(n>this.cells.length||n<0)return;const o=this.cells[n];o.food.quantity=Math.min(o.food.quantity+s,100),o.food.changed=!0}drawMarkers(t,e,s=!0){for(let n=0;n<e.data.length;n+=4){const o=this.cells[n/4];e.data[n+0]=o.marker.getToHomeIntensity()*255,e.data[n+1]=o.marker.getToFoodIntensity()*255,e.data[n+2]=0,e.data[n+3]=255,s&&this.updateCell(o)}t.putImageData(e,0,0)}drawFood(t){for(let e=0;e<this.cells.length;e++)if(this.cells[e].food.changed){const[s,n]=this.getCoordsFromIndex(e);this.cells[e].food.draw(t,s,n)}}drawWalls(t,e=!0){t.fillStyle="rgb(163, 163, 163)";for(let s=0;s<this.width;s++)for(let n=0;n<this.height;n++){const o=this.cells[this.getIndexFromCoords(s,n)];o.wall===1&&o.drawWall(t,s,n,e)}}drawDensity(t,e,s=!0,n=!1){for(let o=0;o<e.data.length;o+=4){const l=this.cells[o/4],c=l.density;if(n)e.data[o+0]=4*c[0],e.data[o+1]=4*c[1],e.data[o+2]=4*c[2],e.data[o+3]=255;else{const I=c[0]+c[1]+c[2];e.data[o+0]=4*I,e.data[o+1]=I,e.data[o+2]=I,e.data[o+3]=255}s&&this.updateCell(l)}t.putImageData(e,0,0)}isOnFood(t,e){return this.cells[this.getIndexFromCoords(t,e)].food.quantity>0}getIndexFromCoords(t,e){return t+e*this.width}getCoordsFromIndex(t){const e=t%this.width,s=Math.floor(t/this.width);return[e,s]}getCellCoords(t,e){const s=Math.floor(t/g.SIZE),n=Math.floor(e/g.SIZE);return[s,n]}getCellFromCoords(t,e,s=!1){return s||([t,e]=this.getCellCoords(t,e)),this.cells[this.getIndexFromCoords(t,e)]}getCellFromCoordsSafe(t,e){const[s,n]=this.getCellCoords(t,e);return this.checkCoords(s,n)?this.getCellFromCoords(s,n,!0):null}checkCoords(t,e){return t>-1&&t<this.width&&e>-1&&e<this.height}rayCast(t,e,s){const n=s*Math.cos(e),o=s*Math.sin(e),l=t.copy();l.x+=n,l.y+=o;const c=l.copy().sub(t).normalize(),I={x:Math.sqrt(1+c.y/c.x*(c.y/c.x)),y:Math.sqrt(1+c.x/c.y*(c.x/c.y))},E={x:t.x,y:t.y},u={x:0,y:0},T={x:0,y:0};c.x<0?(T.x=-1,u.x=(t.x-Math.round(E.x))*I.x):(T.x=1,u.x=(Math.round(E.x+1)-t.x)*I.x),c.y<0?(T.y=-1,u.y=(t.y-Math.round(E.y))*I.y):(T.y=1,u.y=(Math.round(E.y+1)-t.y)*I.y);const O={maxWidth:this.width*g.SIZE,maxHeight:this.height*g.SIZE};let x=!1,C=0;for(;!x&&C<s&&(u.x<u.y?(E.x+=T.x,C=u.x,u.x+=I.x):(E.y+=T.y,C=u.y,u.y+=I.y),!(E.x<0||E.x>=O.maxWidth||E.y<0||E.y>=O.maxHeight));){const b=this.getCellFromCoords(E.x,E.y);if(b&&b.wall==1){x=!0;const j={x:u.x<u.y?1:0,y:u.y<u.x?1:0};return{cell:b,distance:C,normal:j,intersection:t.add(c.multSimple(C)),rayEnd:l}}}return null}}function Us(){return new Worker("/Ants_Simulation/assets/mapWorker.58459cd4.js",{type:"module"})}const ct=document.getElementById("canvas-container"),Ys=document.getElementById("camera-container"),Gs=document.getElementById("btn-fullscreen"),Ks=document.getElementById("btn-pan"),Xs=document.getElementById("btn-zoom-in"),js=document.getElementById("btn-zoom-out"),Qs=document.getElementById("canvas"),us=document.getElementById("canvas-markers"),fs=document.getElementById("canvas-food"),Js=document.getElementById("canvas-colony"),ms=document.getElementById("canvas-walls"),bt=document.getElementById("canvas-edit"),Nt=document.getElementById("canvas-edit-preview"),$e=document.getElementById("antIcon"),vt=document.getElementById("btn-ant-panel"),se=document.getElementById("antPanel"),Ve=document.querySelector("[data-id]"),Ue=document.querySelector("[data-pos]"),ce=document.querySelector("[data-vel]"),Ye=document.querySelector("[data-state]"),he=document.querySelector("[data-lifespan-preview]"),Ge=document.querySelector("[data-lifespan]"),Ke=document.querySelector("[data-marker-preview]"),Xe=document.querySelector("[data-marker]"),Ie=document.getElementById("btn-track"),tn=document.getElementById("btn-remove"),Ee=document.getElementById("btn-cell-panel"),ys=document.getElementById("cellPanel"),je=document.querySelector("[data-cell-preview]"),Qe=document.querySelector("[data-coords]"),Je=document.querySelector("[data-intensity-home]"),ts=document.querySelector("[data-intensity-food]"),es=document.querySelector("[data-cell-food]"),ss=document.querySelector("[data-density]"),ns=document.querySelector("[data-dist]"),is=document.querySelector("[data-colony]"),pe=document.getElementById("btn-colony-panel"),gs=document.getElementById("colonyPanel"),os=document.querySelector("[data-colony-preview]"),as=document.querySelector("[data-colony-pop]"),rs=document.querySelector("[data-colony-food]"),ls=document.querySelector("[data-colony-total-food]"),cs=document.querySelector("[data-pause]"),Is=document.getElementById("btn-play"),Es=document.getElementById("btn-pause"),Re=document.getElementById("btn-edit-mode"),ps=document.getElementById("editPanel"),hs=document.querySelector("[data-brush-preview]"),en=document.querySelector("[data-brush-size]"),sn=document.getElementById("brush-size-minus"),nn=document.getElementById("brush-size-plus"),dt=document.getElementById("brushSizeInput"),ne=document.getElementById("btn-wall-brush"),Fe=document.getElementById("btn-food-brush"),on=document.getElementById("btn-save"),an=document.getElementById("btn-controls"),rn=document.getElementById("btn-close-controls"),ie=document.getElementById("controlsPanel"),ln=document.querySelector("[data-performance-display]"),yt=document.getElementById("mapPanel"),cn=document.getElementById("btn-close-map"),hn=document.getElementById("btn-cancel-map"),dn=document.getElementById("btn-map-panel"),un=document.getElementById("btn-generate-seed"),fn=document.getElementById("btn-generate-save-map"),mn=document.getElementById("map-form"),_t=document.getElementById("map-seed"),Ht=document.getElementById("btn-ants-layer"),zt=document.getElementById("btn-density-layer"),Zt=document.getElementById("btn-density-all-layer"),Bt=document.getElementById("btn-markers-layer"),kt=document.getElementById("confirmDialog"),yn=document.getElementById("btn-cancel"),gn=document.getElementById("btn-confirm"),In=document.getElementById("btn-simulation-panel"),wt=document.getElementById("simulationTypeDialog"),Oe=document.getElementById("btn-simulation-advanced"),Ce=document.getElementById("btn-simulation-simple"),En=document.getElementById("btn-close-simulation-type-dialog"),Os=new Us;Os.onmessage=i=>{var t;if(console.log(`Worker said : ${i.data.action}`),i.data.action=="GENERATE_PARTIAL"&&k&&(k.clearRect(0,0,y.width,y.height),y.generateWalls(i.data.map),y.drawWalls(k,!1)),i.data.action=="GENERATE"){const e=i.data.seed,s=new URL(window.location.href);e&&(s.searchParams.set("seed",e),window.history.pushState({path:s.href},"",s.href)),_t.value=(t=new URL(window.location.href).searchParams.get("seed"))!=null?t:"",k&&qt&&(k.clearRect(0,0,y.width,y.height),y.generateWalls(i.data.map),console.log("calculate"),_e.calculateDistances(y),console.log("draw"),y.drawWalls(k),y.generateFood(i.data.foodMap),_e.calculateFoodDistances(y)),Se=!1}};let q=!1,St=!0,U=!1,Y=!1,Te=!1,ut=!1,xt=!1,L=!1,Ae=!1,Me=!1,G=!1,st=!1,de=!1,Kt=!0,De=!1,Se=!1,Xt=!1,Lt=!1,$=!1,K=!1,S=!1,B=!1,v=!1,ue=0;const w=new Zs([{mode:0,stats:[{name:"fps",title:"Frames per second"},{name:"ms",title:"Milliseconds to render a frame"}]},{mode:1,stats:[{name:"clear",title:"Milliseconds to clear the screen"},{name:"grid",title:"Milliseconds to draw markers/density and update cells"},{name:"food",title:"Milliseconds to draw food"},{name:"ants",title:"Milliseconds to draw and update ants"},{name:"panels",title:"Milliseconds to update info panels"},{name:"all",title:"Milliseconds needed for main loop"}]}]),[pn,fe,On,Cn,Tn,An,Mn,Sn]=w.createPerformanceDisplay(ln),R=ct.getBoundingClientRect().top;let oe=0,ae=0,d=1,At=!1,jt=!1,me=0;const J={x:0,y:0},p={x:0,y:0},f={x:0,y:0};let $t=0,xe=!1,X=5;const xn=new URL(window.location.href),ye=xn.searchParams.get("seed");let Ft=ye!=null?ye:"";_t.value=Ft;let Cs=window.innerWidth,Ts=window.innerHeight;window.addEventListener("resize",()=>{Cs=window.innerWidth,Ts=window.innerHeight;const i={x:0,y:0};i.x=window.innerWidth/2/d-p.x,i.y=window.innerHeight/2/d-p.y,p.x=window.innerWidth/2/d-i.x,p.y=window.innerHeight/2/d-i.y,f.x=(window.innerWidth/2-window.innerWidth/2)/d-i.x,f.y=(window.innerHeight/2-window.innerHeight/2)/d-i.y,f.x=f.x<0?Math.abs(f.x):f.x*-1,f.y=f.y<0?Math.abs(f.y):f.y*-1,gt()});const[z,Z]=qs({width:ze.WIDTH,height:ze.HEIGHT,cellSize:g.SIZE}),wn=new mt(us,{width:z/g.SIZE,height:Z/g.SIZE,cellSize:1});us.style.transform=`scale(${g.SIZE})`;const N=wn.create(),_n=new mt(fs,{width:z/(g.SIZE/_.SIZE),height:Z/(g.SIZE/_.SIZE),cellSize:g.SIZE/_.SIZE});fs.style.transform=`scale(${g.SIZE/_.SIZE})`;const qt=_n.create(),Pn=new mt(Qs,{width:z,height:Z,cellSize:g.SIZE}),Mt=Pn.create(),Rn=new ds({width:r.IMG_WIDTH,height:r.IMG_HEIGHT}),Fn=new ds({width:r.FOOD_SIZE,height:r.FOOD_SIZE}),Dn=new mt(Js,{width:z,height:Z,cellSize:g.SIZE}),we=Dn.create(),kn=new mt(ms,{width:z/g.SIZE,height:Z/g.SIZE,cellSize:1});ms.style.transform=`scale(${g.SIZE})`;const k=kn.create(),Ln=new mt(bt,{width:z/g.SIZE,height:Z/g.SIZE,cellSize:1});bt.style.transform=`scale(${g.SIZE})`;const W=Ln.create(),bn=new mt(Nt,{width:z/g.SIZE,height:Z/g.SIZE,cellSize:1});Nt.style.transform=`scale(${g.SIZE})`;const Dt=bn.create(),y=new Vs({width:z/g.SIZE,height:Z/g.SIZE,cellSize:1}),_e=new Bs;ht({action:"SETUP",mapGeneratorOptions:{width:y.width,height:y.height,fillRatio:Rt.FILL_RATIO,fillRatioFood:Rt.FILL_RATIO_FOOD,threshold:Rt.THRESHOLD,thresholdFood:Rt.THRESHOLD_FOOD}},!0);const Qt=N==null?void 0:N.createImageData(y.width,y.height),Vt=N==null?void 0:N.createImageData(y.width,y.height),m=new zs({id:1,pos:{x:z/2,y:Z/2}});window.addEventListener("keydown",i=>{if(!De)switch(i.code){case"Space":i.preventDefault(),te();break;case"KeyM":xs();break;case"KeyN":Le();break;case"KeyA":Ps();break;case"KeyD":zn();break;case"KeyT":_s();break;case"KeyC":L?Nn():be();break;case"KeyR":if(i.ctrlKey)break;q=!0,te(),B=A(B,kt);break;case"Delete":Rs();break;case"Insert":for(let t=0;t<(i.ctrlKey?10:i.shiftKey?100:1);t++)Bn();break;case"KeyF":w.changeMode();break;case"KeyQ":L&&As();break;case"KeyE":if(B){Pt(),ht({action:"GENERATE",seed:ft(!1)}),B=A(B,kt);break}L?Ms():Pe();break;case"KeyS":L&&Ss();break;case"ArrowUp":Ut(0,i.ctrlKey?lt*5:lt,!!i.shiftKey);break;case"ArrowDown":Ut(0,i.ctrlKey?-lt*5:-lt,!!i.shiftKey);break;case"ArrowLeft":if(xt&&m.selectedAnt){const t=m.selectedAnt.id,e=m.ants.findIndex(n=>n.id===t),s=m.ants.length;m.selectedAnt=m.ants[e-1>=0?e-1:s-1]}else Ut(i.ctrlKey?lt*5:lt,0,!!i.shiftKey);break;case"ArrowRight":if(xt&&m.selectedAnt){const t=m.selectedAnt.id,e=m.ants.findIndex(n=>n.id===t),s=m.ants.length;m.selectedAnt=m.ants[e+1<s?e+1:0]}else Ut(i.ctrlKey?-lt*5:-lt,0,!!i.shiftKey);break;case"Minus":ee(!1);break;case"Equal":ee(!0);break;case"Comma":Jt(-it.STEP);break;case"Period":Jt(it.STEP);break;case"Escape":B&&(B=A(B,kt)),K&&(K=A(K,ie)),S&&(S=A(S,yt)),L&&Pe();break}});ct.addEventListener("mousemove",i=>{oe=i.pageX,ae=i.pageY-R});ct.addEventListener("click",()=>{if(jt){jt=!1;return}Zn(),ut&&ws()});ct.addEventListener("contextmenu",i=>{if(i.preventDefault(),L)return;const t=H(Math.floor((oe/d-p.x)/g.SIZE),Math.floor((ae/d-p.y)/g.SIZE));ut&&console.log(`Placed food at: ${t.x}:${t.y}`),y.addFood(t.x,t.y,10)});ct.addEventListener("wheel",i=>{Yn(i)});Gs.addEventListener("click",()=>{be()});Xs.addEventListener("click",()=>{ee(!0)});js.addEventListener("click",()=>{ee(!1)});Ie.addEventListener("click",()=>{_s()});tn.addEventListener("click",()=>{Rs()});Is.addEventListener("click",()=>{te()});Es.addEventListener("click",()=>{te()});sn.addEventListener("click",()=>{Jt(-it.STEP)});nn.addEventListener("click",()=>{Jt(it.STEP)});pe.addEventListener("click",()=>{Xt=A(Xt,gs,pe)});Xt=A(Xt,gs,pe);Ee.addEventListener("click",()=>{Lt=A(Lt,ys,Ee)});vt.addEventListener("click",()=>{$=A($,se,vt)});an.addEventListener("click",()=>{K=A(K,ie),S=!0,S=A(S,yt)});rn.addEventListener("click",()=>{K=!0,K=A(K,ie)});dn.addEventListener("click",()=>{S=A(S,yt),K=!0,K=A(K,ie)});cn.addEventListener("click",()=>{S=!0,S=A(S,yt)});hn.addEventListener("click",()=>{S=!0,S=A(S,yt)});un.addEventListener("click",()=>{const i=Math.random().toString(36).slice(2,7);console.log(i),_t.value=i});gn.addEventListener("click",()=>{Pt(),ht({action:"GENERATE",seed:ft(!1)}),B=A(B,kt)});yn.addEventListener("click",()=>{B=A(B,kt)});Ht.addEventListener("click",()=>{M(m.isDrawingAnts,Ht),Ps()});zt.addEventListener("click",()=>{M(m.isDrawingAnts,zt),Le(!0,!1)});Zt.addEventListener("click",()=>{M(m.isDrawingAnts,Zt),Le(!1,!0)});Bt.addEventListener("click",()=>{M(m.isDrawingAnts,Bt),xs()});_t.addEventListener("focus",()=>{De=!0});_t.addEventListener("blur",()=>{De=!1});mn.addEventListener("submit",i=>{console.log("submit",i),Ft=_t.value,console.log(Ft),S=!0,S=A(S,yt),k&&Ft&&(Pt(),ht({action:"GENERATE",seed:ft(!1,Ft)})),i.preventDefault()});fn.addEventListener("click",()=>{S=!0,S=A(S,yt),k&&(Pt(),ht({action:"GENERATE",seed:ft(!1)}))});Re.addEventListener("click",()=>{Pe()});function Pe(){L=A(L,ps,Re),L?(bt.style.display="block",Nt.style.display="block"):(bt.style.display="none",Nt.style.display="none")}ne.addEventListener("click",()=>{As()});function As(){G&&!st||(G=M(G,ne),G&&(st=!0,st=M(G,Fe)))}Fe.addEventListener("click",()=>{Ms()});function Ms(){st&&!G||(st=M(st,Fe),st&&(G=!0,G=M(st,ne)))}on.addEventListener("click",()=>{Ss()});function Ss(){if(W&&k){const i=W.getImageData(0,0,y.width,y.height);k.clearRect(0,0,y.width,y.height);for(let t=0;t<i.data.length;t+=4){const e=y.cells[t/4],s=i.data[t+0],n=i.data[t+1],o=i.data[t+2],l=i.data[t+3];n<=160&&n>0&&n>s&&n>o?e.wall!==1?(e.food.quantity=Math.min(100,Math.round(100*(l/255))+e.food.quantity),e.food.changed=!0):e.wall=1:s>10&&n>10&&o>10&&s===n&&n===o?(e.wall=1,e.food.quantity=0,e.food.changed=!0):l>0&&s<5&&n<5&&o<5&&(e.food.quantity=0,e.food.changed=!0,e.wall=0)}y.addBorderWalls(),_e.calculateDistances(y),y.drawWalls(k),W.clearRect(0,0,y.width,y.height),L=A(L,ps,Re),bt.style.display="none",Nt.style.display="none"}}function Nn(){W&&k&&W.clearRect(0,0,y.width,y.height)}dt.addEventListener("input",()=>{X=parseInt(dt.value),ke()});function vn(){dt.min=it.MIN_SIZE.toString(),dt.max=it.MAX_SIZE.toString(),dt.step=it.STEP.toString(),dt.value=X.toString()}function ke(){hs.style.width=`${X}px`,hs.style.height=`${X}px`,en.textContent=`${X} px`}function Jt(i){X=Math.min(it.MAX_SIZE,Math.max(it.MIN_SIZE,X+i)),dt.value=X.toString(),ke()}vn();ke();G=M(G,ne);Hn();Un();be();window.requestAnimationFrame(Fs);function Hn(){if(!(N==null||qt==null||Mt==null||we==null||k==null||W==null||Dt==null)){if(Qt&&(y.drawMarkers(N,Qt),y.drawFood(qt)),$e){const i=new XMLSerializer().serializeToString($e),t=btoa(i),s="data:image/svg+xml;base64,"+t,n=new Image;n.src=s,n.onload=()=>{const o=Rn.createInstance(c=>{c.drawImage(n,0,0)}),l=Fn.createInstance(c=>{const I=r.FOOD_SIZE/2;c.fillStyle="hsl(120, 40%, 43%)",D(c,I,I,r.FOOD_SIZE/2)});m.initialize(n,o,l,Mt,y)}}m.drawColony(we),ht({action:"GENERATE",setup:!0,seed:ft(!0)}),M(!1,Ht),M(!U,zt),M(!Y,Zt),M(!St,Bt)}}function te(){Kt&&(m.isDrawingAnts=!0,Kt=!1),cs&&(q=!q,m.isRunning=q,cs.style.display=q?"none":"block",Is.style.display=q?"none":"flex",Es.style.display=q?"flex":"none")}function xs(){St=M(St,Bt),St&&(U=!1,Y=!1,Te=!1,M(!0,zt),M(!0,Zt))}function Le(i,t){!i&&!t?(Y=!!U,U=!(Y||Te),Te=!U&&Y):i?(U=!U,Y=!1):t&&(Y=!Y,U=!1),(U||Y)&&(St=!1,M(!0,Bt)),M(!U,zt),M(!Y,Zt)}function zn(){ut=!ut,m.isDebugMode=ut,ws(),ut&&(Lt=!1),Lt=A(Lt,ys,Ee)}function ws(){m.toggleAntDebug()}function _s(){m.selectedAnt!=null&&(xt=!xt,xt&&(d=3),Ie.classList.toggle("border-green-500"),Ie.classList.toggle("border-red-500"))}function ge(){de=!de,de?document.body.classList.add("cursor-grabbing"):document.body.classList.remove("cursor-grabbing"),Ks.classList.toggle("bg-neutral-600")}function Ps(){if(Kt){Kt=!1,m.isDrawingAnts=!1,M(!m.isDrawingAnts,Ht);return}m.isDrawingAnts=M(m.isDrawingAnts,Ht)}function ht(i,t=!1){(!Se||t)&&(Se=!t,Os.postMessage(i))}function Pt(){y.reset(),m.reset(y),m.selectedAnt||($=!0,$=A($,se,vt))}In.addEventListener("click",()=>{v=A(v,wt)});Oe.addEventListener("click",()=>{if(m.simulationType===tt.ADVANCED){v=A(v,wt);return}m.simulationType=tt.ADVANCED,M(!1,Oe),M(!0,Ce),v=A(v,wt),Pt(),ht({action:"GENERATE",seed:ft(!0)})});Ce.addEventListener("click",()=>{if(m.simulationType===tt.SIMPLE){v=A(v,wt);return}m.simulationType=tt.SIMPLE,M(!0,Oe),M(!1,Ce),v=A(v,wt),Pt(),ht({action:"GENERATE",seed:ft(!0)})});En.addEventListener("click",()=>{v=!0,v=A(v,wt)});function Zn(){const i=H(oe/d-p.x,ae/d-p.y);m.selectAnt(i),m.selectedAnt?$=!1:$=!0,$=A($,se,vt)}function Rs(){m.removeAnt()&&($=!0,$=A($,se,vt))}function Bn(){m.createAnt(!0)}function qn(){const i=m.selectedAnt;if(!i||!Ve||!Ue||!ce||!Ye||!he||!Ge||!Ke||!Xe)return;Ve.textContent=i.id.toString(),Ue.textContent=`${i.pos.x.toFixed(2)} : ${i.pos.y.toFixed(2)}`,i instanceof Yt?ce.textContent=`${i.vel.x.toFixed(2)} : ${i.vel.y.toFixed(2)}`:ce.textContent=`${i.direction.vector.x.toFixed(2)} : ${i.direction.vector.y.toFixed(2)}`;let t="";switch(i.state){case h.TO_HOME:t="To Home";break;case h.TO_FOOD:t="To Food";break;case h.REFILL:t="Refill";break}Ye.textContent=t;const e=r.AUTONOMY_REFILL/i.maxAutonomy,s=i.internalClock/i.maxAutonomy;if(he.style.setProperty("--left",`${e*100}%`),he.style.setProperty("--width",`${s*100}%`),Ge.textContent=`${i.internalClock.toFixed(2)} | ${i.maxAutonomy.toFixed(2)}`,i instanceof Gt){const n=r.MARKER_DEFAULT_INTENSITY*Math.exp(-.15*i.markerIntensityClock);Ke.style.setProperty("--width",`${n/1*100}%`),Xe.textContent=`${n.toFixed(2)} | ${1} | ${i.markerIntensityClock.toFixed(2)}`}}function Wn(i,t){const e=y.getCellFromCoordsSafe(i,t);if(!e||!Je||!ts||!es||!ss||!je||!ns||!is||!Qe)return;Qe.textContent=`${i.toFixed(0)}-${t.toFixed(0)}`,Je.textContent=e.marker.getToHomeIntensity().toFixed(2),ts.textContent=e.marker.getToFoodIntensity().toFixed(2),es.textContent=e.food.quantity.toString(),ss.textContent=(e.density[0]+e.density[1]+e.density[2]).toFixed(2);const s=e.marker.getMixedColor();je.style.backgroundColor=`rgb(${s[0]}, ${s[1]}, ${s[2]})`,ns.textContent=e.dist.toFixed(2),is.textContent=e.colony?"Yes":"No"}function $n(){if(!m||!as||!rs||!ls||!os)return;as.textContent=`${m.ants.length} | ${m.totalAnts}`,rs.textContent=m.food.toFixed(2),ls.textContent=m.totalFood.toFixed(2);const i=m.colonyColor;os.style.backgroundColor=`rgb(${i[0]}, ${i[1]}, ${i[2]})`}function Vn(){const i=w.update();pn.textContent=`${Math.round(i.get("fps")*100)/100} fps`,fe.textContent=`${Math.round(i.get("ms")*100)/100} ms`,On.textContent=`${Math.round(i.get("clear")*100)/100} ms`,Cn.textContent=`${Math.round(i.get("grid")*100)/100} ms`,Tn.textContent=`${Math.round(i.get("food")*100)/100} ms`,An.textContent=`${Math.round(i.get("ants")*100)/100} ms`,Mn.textContent=`${Math.round(i.get("panels")*100)/100} ms`,Sn.textContent=`${Math.round(i.get("all")*100)/100} ms`,i.get("ms")>16.7?fe.classList.add("text-red-500"):fe.classList.remove("text-red-500")}function Un(){ct.addEventListener("mousedown",i=>{if(clearTimeout(me),i.buttons==le&&L)Me=!0;else if(i.buttons==le)return;if(i.buttons==vs)At=!0,jt=!1,ge(),J.x=i.clientX/d-p.x,J.y=(i.clientY-R)/d-p.y;else{if(L){Ae=!0;return}At=!1,me=setTimeout(()=>{At=!0,jt=!0,ge(),J.x=i.clientX/d-p.x,J.y=(i.clientY-R)/d-p.y},100)}}),ct.addEventListener("mousemove",i=>{!At||i.buttons==le||Gn(i)}),ct.addEventListener("mouseup",()=>{clearTimeout(me),Ae=!1,Me=!1,At&&(At=!1,ge())})}function Yn(i){const t={x:0,y:0};t.x=i.clientX/d-p.x,t.y=(i.clientY-R)/d-p.y,d*=.999**i.deltaY,d=Math.min(Math.max(.15,d),16),p.x=i.clientX/d-t.x,p.y=(i.clientY-R)/d-t.y,f.x=(i.clientX-window.innerWidth/2)/d-t.x,f.y=(i.clientY-R-window.innerHeight/2)/d-t.y,f.x=f.x<0?Math.abs(f.x):f.x*-1,f.y=f.y<0?Math.abs(f.y):f.y*-1,gt()}function Gn(i){p.x=i.clientX/d-J.x,p.y=(i.clientY-R)/d-J.y;const t={x:window.innerWidth/2-z/2,y:window.innerHeight/2-Z/2};(i.clientX-t.x)/d-J.x,(i.clientY-R-t.y)/d-J.y,i.clientX/d-p.x,(i.clientY-R)/d-p.y,f.x=(i.clientX-window.innerWidth/2)/d-J.x,f.y=(i.clientY-R-window.innerHeight/2)/d-J.y,f.x=f.x<0?Math.abs(f.x):f.x*-1,f.y=f.y<0?Math.abs(f.y):f.y*-1,gt()}function Ut(i,t,e=!1){e&&(p.x=Math.round(p.x/g.SIZE)*g.SIZE,p.y=Math.round(p.y/g.SIZE)*g.SIZE,f.x=Math.round(f.x/g.SIZE)*g.SIZE,f.y=Math.round(f.y/g.SIZE)*g.SIZE),p.x+=i,p.y+=t,f.x-=i,f.y-=t,gt()}function ee(i){const t={x:0,y:0};t.x=window.innerWidth/2/d-p.x,t.y=(window.innerHeight-R)/2/d-p.y,d*=.999**(i?-100:100),d=Math.min(Math.max(.15,d),16),p.x=window.innerWidth/2/d-t.x,p.y=(window.innerHeight-R)/2/d-t.y,f.x=(window.innerWidth/2-window.innerWidth/2)/d-t.x,f.y=((window.innerHeight-R)/2-window.innerHeight/2)/d-t.y,f.x=f.x<0?Math.abs(f.x):f.x*-1,f.y=f.y<0?Math.abs(f.y):f.y*-1,gt()}function be(){const i={x:window.innerWidth/2-z/2,y:(window.innerHeight-R)/2-Z/2};d=1,p.x=i.x,p.y=i.y,f.x=z/2,f.y=Z/2,gt()}function Kn(i,t){const e={x:window.innerWidth/2/d-i,y:window.innerHeight/2/d-t};p.x=e.x,p.y=e.y,f.x=window.innerWidth/2/d-e.x,f.y=window.innerHeight/2/d-e.y,gt()}function gt(){Ys.style.transform=`scale(${d}) translate(${p.x}px, ${p.y}px)`,xe=!0}function Fs(i){if(N==null||qt==null||Mt==null||we==null||k==null||W==null||Dt==null)return;window.requestAnimationFrame(Fs),w.startMeasurement("all");const t=(i-ue)/1e3;$t+=t;const e=(xe||q)&&$t>qe/d||$t>qe*10/d;w.isMeasuring&&(w.setPerformance("fps",1/t),w.setPerformance("ms",i-ue)),w.startMeasurement("clear"),e&&Mt.clearRect(0,0,z,Z),N.clearRect(0,0,y.width,y.height),w.endMeasurement("clear"),w.startMeasurement("grid"),St&&Qt?y.drawMarkers(N,Qt,q):U&&Vt?y.drawDensity(N,Vt,q):Y&&Vt?y.drawDensity(N,Vt,q,!0):q&&y.update(),w.endMeasurement("grid"),w.startMeasurement("food"),y.drawFood(qt),w.endMeasurement("food");const s=H(oe/d-p.x,ae/d-p.y);if(L){Dt.clearRect(0,0,y.width,y.height),Dt.fillStyle="grey";const n=y.getCellCoords(s.x,s.y);D(Dt,n[0],n[1],X),Me?(W.fillStyle="black",D(W,n[0],n[1],X)):Ae&&(G?W.fillStyle="rgb(163, 163, 163)":st&&(W.fillStyle="rgb(66, 153, 66, 0.25)"),D(W,n[0],n[1],X))}m.updateColony(t),w.startMeasurement("ants"),e?m.updateAndDrawAnts(y,t):m.updateAndDrawAnts(y,t,!1),w.endMeasurement("ants"),w.startMeasurement("panels"),qn(),xt&&m.selectedAnt&&Kn(m.selectedAnt.pos.x,m.selectedAnt.pos.y),ut&&e&&(Mt.fillStyle="red",D(Mt,s.x,s.y,4),Wn(s.x,s.y)),$n(),w.endMeasurement("panels"),w.isMeasuring&&(w.endMeasurement("all"),Vn()),e&&(xe=!1,$t=0),ue=i}
