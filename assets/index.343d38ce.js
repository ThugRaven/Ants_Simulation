var Qt=Object.defineProperty;var te=(i,t,e)=>t in i?Qt(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var o=(i,t,e)=>(te(i,typeof t!="symbol"?t+"":t,e),e);const ee=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const a of l.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function e(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerpolicy&&(l.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?l.credentials="include":n.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(n){if(n.ep)return;n.ep=!0;const l=e(n);fetch(n.href,l)}};ee();const Lt={WIDTH:1600*3,HEIGHT:1200*3};var W=(i=>(i[i.TO_HOME=0]="TO_HOME",i[i.TO_FOOD=1]="TO_FOOD",i))(W||{});const ot={TO_HOME:[255,0,0],TO_FOOD:[43,255,0]},h={WIDTH:16,HEIGHT:16,SIZE:16},kt=2e-4,N={COLONY_RADIUS:50,COLONY_STARTING_ANTS:25,COLONY_MAX_ANTS:250,COLONY_MAX_FOOD:1250,ANT_CREATION_PERIOD:.15,ANT_COST:30};var c=(i=>(i[i.TO_HOME=0]="TO_HOME",i[i.TO_FOOD=1]="TO_FOOD",i[i.REFILL=2]="REFILL",i))(c||{});const r={IMG_WIDTH:24,IMG_HEIGHT:34,WANDER_DISPLACE_RANGE:.5,WANDER_POINT_MAGNITUDE:100,WANDER_POINT_RADIUS:50,PERCEPTION_RADIUS:150,PERCEPTION_START_ANGLE:7/6*Math.PI,PERCEPTION_END_ANGLE:11/6*Math.PI,PERCEPTION_POINTS_HORIZONTAL:12,PERCEPTION_POINTS_VERTICAL:5,MARKER_PERIOD:.15,MARKER_DEFAULT_INTENSITY:1,AUTONOMY_MAX:300,AUTONOMY_REFILL:100},g={SIZE:15,PICK_AMOUNT:2},Et=2,ie=4;function I(i,t,e,s,n=!0,l=!1){i.beginPath(),i.arc(t,e,s,0,Math.PI*2),n&&i.fill(),l&&i.stroke()}function $(i,t,e,s,n){i.beginPath(),i.moveTo(t,e),i.lineTo(s,n),i.stroke(),i.closePath()}function rt(i,t){return Math.random()*(t-i)+i}function p(i,t,e){return i=!i,i?(t.style.display="block",e==null||e.classList.add("border-green-500"),e==null||e.classList.remove("border-red-500")):(t.style.display="none",e==null||e.classList.add("border-red-500"),e==null||e.classList.remove("border-green-500")),i}function Q(i,t){return i=!i,i?(t.classList.add("border-green-500"),t.classList.remove("border-red-500")):(t.classList.add("border-red-500"),t.classList.remove("border-green-500")),i}class O{constructor(t,e,s){o(this,"x");o(this,"y");o(this,"z");this.x=t||0,this.y=e||0,this.z=s||0}set(t,e,s){return t instanceof O?(this.x=t.x||0,this.y=t.y||0,this.z=t.z||0,this):t instanceof Array?(this.x=t[0]||0,this.y=t[1]||0,this.z=t[2]||0,this):(this.x=t||0,this.y=e||0,this.z=s||0,this)}copy(){return new O(this.x,this.y,this.z)}add(t,e,s){return t instanceof O?(this.x+=t.x||0,this.y+=t.y||0,this.z+=t.z||0,this):t instanceof Array?(this.x+=t[0]||0,this.y+=t[1]||0,this.z+=t[2]||0,this):(this.x+=t||0,this.y+=e||0,this.z+=s||0,this)}sub(t,e,s){return t instanceof O?(this.x-=t.x||0,this.y-=t.y||0,this.z-=t.z||0,this):t instanceof Array?(this.x-=t[0]||0,this.y-=t[1]||0,this.z-=t[2]||0,this):(this.x-=t||0,this.y-=e||0,this.z-=s||0,this)}mult(t,e,s){if(t instanceof O)return Number.isFinite(t.x)&&Number.isFinite(t.y)&&Number.isFinite(t.z)&&typeof t.x=="number"&&typeof t.y=="number"&&typeof t.z=="number"?(this.x*=t.x,this.y*=t.y,this.z*=t.z):console.warn("Vector.mult:","x contains components that are either undefined or not finite numbers"),this;if(t instanceof Array)return t.every(l=>Number.isFinite(l))&&t.every(l=>typeof l=="number")?t.length===1?(this.x*=t[0],this.y*=t[0],this.z*=t[0]):t.length===2?(this.x*=t[0],this.y*=t[1]):t.length===3&&(this.x*=t[0],this.y*=t[1],this.z*=t[2]):console.warn("Vector.mult:","x contains elements that are either undefined or not finite numbers"),this;const n=[...arguments];return n.every(l=>Number.isFinite(l))&&n.every(l=>typeof l=="number")?(arguments.length===1&&(this.x*=t,this.y*=t,this.z*=t),arguments.length===2&&(this.x*=t,this.y*=e||0),arguments.length===3&&(this.x*=t,this.y*=e||0,this.z*=s||0)):console.warn("Vector.mult:","x, y, or z arguments are either undefined or not a finite number"),this}div(t,e,s){if(t instanceof O){if(Number.isFinite(t.x)&&Number.isFinite(t.y)&&Number.isFinite(t.z)&&typeof t.x=="number"&&typeof t.y=="number"&&typeof t.z=="number"){if(t.x===0||t.y===0||t.z===0)return console.warn("Vector.div:","divide by 0"),this;this.x/=t.x,this.y/=t.y,this.z/=t.z}else console.warn("Vector.div:","x contains components that are either undefined or not finite numbers");return this}if(t instanceof Array){if(t.every(l=>Number.isFinite(l))&&t.every(l=>typeof l=="number")){if(t.some(l=>l===0))return console.warn("Vector.div:","divide by 0"),this;t.length===1?(this.x/=t[0],this.y/=t[0],this.z/=t[0]):t.length===2?(this.x/=t[0],this.y/=t[1]):t.length===3&&(this.x/=t[0],this.y/=t[1],this.z/=t[2])}else console.warn("Vector.div:","x contains components that are either undefined or not finite numbers");return this}const n=[...arguments];if(n.every(l=>Number.isFinite(l))&&n.every(l=>typeof l=="number")){if(n.some(l=>l===0))return console.warn("Vector.div:","divide by 0"),this;arguments.length===1&&(this.x/=t,this.y/=t,this.z/=t),arguments.length===2&&(this.x/=t,this.y/=e||0),arguments.length===3&&(this.x/=t,this.y/=e||0,this.z/=s||0)}else console.warn("Vector.div:","x, y, or z arguments are either undefined or not a finite number");return this}mag(){return Math.sqrt(this.magSq())}magSq(){const t=this.x,e=this.y,s=this.z;return t*t+e*e+s*s}dist(t){return t.copy().sub(this).mag()}normalize(){const t=this.mag();return t!==0&&this.mult(1/t),this}limit(t){const e=this.magSq();return e>t*t&&this.div(Math.sqrt(e)).mult(t),this}setMag(t){return this.normalize().mult(t)}heading(){return Math.atan2(this.y,this.x)}setHeading(t){let e=this.mag();return this.x=e*Math.cos(t),this.y=e*Math.sin(t),this}rotate(t){let e=this.heading()+t;const s=this.mag();return this.x=Math.cos(e)*s,this.y=Math.sin(e)*s,this}equals(t,e,s){let n,l,a;return t instanceof O?(n=t.x||0,l=t.y||0,a=t.z||0):t instanceof Array?(n=t[0]||0,l=t[1]||0,a=t[2]||0):(n=t||0,l=e||0,a=s||0),this.x===n&&this.y===l&&this.z===a}}function x(i,t,e){return new O(i,t,e)}class Ft{constructor(t,e,s){o(this,"ctx");o(this,"antIcon");o(this,"id");o(this,"pos");o(this,"vel");o(this,"acc");o(this,"maxSpeed");o(this,"maxForce");o(this,"state");o(this,"debug");o(this,"wanderTheta");o(this,"perceptionDraw");o(this,"internalClock");o(this,"markerClock");o(this,"isDead");o(this,"freedomCoef");o(this,"foodAmount");this.ctx=t,this.antIcon=e,this.id=s.id,this.pos=x(s.pos.x,s.pos.y),this.vel=x(0,0),this.acc=x(0,0),this.maxSpeed=4,this.maxForce=.25,this.state=c.TO_FOOD,this.debug=s.debug||!1,this.wanderTheta=rt(0,Math.PI*2),this.perceptionDraw=new Set,this.internalClock=0,this.markerClock=rt(0,r.MARKER_PERIOD),this.isDead=!1,this.freedomCoef=rt(.01,.1),this.foodAmount=0}seek(t){this.debug&&(this.ctx.strokeStyle="white",$(this.ctx,t.x,t.y,this.pos.x,this.pos.y));let e=t.copy().sub(this.pos);e.setMag(this.maxSpeed),e.sub(this.vel),e.limit(this.maxForce),this.applyForce(e)}wander(){let t=this.vel.copy();t.setMag(r.WANDER_POINT_MAGNITUDE),t.add(this.pos);let e=r.WANDER_POINT_RADIUS;this.debug&&(this.ctx.fillStyle="red",I(this.ctx,t.x,t.y,4),this.ctx.strokeStyle="white",I(this.ctx,t.x,t.y,e,!1,!0),$(this.ctx,this.pos.x,this.pos.y,t.x,t.y));let s=this.wanderTheta+this.vel.heading(),n=e*Math.cos(s),l=e*Math.sin(s);t.add(n,l),this.ctx.fillStyle="green",this.debug&&(I(this.ctx,t.x,t.y,8),$(this.ctx,this.pos.x,this.pos.y,t.x,t.y));let a=t.sub(this.pos);a.setMag(this.maxForce),a.limit(this.maxForce),this.applyForce(a);let E=r.WANDER_DISPLACE_RANGE;this.wanderTheta+=rt(-E,E)}applyForce(t){this.acc.add(t)}update(t){this.internalClock+=t,this.internalClock>=r.AUTONOMY_REFILL&&this.state===c.TO_FOOD&&(this.state=c.REFILL),this.internalClock>=r.AUTONOMY_MAX&&(this.isDead=!0),this.vel.add(this.acc),this.vel.limit(this.maxSpeed),this.pos.add(this.vel),this.acc.set(0,0)}draw(){this.ctx.save(),this.ctx.translate(this.pos.x,this.pos.y),this.ctx.rotate(this.vel.heading()+Math.PI/2);let t=-r.IMG_WIDTH/2,e=-r.IMG_HEIGHT/2;if(this.state===c.TO_HOME&&(this.ctx.fillStyle="green",I(this.ctx,0,e,10)),this.ctx.drawImage(this.antIcon,t,e,r.IMG_WIDTH,r.IMG_HEIGHT),this.debug){this.ctx.strokeStyle="#FF0000",this.ctx.lineWidth=2,this.ctx.strokeRect(t,e,r.IMG_WIDTH,r.IMG_HEIGHT),this.ctx.fillStyle="red",I(this.ctx,0,0,4),this.ctx.beginPath(),this.ctx.arc(0,0,r.PERCEPTION_RADIUS,r.PERCEPTION_START_ANGLE,r.PERCEPTION_END_ANGLE),this.ctx.stroke(),this.ctx.strokeStyle="white",this.ctx.beginPath(),this.ctx.arc(0,0,r.PERCEPTION_RADIUS,r.PERCEPTION_END_ANGLE,r.PERCEPTION_START_ANGLE),this.ctx.stroke();let s=r.PERCEPTION_START_ANGLE,n=r.PERCEPTION_END_ANGLE,l=r.PERCEPTION_RADIUS*Math.cos(s),a=r.PERCEPTION_RADIUS*Math.sin(s),E=r.PERCEPTION_RADIUS*Math.cos(n),m=r.PERCEPTION_RADIUS*Math.sin(n);this.ctx.strokeStyle="red",$(this.ctx,0,0,l,a),$(this.ctx,0,0,E,m);let _=(r.PERCEPTION_END_ANGLE-r.PERCEPTION_START_ANGLE)/(r.PERCEPTION_POINTS_HORIZONTAL-1),M=r.PERCEPTION_RADIUS/r.PERCEPTION_POINTS_VERTICAL;for(let S=1;S<=r.PERCEPTION_POINTS_VERTICAL;S++)for(let D=0;D<r.PERCEPTION_POINTS_HORIZONTAL;D++){let it=_*D+r.PERCEPTION_START_ANGLE,st=M*S*Math.cos(it),A=M*S*Math.sin(it);this.perceptionDraw.has(S*r.PERCEPTION_POINTS_VERTICAL+D)?(this.ctx.strokeStyle="white",this.ctx.fillStyle="white"):(this.ctx.strokeStyle="red",this.ctx.fillStyle="green"),I(this.ctx,st,A,4),S===r.PERCEPTION_POINTS_VERTICAL&&$(this.ctx,0,0,st,A)}}this.ctx.restore(),this.debug&&(this.ctx.fillStyle="white",I(this.ctx,this.pos.x,this.pos.y,3))}search(t,e){this.debug&&(this.perceptionDraw=new Set);let s=t.getCellFromCoordsSafe(this.pos.x,this.pos.y);if(s&&s.food.quantity>0&&(this.state===c.TO_FOOD||this.state===c.REFILL)){this.state=c.TO_HOME,this.foodAmount=s.pick(),this.vel.setHeading(this.vel.heading()+Math.PI),this.internalClock=0;return}if(Math.random()<this.freedomCoef)return;let n=(r.PERCEPTION_END_ANGLE-r.PERCEPTION_START_ANGLE)/(r.PERCEPTION_POINTS_HORIZONTAL-1),l=r.PERCEPTION_RADIUS/r.PERCEPTION_POINTS_VERTICAL,a=0,E=null,m=this.vel.heading(),_=x(e.x,e.y);for(let M=1;M<=r.PERCEPTION_POINTS_VERTICAL;M++)for(let S=0;S<r.PERCEPTION_POINTS_HORIZONTAL;S++){let D=n*S+r.PERCEPTION_START_ANGLE+m+Math.PI/2,it=l*M*Math.cos(D),st=l*M*Math.sin(D),A=this.pos.copy().add(it,st),X=t.getCellFromCoordsSafe(A.x,A.y);if(X){if(A.dist(_)<=N.COLONY_RADIUS&&(this.state===c.REFILL||this.state===c.TO_HOME)){this.seek(A);return}if(X.food.quantity>0&&(this.state===c.TO_FOOD||this.state===c.REFILL)){this.debug&&this.perceptionDraw.add(M*r.PERCEPTION_POINTS_VERTICAL+S),this.seek(A);return}let nt=0;if(this.state===c.TO_HOME||this.state===c.REFILL?nt=X.marker.intensity[0]:(this.state===c.TO_FOOD||this.state===c.REFILL)&&(nt=X.marker.intensity[1]),nt>a&&(a=nt,E=A),X.wall===1&&A.dist(this.pos)<=l+10){let lt=A.sub(this.pos);lt.setMag(this.maxSpeed),lt.sub(this.vel),lt.mult(-1),this.applyForce(lt)}}}if(E){this.seek(E);return}this.wander()}checkColony(t){let e=x(t.x,t.y);this.pos.dist(e)<=N.COLONY_RADIUS&&(this.state===c.REFILL||this.state===c.TO_HOME)&&(this.state===c.TO_HOME&&(this.vel.setHeading(this.vel.heading()+Math.PI),t.addFood(this.foodAmount)),this.state=c.TO_FOOD,this.internalClock=0)}addMarker(t,e){if(this.markerClock+=e,this.markerClock>=r.MARKER_PERIOD){let[s,n]=t.getCellCoords(this.pos.x,this.pos.y);if(!t.checkCoords(s,n))return;let l=r.MARKER_DEFAULT_INTENSITY*Math.exp(-.15*this.internalClock),a=-1;switch(this.state){case c.TO_HOME:a=W.TO_FOOD;break;case c.TO_FOOD:a=W.TO_HOME;break;case c.REFILL:a=W.TO_HOME;break}t.addMarker(s,n,a,l),this.markerClock=0}}}class se{constructor(t){o(this,"id");o(this,"x");o(this,"y");o(this,"startingAntsCount");o(this,"maxAntsCount");o(this,"ants");o(this,"totalAnts");o(this,"colonyColor");o(this,"antIcon");o(this,"antId");o(this,"isRunning");o(this,"isDrawingAnts");o(this,"isDebugMode");o(this,"colonyClock");o(this,"antCtx");o(this,"selectedAnt");o(this,"food");o(this,"totalFood");o(this,"maxFood");this.id=t.id,this.x=t.pos.x,this.y=t.pos.y,this.startingAntsCount=N.COLONY_STARTING_ANTS,this.maxAntsCount=N.COLONY_MAX_ANTS,this.ants=[],this.totalAnts=0,this.colonyColor=t.colonyColor||[255,255,255],this.antIcon=null,this.antId=0,this.isRunning=!1,this.isDrawingAnts=!0,this.isDebugMode=!1,this.colonyClock=0,this.antCtx=null,this.selectedAnt=null,this.food=0,this.totalFood=0,this.maxFood=N.COLONY_MAX_FOOD}initialize(t,e){this.antIcon=t,this.antCtx=e;for(let s=0;s<this.startingAntsCount;s++){let n=new Ft(this.antCtx,t,{id:this.antId+1,pos:{x:this.x,y:this.y}});this.ants.push(n),this.antId++,this.totalAnts++}}updateAndDrawAnts(t,e){let s=!1;for(let n=0;n<this.ants.length;n++)this.isRunning&&(this.ants[n].search(t,this),this.ants[n].update(e),this.ants[n].addMarker(t,e),this.ants[n].checkColony(this),this.ants[n].isDead&&(s=!0)),this.isDrawingAnts&&this.ants[n].draw(),s&&(console.log("Removed ant: ",this.ants[n]),this.ants.splice(n,1),s=!1)}updateColony(t){!this.isRunning||(this.colonyClock+=t,this.colonyClock>=N.ANT_CREATION_PERIOD&&this.ants.length<this.maxAntsCount&&this.useFood(N.ANT_COST)&&(this.createAnt(),this.colonyClock=0))}createAnt(){if(this.ants.length<this.maxAntsCount&&this.antIcon&&this.antCtx){let t=new Ft(this.antCtx,this.antIcon,{id:this.antId+1,pos:{x:this.x,y:this.y}});this.ants.push(t),this.antId++,this.totalAnts++,this.isDebugMode&&console.log("Created ant: ",t)}else this.isDebugMode&&console.log("Can't create new ant - max count reached")}selectAnt(t){if(this.ants.length<=0)return null;let e=null,s=1/0,n=r.IMG_HEIGHT/2;for(const l of this.ants){let a=l.pos.dist(t);a<s&&a<n&&(s=a,e=l)}return this.selectedAnt=e,e}removeAnt(){if(this.selectedAnt==null||this.ants.length<=0)return!1;let t=this.ants.findIndex(e=>e.id===this.selectedAnt.id);return t!=-1?(this.ants.splice(t,1),this.selectedAnt=null,!0):!1}toggleAntDebug(){if(this.ants.length>0)for(const t of this.ants)this.selectedAnt&&t.id===this.selectedAnt.id?t.debug=this.isDebugMode:t.debug=!1}drawColony(t){t.fillStyle=`rgb(${this.colonyColor[0]}, ${this.colonyColor[1]}, ${this.colonyColor[2]})`,I(t,this.x,this.y,N.COLONY_RADIUS)}addFood(t){this.food=Math.min(this.food+t,this.maxFood),this.totalFood++}useFood(t){return this.food>=t?(this.food-=t,!0):!1}}class Z{constructor(t,e){o(this,"canvas");o(this,"width");o(this,"height");o(this,"cellSize");this.canvas=t,this.width=e.width,this.height=e.height,this.cellSize=e.cellSize}create(){return this.canvas.width=this.width,this.canvas.height=this.height,console.log(`Created canvas with size: ${this.width} x ${this.height}`),this.canvas.getContext("2d")}}function ne(i){let t=Math.round(i.width/i.cellSize),e=Math.round(i.height/i.cellSize),s=t*i.cellSize,n=e*i.cellSize;return console.log(`Calculate sizes:
${i.width==s?s:`${i.width} -> ${s}`} x ${i.height==n?n:`${i.height} -> ${n}`}`),[s,n]}class le{constructor(t){o(this,"quantity");this.quantity=t}draw(t,e,s){let n=e*g.SIZE+g.SIZE/2,l=s*g.SIZE+g.SIZE/2;t.fillStyle=`hsl(120, 40%, 43%, ${this.quantity/100})`,I(t,n,l,g.SIZE/2,!0)}pick(){let t=Math.max(this.quantity-g.PICK_AMOUNT,0);return this.quantity=Math.max(this.quantity-g.PICK_AMOUNT,0),t<g.PICK_AMOUNT?t:g.PICK_AMOUNT}}class oe{constructor(t){o(this,"intensity");this.intensity=t}draw(t,e,s){let n=new O().set(ot.TO_HOME.slice()),l=new O().set(ot.TO_FOOD.slice()),a=n.mult(this.intensity[0]),E=l.mult(this.intensity[1]),m=a.add(E);m=new O().set(Math.round(Math.min(m.x,255)),Math.round(Math.min(m.y,255)),Math.round(Math.min(m.z,255))),t.fillStyle=`rgb(${m.x}, ${m.y}, ${m.z})`,t.fillRect(e,s,1,1)}getMixedColor(){let[t,e,s]=ot.TO_HOME,[n,l,a]=ot.TO_FOOD,E=[this.intensity[0]*t,this.intensity[0]*e,this.intensity[0]*s],m=[this.intensity[1]*n,this.intensity[1]*l,this.intensity[1]*a],_=[E[0]+m[0],E[1]+m[1],E[2]+m[2]];return _=[Math.round(Math.min(_[0],255)),Math.round(Math.min(_[1],255)),Math.round(Math.min(_[2],255))],_}update(){this.intensity[0]>0?this.intensity[0]-=kt:this.intensity[0]=0,this.intensity[1]>0?this.intensity[1]-=kt:this.intensity[1]=0}}class re{constructor(){o(this,"marker");o(this,"food");o(this,"wall");this.marker=new oe([0,0]),this.food=new le(0),this.wall=0}update(){this.marker.update()}pick(){return this.food.pick()}drawWall(t,e,s){t.fillRect(e,s,1,1)}}class ae{constructor(t){o(this,"width");o(this,"height");o(this,"cellSize");o(this,"cells");this.width=t.width,this.height=t.height,this.cellSize=t.cellSize,this.cells=[];for(let e=0;e<this.width*this.height;e++)this.cells.push(new re)}initializeBorderWalls(){for(let t=0;t<this.width;t++){let e=this.cells[this.getIndexFromCoords(t,0)],s=this.cells[this.getIndexFromCoords(t,this.height-1)];e.wall=1,s.wall=1}for(let t=1;t<this.height-1;t++){let e=this.cells[this.getIndexFromCoords(0,t)],s=this.cells[this.getIndexFromCoords(this.width-1,t)];e.wall=1,s.wall=1}}update(){for(const t of this.cells)t.marker.update()}addMarker(t,e,s,n){let l=this.cells[this.getIndexFromCoords(t,e)];s===W.TO_HOME?(l.marker.intensity[0]>0&&(n/=2),l.marker.intensity[0]=Math.min(1,l.marker.intensity[0]+n)):s===W.TO_FOOD&&(l.marker.intensity[1]>0&&(n/=2),l.marker.intensity[1]=Math.min(1,l.marker.intensity[1]+n))}addFood(t,e,s){let n=this.getIndexFromCoords(t,e);if(n>this.cells.length||n<0)return;let l=this.cells[n];l.food.quantity=Math.min(l.food.quantity+s,100)}drawMarkers(t,e,s=!0){for(let n=0;n<e.data.length;n+=4){let l=this.cells[n/4],a=l.marker.getMixedColor();e.data[n+0]=a[0],e.data[n+1]=a[1],e.data[n+2]=a[2],e.data[n+3]=255,s&&l.marker.update()}t.putImageData(e,0,0)}drawFood(t){for(let e=0;e<this.width;e++)for(let s=0;s<this.height;s++){let n=this.cells[this.getIndexFromCoords(e,s)];n.food.quantity>0&&n.food.draw(t,e,s)}}drawWalls(t){t.fillStyle="rgb(163, 163, 163)";for(let e=0;e<this.width;e++)for(let s=0;s<this.height;s++){let n=this.cells[this.getIndexFromCoords(e,s)];n.wall===1&&n.drawWall(t,e,s)}}isOnFood(t,e){return this.cells[this.getIndexFromCoords(t,e)].food.quantity>0}getIndexFromCoords(t,e){return t+e*this.width}getCellCoords(t,e){let s=Math.floor(t/h.SIZE),n=Math.floor(e/h.SIZE);return[s,n]}getCellFromCoords(t,e,s=!1){return s||([t,e]=this.getCellCoords(t,e)),this.cells[this.getIndexFromCoords(t,e)]}getCellFromCoordsSafe(t,e){let[s,n]=this.getCellCoords(t,e);return this.checkCoords(s,n)?this.getCellFromCoords(s,n,!0):null}checkCoords(t,e){return t>-1&&t<this.width&&e>-1&&e<this.height}}const L=document.getElementById("canvas-container"),he=document.getElementById("camera-container"),ce=document.getElementById("btn-fullscreen"),de=document.getElementById("btn-pan"),ue=document.getElementById("canvas"),Ht=document.getElementById("canvas-markers"),Bt=document.getElementById("canvas-food"),fe=document.getElementById("canvas-colony"),Zt=document.getElementById("canvas-walls"),tt=document.getElementById("canvas-edit"),et=document.getElementById("canvas-edit-preview"),vt=document.getElementById("antIcon"),ht=document.getElementById("btn-ant-panel"),Nt=document.getElementById("antPanel"),ye=document.querySelector("[data-id]"),me=document.querySelector("[data-pos]"),ge=document.querySelector("[data-vel]"),Ee=document.querySelector("[data-state]"),Ct=document.getElementById("btn-track"),Ie=document.getElementById("btn-remove"),Tt=document.getElementById("btn-cell-panel"),$t=document.getElementById("cellPanel"),Oe=document.querySelector("[data-cell-preview]"),Ce=document.querySelector("[data-intensity-home]"),Te=document.querySelector("[data-intensity-food]"),Se=document.querySelector("[data-cell-food]"),St=document.getElementById("btn-colony-panel"),Gt=document.getElementById("colonyPanel"),Ae=document.querySelector("[data-colony-preview]"),pe=document.querySelector("[data-colony-pop]"),Pe=document.querySelector("[data-colony-food]"),_e=document.querySelector("[data-pause]"),qt=document.getElementById("btn-play"),Wt=document.getElementById("btn-pause"),At=document.getElementById("btn-edit-mode"),Ut=document.getElementById("editPanel"),Dt=document.querySelector("[data-brush-preview]"),we=document.querySelector("[data-brush-size]"),pt=document.getElementById("brushSizeInput"),ct=document.getElementById("btn-wall-brush"),Pt=document.getElementById("btn-food-brush"),be=document.getElementById("btn-save"),Me=document.getElementById("btn-controls"),Ne=document.getElementById("btn-close-controls"),Yt=document.getElementById("controlsPanel");let R=!1,_t=!0,z=!1,at=!1,k=!1,wt=!1,bt=!1,b=!1,H=!1,dt=!1,V=!1,P=!1,j=!1,zt=0,Y=L.getBoundingClientRect().top,yt=0,mt=0,u=1,G=!1,ut=!1,It=0,q={x:0,y:0},y={x:0,y:0},F=5,[C,T]=ne({width:Lt.WIDTH,height:Lt.HEIGHT,cellSize:h.SIZE}),Re=new Z(Ht,{width:C/h.SIZE,height:T/h.SIZE,cellSize:1});Ht.style.transform=`scale(${h.SIZE})`;let v=Re.create(),xe=new Z(Bt,{width:C/(h.SIZE/g.SIZE),height:T/(h.SIZE/g.SIZE),cellSize:h.SIZE/g.SIZE});Bt.style.transform=`scale(${h.SIZE/g.SIZE})`;let J=xe.create(),Le=new Z(ue,{width:C,height:T,cellSize:h.SIZE}),B=Le.create(),ke=new Z(fe,{width:C,height:T,cellSize:h.SIZE}),Mt=ke.create(),Fe=new Z(Zt,{width:C/h.SIZE,height:T/h.SIZE,cellSize:1});Zt.style.transform=`scale(${h.SIZE})`;let U=Fe.create(),ve=new Z(tt,{width:C/h.SIZE,height:T/h.SIZE,cellSize:1});tt.style.transform=`scale(${h.SIZE})`;let w=ve.create(),De=new Z(et,{width:C/h.SIZE,height:T/h.SIZE,cellSize:1});et.style.transform=`scale(${h.SIZE})`;let K=De.create(),d=new ae({width:C/h.SIZE,height:T/h.SIZE,cellSize:1}),ft=v==null?void 0:v.createImageData(d.width,d.height),f=new se({id:1,pos:{x:C/2,y:T/2}});window.addEventListener("keydown",i=>{switch(i.code){case"Space":Rt();break;case"KeyM":He();break;case"KeyA":Ze();break;case"KeyD":Be();break;case"KeyT":Vt();break;case"KeyC":xt();break;case"Delete":jt();break}});L.addEventListener("mousemove",i=>{yt=i.pageX,mt=i.pageY-Y});L.addEventListener("click",()=>{if(ut){ut=!1;return}$e(),z&&Kt()});L.addEventListener("contextmenu",i=>{i.preventDefault();let t=x(Math.floor((yt/u-y.x)/h.SIZE),Math.floor((mt/u-y.y)/h.SIZE));z&&console.log(`Placed food at: ${t.x}:${t.y}`),d.addFood(t.x,t.y,10)});L.addEventListener("wheel",i=>{Ye(i)});ce.addEventListener("click",()=>{xt()});Ct.addEventListener("click",()=>{Vt()});Ie.addEventListener("click",()=>{jt()});qt.addEventListener("click",()=>{Rt()});Wt.addEventListener("click",()=>{Rt()});St.addEventListener("click",()=>{dt=p(dt,Gt,St)});dt=p(dt,Gt,St);Tt.addEventListener("click",()=>{V=p(V,$t,Tt)});ht.addEventListener("click",()=>{P=p(P,Nt,ht)});Me.addEventListener("click",()=>{j=p(j,Yt)});Ne.addEventListener("click",()=>{j=!0,j=p(j,Yt)});At.addEventListener("click",()=>{k=p(k,Ut,At),k?(tt.style.display="block",et.style.display="block"):(tt.style.display="none",et.style.display="none")});ct.addEventListener("click",()=>{b=Q(b,ct),b&&(H=!0,H=Q(b,Pt))});Pt.addEventListener("click",()=>{H=Q(H,Pt),H&&(b=!0,b=Q(H,ct))});be.addEventListener("click",()=>{if(w&&U){let i=w.getImageData(0,0,d.width,d.height);U.clearRect(0,0,d.width,d.height);for(let t=0;t<i.data.length;t+=4){let e=d.cells[t/4],s=i.data[t+0],n=i.data[t+1],l=i.data[t+2],a=i.data[t+3];n<=160&&n>0&&n>s&&n>l?e.food.quantity=Math.round(100*(a/255)):s>0&&n>0&&l>0&&s===n&&n===l?e.wall=1:(e.food.quantity=0,e.wall=0)}d.initializeBorderWalls(),d.drawWalls(U),k=p(k,Ut,At),tt.style.display="none",et.style.display="none"}});pt.addEventListener("input",()=>{F=parseInt(pt.value),Xt()});function Xt(){Dt.style.width=`${F}px`,Dt.style.height=`${F}px`,we.textContent=`${F} px`}pt.value=F.toString();Xt();b=Q(b,ct);ze();Ue();xt();window.requestAnimationFrame(Jt);function ze(){if(!(v==null||J==null||B==null||Mt==null||U==null||w==null||K==null)){if(ft&&(d.drawMarkers(v,ft),d.drawFood(J)),vt){let i=new XMLSerializer().serializeToString(vt),t=btoa(i),s="data:image/svg+xml;base64,"+t,n=new Image;n.src=s,n.onload=()=>{B.drawImage(n,100,50,24,34),f.initialize(n,B)}}f.drawColony(Mt),d.initializeBorderWalls(),d.drawWalls(U)}}function Rt(){R=!R,f.isRunning=R,_e.style.display=R?"none":"block",qt.style.display=R?"none":"flex",Wt.style.display=R?"flex":"none"}function He(){_t=!_t}function Be(){z=!z,f.isDebugMode=z,Kt(),z&&(V=!1),V=p(V,$t,Tt)}function Kt(){f.toggleAntDebug()}function Vt(){f.selectedAnt!=null&&(at=!at,at&&(u=3),Ct.classList.toggle("border-green-500"),Ct.classList.toggle("border-red-500"))}function Ot(){de.classList.toggle("bg-neutral-600")}function Ze(){f.isDrawingAnts=!f.isDrawingAnts}function $e(){let i=x(yt/u-y.x,mt/u-y.y);f.selectAnt(i),f.selectedAnt?P=!1:P=!0,P=p(P,Nt,ht)}function jt(){f.removeAnt()?P=!0:P=!1,P=p(P,Nt,ht)}function Ge(){let i=f.selectedAnt;if(!i)return;ye.textContent=i.id.toString(),me.textContent=`${i.pos.x.toFixed(2)} : ${i.pos.y.toFixed(2)}`,ge.textContent=`${i.vel.x.toFixed(2)} : ${i.vel.y.toFixed(2)}`;let t="";switch(i.state){case c.TO_HOME:t="To Home";break;case c.TO_FOOD:t="To Food";break;case c.REFILL:t="Refill";break}Ee.textContent=t}function qe(i,t){let e=d.getCellFromCoordsSafe(i,t);if(!e)return;Ce.textContent=e.marker.intensity[0].toFixed(2),Te.textContent=e.marker.intensity[1].toFixed(2),Se.textContent=e.food.quantity.toString();let s=e.marker.getMixedColor();Oe.style.backgroundColor=`rgb(${s[0]}, ${s[1]}, ${s[2]})`}function We(){if(!f)return;pe.textContent=`${f.ants.length} | ${f.totalAnts}`,Pe.textContent=`${f.food} | ${f.totalFood}`;let i=f.colonyColor;Ae.style.backgroundColor=`rgb(${i[0]}, ${i[1]}, ${i[2]})`}function Ue(){L.addEventListener("mousedown",i=>{if(clearTimeout(It),i.buttons==Et&&k)bt=!0;else if(i.buttons==Et)return;if(i.buttons==ie)G=!0,ut=!1,Ot(),document.body.classList.add("cursor-grabbing"),q.x=i.clientX/u-y.x,q.y=(i.clientY-Y)/u-y.y;else{if(k){wt=!0;return}G=!1,It=setTimeout(()=>{G=!0,ut=!0,Ot(),document.body.classList.add("cursor-grabbing"),q.x=i.clientX/u-y.x,q.y=(i.clientY-Y)/u-y.y},100)}}),L.addEventListener("mousemove",i=>{!G||i.buttons==Et||Xe(i)}),L.addEventListener("mouseup",()=>{clearTimeout(It),wt=!1,bt=!1,G&&(G=!1,Ot(),document.body.classList.remove("cursor-grabbing"))})}function Ye(i){let t={x:0,y:0};t.x=i.clientX/u-y.x,t.y=(i.clientY-Y)/u-y.y,u*=.999**i.deltaY,u=Math.min(Math.max(.15,u),16),y.x=i.clientX/u-t.x,y.y=(i.clientY-Y)/u-t.y,gt()}function Xe(i){y.x=i.clientX/u-q.x,y.y=(i.clientY-Y)/u-q.y,gt()}function gt(){he.style.transform=`scale(${u}) translate(${y.x}px, ${y.y}px)`}function xt(){let i={x:window.innerWidth/2-C/2,y:window.innerHeight/2-T/2};u=1,y.x=i.x,y.y=i.y,gt()}function Ke(i,t){let e={x:window.innerWidth/2/u-i,y:window.innerHeight/2/u-t};y.x=e.x,y.y=e.y,gt()}function Jt(i){if(v==null||J==null||B==null||Mt==null||U==null||w==null||K==null)return;window.requestAnimationFrame(Jt);const t=(i-zt)/1e3;B.clearRect(0,0,C,T),v.clearRect(0,0,d.width,d.height),J.clearRect(0,0,C/(h.SIZE/g.SIZE),T/(h.SIZE/g.SIZE)),_t&&ft?d.drawMarkers(v,ft,R):R&&d.update(),d.drawFood(J);let e=x(yt/u-y.x,mt/u-y.y);if(k){K.clearRect(0,0,d.width,d.height),K.fillStyle="grey";let s=d.getCellCoords(e.x,e.y);I(K,s[0],s[1],F),bt?(w.fillStyle="black",I(w,s[0],s[1],F)):wt&&(b?w.fillStyle="rgb(163, 163, 163)":H&&(w.fillStyle="rgb(66, 153, 66, 0.25)"),I(w,s[0],s[1],F))}f.updateColony(t),f.updateAndDrawAnts(d,t),Ge(),at&&f.selectedAnt&&Ke(f.selectedAnt.pos.x,f.selectedAnt.pos.y),z&&(B.fillStyle="red",I(B,e.x,e.y,4),qe(e.x,e.y)),We(),zt=i}
