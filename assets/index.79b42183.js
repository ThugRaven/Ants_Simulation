var fn=Object.defineProperty;var un=(s,t,e)=>t in s?fn(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var m=(s,t,e)=>(un(s,typeof t!="symbol"?t+"":t,e),e);const yn=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function e(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerpolicy&&(o.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?o.credentials="include":r.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=e(r);fetch(r.href,o)}};yn();const Ee={WIDTH:1600*3,HEIGHT:1200*3},fe={FILL_RATIO:.47,BORDER_SIZE:1};var Tt=(s=>(s[s.TO_HOME=0]="TO_HOME",s[s.TO_FOOD=1]="TO_FOOD",s))(Tt||{});const xe={TO_HOME:[255,0,0],TO_FOOD:[43,255,0]},C={WIDTH:16,HEIGHT:16,SIZE:16},we=2e-4,st={COLONY_RADIUS:50,COLONY_STARTING_ANTS:50,COLONY_MAX_ANTS:5e3,COLONY_MAX_FOOD:3e4,ANT_CREATION_PERIOD:.15,ANT_COST:30,ANT_REFILL_FOOD_AMOUNT:.25};var E=(s=>(s[s.TO_HOME=0]="TO_HOME",s[s.TO_FOOD=1]="TO_FOOD",s[s.REFILL=2]="REFILL",s))(E||{});const u={IMG_WIDTH:24,IMG_HEIGHT:34,WANDER_DISPLACE_RANGE:.5,WANDER_POINT_MAGNITUDE:100,WANDER_POINT_RADIUS:50,PERCEPTION_RADIUS:80,PERCEPTION_START_ANGLE:7/6*Math.PI,PERCEPTION_END_ANGLE:11/6*Math.PI,PERCEPTION_POINTS_HORIZONTAL:8,PERCEPTION_POINTS_VERTICAL:5,DIRECTION_PERIOD:.1,MARKER_PERIOD:.15,MARKER_DEFAULT_INTENSITY:1,AUTONOMY_MAX:300,AUTONOMY_REFILL:150,FOOD_SIZE:16},Yt=.005,D={SIZE:15,PICK_AMOUNT:2},Vt=2,mn=4,Nt=C.SIZE,mt={MIN_SIZE:1,MAX_SIZE:75,STEP:1};function W(s,t,e,n,r=!0,o=!1){s.beginPath(),s.arc(t,e,n,0,Math.PI*2),r&&s.fill(),o&&s.stroke()}function wt(s,t,e,n,r){s.beginPath(),s.moveTo(t,e),s.lineTo(n,r),s.stroke(),s.closePath()}function gn(s,t,e,n,r){s.rect(t,e,n,r),s.fill()}function At(s,t){return Math.random()*(t-s)+s}function pn(s,t,e){return e()*(t-s)+s}function v(s,t,e){return s=!s,s?(t.style.display="block",e==null||e.classList.add("border-green-500"),e==null||e.classList.remove("border-red-500")):(t.style.display="none",e==null||e.classList.add("border-red-500"),e==null||e.classList.remove("border-green-500")),s}function bt(s,t){return s=!s,s?(t.classList.add("border-green-500"),t.classList.remove("border-red-500")):(t.classList.add("border-red-500"),t.classList.remove("border-green-500")),s}class it{constructor(t,e,n){m(this,"x");m(this,"y");m(this,"z");this.x=t||0,this.y=e||0,this.z=n||0}set(t,e,n){return t instanceof it?(this.x=t.x||0,this.y=t.y||0,this.z=t.z||0,this):t instanceof Array?(this.x=t[0]||0,this.y=t[1]||0,this.z=t[2]||0,this):(this.x=t||0,this.y=e||0,this.z=n||0,this)}copy(){return new it(this.x,this.y,this.z)}add(t,e,n){return t instanceof it?(this.x+=t.x||0,this.y+=t.y||0,this.z+=t.z||0,this):t instanceof Array?(this.x+=t[0]||0,this.y+=t[1]||0,this.z+=t[2]||0,this):(this.x+=t||0,this.y+=e||0,this.z+=n||0,this)}sub(t,e,n){return t instanceof it?(this.x-=t.x||0,this.y-=t.y||0,this.z-=t.z||0,this):t instanceof Array?(this.x-=t[0]||0,this.y-=t[1]||0,this.z-=t[2]||0,this):(this.x-=t||0,this.y-=e||0,this.z-=n||0,this)}mult(t,e,n){if(t instanceof it)return Number.isFinite(t.x)&&Number.isFinite(t.y)&&Number.isFinite(t.z)&&typeof t.x=="number"&&typeof t.y=="number"&&typeof t.z=="number"?(this.x*=t.x,this.y*=t.y,this.z*=t.z):console.warn("Vector.mult:","x contains components that are either undefined or not finite numbers"),this;if(t instanceof Array)return t.every(o=>Number.isFinite(o))&&t.every(o=>typeof o=="number")?t.length===1?(this.x*=t[0],this.y*=t[0],this.z*=t[0]):t.length===2?(this.x*=t[0],this.y*=t[1]):t.length===3&&(this.x*=t[0],this.y*=t[1],this.z*=t[2]):console.warn("Vector.mult:","x contains elements that are either undefined or not finite numbers"),this;const r=[...arguments];return r.every(o=>Number.isFinite(o))&&r.every(o=>typeof o=="number")?(arguments.length===1&&(this.x*=t,this.y*=t,this.z*=t),arguments.length===2&&(this.x*=t,this.y*=e||0),arguments.length===3&&(this.x*=t,this.y*=e||0,this.z*=n||0)):console.warn("Vector.mult:","x, y, or z arguments are either undefined or not a finite number"),this}div(t,e,n){if(t instanceof it){if(Number.isFinite(t.x)&&Number.isFinite(t.y)&&Number.isFinite(t.z)&&typeof t.x=="number"&&typeof t.y=="number"&&typeof t.z=="number"){if(t.x===0||t.y===0||t.z===0)return console.warn("Vector.div:","divide by 0"),this;this.x/=t.x,this.y/=t.y,this.z/=t.z}else console.warn("Vector.div:","x contains components that are either undefined or not finite numbers");return this}if(t instanceof Array){if(t.every(o=>Number.isFinite(o))&&t.every(o=>typeof o=="number")){if(t.some(o=>o===0))return console.warn("Vector.div:","divide by 0"),this;t.length===1?(this.x/=t[0],this.y/=t[0],this.z/=t[0]):t.length===2?(this.x/=t[0],this.y/=t[1]):t.length===3&&(this.x/=t[0],this.y/=t[1],this.z/=t[2])}else console.warn("Vector.div:","x contains components that are either undefined or not finite numbers");return this}const r=[...arguments];if(r.every(o=>Number.isFinite(o))&&r.every(o=>typeof o=="number")){if(r.some(o=>o===0))return console.warn("Vector.div:","divide by 0"),this;arguments.length===1&&(this.x/=t,this.y/=t,this.z/=t),arguments.length===2&&(this.x/=t,this.y/=e||0),arguments.length===3&&(this.x/=t,this.y/=e||0,this.z/=n||0)}else console.warn("Vector.div:","x, y, or z arguments are either undefined or not a finite number");return this}mag(){return Math.sqrt(this.magSq())}magSq(){const t=this.x,e=this.y,n=this.z;return t*t+e*e+n*n}dist(t){return t.copy().sub(this).mag()}normalize(){const t=this.mag();return t!==0&&(this.x*=1/t,this.y*=1/t,this.z*=1/t),this}limit(t){const e=this.magSq();return e>t*t&&(this.x/=Math.sqrt(e),this.y/=Math.sqrt(e),this.z/=Math.sqrt(e),this.x*=t,this.y*=t,this.z*=t),this}setMag(t){const e=this.normalize();return e.x*=t,e.y*=t,e.z*=t,e}heading(){return Math.atan2(this.y,this.x)}setHeading(t){let e=this.mag();return this.x=e*Math.cos(t),this.y=e*Math.sin(t),this}rotate(t){let e=this.heading()+t;const n=this.mag();return this.x=Math.cos(e)*n,this.y=Math.sin(e)*n,this}equals(t,e,n){let r,o,d;return t instanceof it?(r=t.x||0,o=t.y||0,d=t.z||0):t instanceof Array?(r=t[0]||0,o=t[1]||0,d=t[2]||0):(r=t||0,o=e||0,d=n||0),this.x===r&&this.y===o&&this.z===d}}function gt(s,t,e){return new it(s,t,e)}class Oe{constructor(t,e,n,r,o){m(this,"ctx");m(this,"antImageInstance");m(this,"antFoodImageInstance");m(this,"antIcon");m(this,"id");m(this,"pos");m(this,"vel");m(this,"acc");m(this,"maxSpeed");m(this,"maxForce");m(this,"state");m(this,"debug");m(this,"wanderTheta");m(this,"perceptionDraw");m(this,"internalClock");m(this,"markerClock");m(this,"directionClock");m(this,"isDead");m(this,"freedomCoef");m(this,"foodAmount");m(this,"maxAutonomy");this.ctx=t,this.antImageInstance=e,this.antFoodImageInstance=n,this.antIcon=r,this.id=o.id,this.pos=gt(o.pos.x,o.pos.y),this.vel=gt(0,0),this.acc=gt(0,0),this.maxSpeed=3,this.maxForce=.25,this.state=E.TO_FOOD,this.debug=o.debug||!1,this.wanderTheta=At(0,Math.PI*2),this.perceptionDraw=new Set,this.internalClock=0,this.markerClock=At(0,u.MARKER_PERIOD),this.directionClock=0,this.isDead=!1,this.freedomCoef=At(.01,.1),this.foodAmount=0,this.maxAutonomy=u.AUTONOMY_MAX-At(0,50)}seek(t){this.debug&&(this.ctx.strokeStyle="white",wt(this.ctx,t.x,t.y,this.pos.x,this.pos.y));const e=t.copy().sub(this.pos);e.setMag(this.maxSpeed),e.sub(this.vel),e.limit(this.maxForce),this.applyForce(e)}wander(){const t=this.vel.copy();t.setMag(u.WANDER_POINT_MAGNITUDE),t.add(this.pos);const e=u.WANDER_POINT_RADIUS;this.debug&&(this.ctx.fillStyle="red",W(this.ctx,t.x,t.y,4),this.ctx.strokeStyle="white",W(this.ctx,t.x,t.y,e,!1,!0),wt(this.ctx,this.pos.x,this.pos.y,t.x,t.y));const n=this.wanderTheta+this.vel.heading(),r=e*Math.cos(n),o=e*Math.sin(n);t.add(r,o),this.debug&&(this.ctx.fillStyle="green",W(this.ctx,t.x,t.y,8),wt(this.ctx,this.pos.x,this.pos.y,t.x,t.y));const d=t.sub(this.pos);d.setMag(this.maxForce),d.limit(this.maxForce),this.applyForce(d);const a=u.WANDER_DISPLACE_RANGE;this.wanderTheta+=At(-a,a)}applyForce(t){this.acc.add(t)}update(t){this.internalClock+=t,this.directionClock+=t,this.internalClock>=u.AUTONOMY_REFILL&&this.state===E.TO_FOOD&&(this.state=E.REFILL),this.internalClock>=this.maxAutonomy&&(this.isDead=!0),this.vel.add(this.acc),this.vel.limit(this.maxSpeed),this.pos.add(this.vel),this.acc.set(0,0)}draw(){this.ctx.translate(this.pos.x,this.pos.y),this.ctx.rotate(this.vel.heading()+Math.PI/2);const t=-u.IMG_WIDTH/2,e=-u.IMG_HEIGHT/2;if(this.state===E.TO_HOME&&this.ctx.drawImage(this.antFoodImageInstance,-u.FOOD_SIZE/2,e-u.FOOD_SIZE/2),this.ctx.drawImage(this.antImageInstance,t,e),this.debug){this.ctx.strokeStyle="#FF0000",this.ctx.lineWidth=2,this.ctx.strokeRect(t,e,u.IMG_WIDTH,u.IMG_HEIGHT),this.ctx.fillStyle="red",W(this.ctx,0,0,4),this.ctx.beginPath(),this.ctx.arc(0,0,u.PERCEPTION_RADIUS,u.PERCEPTION_START_ANGLE,u.PERCEPTION_END_ANGLE),this.ctx.stroke(),this.ctx.strokeStyle="white",this.ctx.beginPath(),this.ctx.arc(0,0,u.PERCEPTION_RADIUS,u.PERCEPTION_END_ANGLE,u.PERCEPTION_START_ANGLE),this.ctx.stroke();const n=u.PERCEPTION_START_ANGLE,r=u.PERCEPTION_END_ANGLE,o=u.PERCEPTION_RADIUS*Math.cos(n),d=u.PERCEPTION_RADIUS*Math.sin(n),a=u.PERCEPTION_RADIUS*Math.cos(r),i=u.PERCEPTION_RADIUS*Math.sin(r);this.ctx.strokeStyle="red",wt(this.ctx,0,0,o,d),wt(this.ctx,0,0,a,i);const l=(u.PERCEPTION_END_ANGLE-u.PERCEPTION_START_ANGLE)/(u.PERCEPTION_POINTS_HORIZONTAL-1),f=u.PERCEPTION_RADIUS/u.PERCEPTION_POINTS_VERTICAL;for(let c=0;c<u.PERCEPTION_POINTS_HORIZONTAL;c++)for(let h=1;h<=u.PERCEPTION_POINTS_VERTICAL;h++){const y=l*c+u.PERCEPTION_START_ANGLE,p=f*h*Math.cos(y),P=f*h*Math.sin(y);this.perceptionDraw.has(h*u.PERCEPTION_POINTS_VERTICAL+c)?(this.ctx.strokeStyle="white",this.ctx.fillStyle="white"):(this.ctx.strokeStyle="red",this.ctx.fillStyle="green"),W(this.ctx,p,P,4),h===u.PERCEPTION_POINTS_VERTICAL&&wt(this.ctx,0,0,p,P)}}this.debug&&(this.ctx.fillStyle="white",W(this.ctx,this.pos.x,this.pos.y,3)),this.ctx.resetTransform()}search(t,e){this.debug&&(this.perceptionDraw=new Set);const n=this.vel.copy();n.setMag(u.IMG_HEIGHT/2),n.add(this.pos);const r=t.getCellFromCoordsSafe(n.x,n.y),o=t.getCellFromCoordsSafe(this.pos.x,this.pos.y);if(o==null||o.addDensity(this.state===E.TO_HOME,this.state===E.REFILL),r&&r.food.quantity>0&&(this.state===E.TO_FOOD||this.state===E.REFILL)){this.state=E.TO_HOME,this.foodAmount=r.pick(),this.vel.setHeading(this.vel.heading()+Math.PI),this.internalClock=0;return}if(o&&o.colony&&(this.state===E.REFILL||this.state===E.TO_HOME)){if(this.state===E.TO_HOME&&(this.vel.setHeading(this.vel.heading()+Math.PI),e.addFood(this.foodAmount)),this.state===E.REFILL&&!e.useFood(st.ANT_REFILL_FOOD_AMOUNT))return;this.state=E.TO_FOOD,this.internalClock=0;return}if(Math.random()<this.freedomCoef)return;const d=(u.PERCEPTION_END_ANGLE-u.PERCEPTION_START_ANGLE)/(u.PERCEPTION_POINTS_HORIZONTAL-1),a=u.PERCEPTION_RADIUS/u.PERCEPTION_POINTS_VERTICAL;let i=u.PERCEPTION_POINTS_VERTICAL+1,l=null,f=0,c=null;const h=this.vel.heading(),y=-u.IMG_WIDTH/2,p=Math.PI/4+h+Math.PI,P=-Math.PI/4+h+Math.PI,U=y*Math.cos(p),R=y*Math.sin(p),H=y*Math.cos(P),X=y*Math.sin(P),x=this.pos.copy().add(U,R),T=this.pos.copy().add(H,X),F=t.getCellFromCoordsSafe(x.x,x.y),_=t.getCellFromCoordsSafe(T.x,T.y);if(F&&F.wall===1||_&&_.wall===1){const A=(F?x:T).sub(this.pos);A.sub(this.vel),A.mult(-1),this.applyForce(A);return}if(this.directionClock>=u.DIRECTION_PERIOD){for(let M=0;M<u.PERCEPTION_POINTS_HORIZONTAL;M++)for(let A=1;A<=u.PERCEPTION_POINTS_VERTICAL;A++){const z=d*M+u.PERCEPTION_START_ANGLE+h+Math.PI/2,Z=a*A*Math.cos(z),V=a*A*Math.sin(z),N=this.pos.copy().add(Z,V),k=t.getCellFromCoordsSafe(N.x,N.y);if(k){if(k.wall===1&&(A===1||A===2)){const Y=N.sub(this.pos),Ie=M+1>u.PERCEPTION_POINTS_HORIZONTAL/2?u.PERCEPTION_POINTS_HORIZONTAL-M:M+1;Y.setMag(this.maxSpeed),Y.sub(this.vel),A===1?Y.limit(this.maxForce*Ie):A===2&&Y.limit(this.maxForce*.5*Ie),Y.mult(-1),this.applyForce(Y);break}if(k.colony&&(this.state===E.REFILL||this.state===E.TO_HOME)){this.seek(N);return}if(k.food.quantity>0&&(this.state===E.TO_FOOD||this.state===E.REFILL)){this.debug&&this.perceptionDraw.add(A*u.PERCEPTION_POINTS_VERTICAL+M),A<i&&(i=A,l=N);break}let nt=0;this.state===E.TO_HOME||this.state===E.REFILL?nt=k.marker.intensity[0]:(this.state===E.TO_FOOD||this.state===E.REFILL)&&(nt=k.marker.intensity[1]),nt>f&&(f=nt,c=N)}}if(l){this.seek(l);return}if(c){this.seek(c);return}this.directionClock=0}this.wander()}perception(t){const e=(u.PERCEPTION_END_ANGLE-u.PERCEPTION_START_ANGLE)/(u.PERCEPTION_POINTS_HORIZONTAL-1),n=u.PERCEPTION_RADIUS/u.PERCEPTION_POINTS_VERTICAL;let r=u.PERCEPTION_POINTS_VERTICAL+1,o=null,d=0,a=null;const i=this.vel.heading(),l=this.vel.copy().add(this.acc).limit(this.maxSpeed),f=this.pos.copy().add(l),c=t.getCellFromCoordsSafe(f.x,f.y);if((c==null?void 0:c.wall)===1){const h=f.sub(this.pos);this.debug&&console.log(h),h.x*=h.x!=0?-1:1,h.y*=h.y!=0?-1:1,h.sub(this.vel),this.applyForce(h);return}if(this.directionClock>=u.DIRECTION_PERIOD){for(let h=0;h<u.PERCEPTION_POINTS_HORIZONTAL;h++){const y=e*h+u.PERCEPTION_START_ANGLE+i+Math.PI/2;for(let p=1;p<=u.PERCEPTION_POINTS_VERTICAL;p++){const P=n*p*Math.cos(y),U=n*p*Math.sin(y),R=this.pos.copy().add(P,U),H=t.getCellFromCoordsSafe(R.x,R.y);if(H){if(H.wall===1&&(p===1||p===2)){const x=R.sub(this.pos),T=h+1>u.PERCEPTION_POINTS_HORIZONTAL/2?u.PERCEPTION_POINTS_HORIZONTAL-h:h+1;x.setMag(this.maxSpeed),x.sub(this.vel),p===1?x.limit(this.maxForce*T):p===2&&x.limit(this.maxForce*.5*T),x.mult(-1),this.applyForce(x);break}if(H.colony&&(this.state===E.REFILL||this.state===E.TO_HOME)){this.seek(R);return}if(H.food.quantity>0&&(this.state===E.TO_FOOD||this.state===E.REFILL)){this.debug&&this.perceptionDraw.add(p*u.PERCEPTION_POINTS_VERTICAL+h),p<r&&(r=p,o=R);break}let X=0;this.state===E.TO_HOME||this.state===E.REFILL?X=H.marker.getToHomeIntensity():(this.state===E.TO_FOOD||this.state===E.REFILL)&&(X=H.marker.getToFoodIntensity()),X>d&&(d=X,a=R)}}}if(o){this.seek(o);return}if(a){this.seek(a);return}this.directionClock=0}}searchSimple(t,e){this.debug&&(this.perceptionDraw=new Set);const n=t.getCellFromCoordsSafe(this.pos.x,this.pos.y);if(n==null||n.addDensity(this.state===E.TO_HOME,this.state===E.REFILL),n&&n.food.quantity>0&&(this.state===E.TO_FOOD||this.state===E.REFILL)){this.state=E.TO_HOME,this.foodAmount=n.pick(),this.vel.setHeading(this.vel.heading()+Math.PI),this.internalClock=0;return}if(n&&n.colony&&(this.state===E.REFILL||this.state===E.TO_HOME)){if(this.state===E.TO_HOME&&(this.vel.setHeading(this.vel.heading()+Math.PI),e.addFood(this.foodAmount)),this.state===E.REFILL&&!e.useFood(st.ANT_REFILL_FOOD_AMOUNT))return;this.state=E.TO_FOOD,this.internalClock=0;return}Math.random()<this.freedomCoef||(this.perception(t),this.wander())}addMarker(t,e){if(this.markerClock+=e,this.markerClock>=u.MARKER_PERIOD){const[n,r]=t.getCellCoords(this.pos.x,this.pos.y);if(!t.checkCoords(n,r))return;const o=u.MARKER_DEFAULT_INTENSITY*Math.exp(-.15*this.internalClock);let d=-1;switch(this.state){case E.TO_HOME:d=Tt.TO_FOOD;break;case E.TO_FOOD:d=Tt.TO_HOME;break;case E.REFILL:d=Tt.TO_HOME;break}t.addMarker(n,r,d,o),this.markerClock=0}}}class In{constructor(t){m(this,"id");m(this,"x");m(this,"y");m(this,"startingAntsCount");m(this,"maxAntsCount");m(this,"ants");m(this,"totalAnts");m(this,"colonyColor");m(this,"antIcon");m(this,"antImageInstance");m(this,"antFoodImageInstance");m(this,"antId");m(this,"isRunning");m(this,"isDrawingAnts");m(this,"isDebugMode");m(this,"colonyClock");m(this,"antsCtx");m(this,"selectedAnt");m(this,"food");m(this,"totalFood");m(this,"maxFood");this.id=t.id,this.x=t.pos.x,this.y=t.pos.y,this.startingAntsCount=st.COLONY_STARTING_ANTS,this.maxAntsCount=st.COLONY_MAX_ANTS,this.ants=[],this.totalAnts=0,this.colonyColor=t.colonyColor||[255,255,255],this.antIcon=null,this.antImageInstance=null,this.antFoodImageInstance=null,this.antId=0,this.isRunning=!1,this.isDrawingAnts=!1,this.isDebugMode=!1,this.colonyClock=0,this.antsCtx=null,this.selectedAnt=null,this.food=0,this.totalFood=0,this.maxFood=st.COLONY_MAX_FOOD}initialize(t,e,n,r,o){this.antIcon=t,this.antImageInstance=e,this.antFoodImageInstance=n,this.antsCtx=r;for(let a=0;a<this.startingAntsCount;a++){const i=new Oe(r,e,n,t,{id:this.antId+1,pos:{x:this.x,y:this.y}});this.ants.push(i),this.antId++,this.totalAnts++}const d=Math.floor(st.COLONY_RADIUS/C.SIZE);for(let a=0;a<d;a++){const i=o.getCellFromCoordsSafe(this.x-d/2*C.SIZE+a*C.SIZE,this.y),l=o.getCellFromCoordsSafe(this.x,this.y-d/2*C.SIZE+a*C.SIZE);i&&l&&(i.colony=!0,l.colony=!0)}}updateAndDrawAnts(t,e,n=!0){let r=!1;for(let o=0;o<this.ants.length;o++){this.isRunning&&(this.ants[o].searchSimple(t,this),this.ants[o].update(e),this.ants[o].addMarker(t,e),this.ants[o].isDead&&(r=!0));let d=!1;if(n){const a={x:u.IMG_HEIGHT*g,y:u.IMG_HEIGHT*g},i=(on+a.x)/g,l=(rn-B+a.y)/g,f=I.x-i/2,c=I.y-B/2/g-l/2;this.ants[o].pos.x>=f&&this.ants[o].pos.x<=f+i&&this.ants[o].pos.y>=c&&this.ants[o].pos.y<=c+l&&(d=!0),this.isDrawingAnts&&d&&this.ants[o].draw()}r&&(console.log("Removed ant: ",this.ants[o]),this.ants.splice(o,1),r=!1)}}updateColony(t){!this.isRunning||(this.colonyClock+=t,this.colonyClock>=st.ANT_CREATION_PERIOD&&this.ants.length<this.maxAntsCount&&this.useFood(st.ANT_COST)&&(this.createAnt(),this.colonyClock=0))}createAnt(t=!1){if((this.ants.length<this.maxAntsCount||t)&&this.antIcon&&this.antImageInstance&&this.antFoodImageInstance&&this.antsCtx){const e=new Oe(this.antsCtx,this.antImageInstance,this.antFoodImageInstance,this.antIcon,{id:this.antId+1,pos:{x:this.x,y:this.y}});this.ants.push(e),this.antId++,this.totalAnts++,this.isDebugMode&&console.log("Created ant: ",e)}else this.isDebugMode&&console.log("Can't create new ant - max count reached")}selectAnt(t){if(this.ants.length<=0)return null;let e=null,n=1/0;const r=u.IMG_HEIGHT/2;for(const o of this.ants){const d=o.pos.dist(t);d<n&&d<r&&(n=d,e=o)}return this.selectedAnt=e,e}removeAnt(){if(this.selectedAnt==null||this.ants.length<=0)return!1;const t=this.ants.findIndex(e=>e.id===this.selectedAnt.id);return t!=-1?(this.ants.splice(t,1),this.selectedAnt=null,!0):!1}toggleAntDebug(){if(this.ants.length>0)for(const t of this.ants)this.selectedAnt&&t.id===this.selectedAnt.id?t.debug=this.isDebugMode:t.debug=!1}drawColony(t){t.fillStyle=`rgb(${this.colonyColor[0]}, ${this.colonyColor[1]}, ${this.colonyColor[2]})`,W(t,this.x,this.y,st.COLONY_RADIUS)}addFood(t){this.food=Math.min(this.food+t,this.maxFood),this.totalFood+=t}useFood(t){return this.food>=t?(this.food-=t,!0):!1}}class We{constructor(t){m(this,"width");m(this,"height");this.width=t.width,this.height=t.height}createInstance(t){const e=document.createElement("canvas");e.width=this.width,e.height=this.height,console.log(`Created canvas image instance with size: ${this.width} x ${this.height}`);const n=e.getContext("2d");return n&&t(n,e),e}}var pt=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},$e={exports:{}};(function(s){(function(t,e,n){function r(i){var l=this,f=a();l.next=function(){var c=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=c-(l.c=c|0)},l.c=1,l.s0=f(" "),l.s1=f(" "),l.s2=f(" "),l.s0-=f(i),l.s0<0&&(l.s0+=1),l.s1-=f(i),l.s1<0&&(l.s1+=1),l.s2-=f(i),l.s2<0&&(l.s2+=1),f=null}function o(i,l){return l.c=i.c,l.s0=i.s0,l.s1=i.s1,l.s2=i.s2,l}function d(i,l){var f=new r(i),c=l&&l.state,h=f.next;return h.int32=function(){return f.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,c&&(typeof c=="object"&&o(c,f),h.state=function(){return o(f,{})}),h}function a(){var i=4022871197,l=function(f){f=String(f);for(var c=0;c<f.length;c++){i+=f.charCodeAt(c);var h=.02519603282416938*i;i=h>>>0,h-=i,h*=i,i=h>>>0,h-=i,i+=h*4294967296}return(i>>>0)*23283064365386963e-26};return l}e&&e.exports?e.exports=d:n&&n.amd?n(function(){return d}):this.alea=d})(pt,s,!1)})($e);var qe={exports:{}};(function(s){(function(t,e,n){function r(a){var i=this,l="";i.x=0,i.y=0,i.z=0,i.w=0,i.next=function(){var c=i.x^i.x<<11;return i.x=i.y,i.y=i.z,i.z=i.w,i.w^=i.w>>>19^c^c>>>8},a===(a|0)?i.x=a:l+=a;for(var f=0;f<l.length+64;f++)i.x^=l.charCodeAt(f)|0,i.next()}function o(a,i){return i.x=a.x,i.y=a.y,i.z=a.z,i.w=a.w,i}function d(a,i){var l=new r(a),f=i&&i.state,c=function(){return(l.next()>>>0)/4294967296};return c.double=function(){do var h=l.next()>>>11,y=(l.next()>>>0)/4294967296,p=(h+y)/(1<<21);while(p===0);return p},c.int32=l.next,c.quick=c,f&&(typeof f=="object"&&o(f,l),c.state=function(){return o(l,{})}),c}e&&e.exports?e.exports=d:n&&n.amd?n(function(){return d}):this.xor128=d})(pt,s,!1)})(qe);var Ge={exports:{}};(function(s){(function(t,e,n){function r(a){var i=this,l="";i.next=function(){var c=i.x^i.x>>>2;return i.x=i.y,i.y=i.z,i.z=i.w,i.w=i.v,(i.d=i.d+362437|0)+(i.v=i.v^i.v<<4^(c^c<<1))|0},i.x=0,i.y=0,i.z=0,i.w=0,i.v=0,a===(a|0)?i.x=a:l+=a;for(var f=0;f<l.length+64;f++)i.x^=l.charCodeAt(f)|0,f==l.length&&(i.d=i.x<<10^i.x>>>4),i.next()}function o(a,i){return i.x=a.x,i.y=a.y,i.z=a.z,i.w=a.w,i.v=a.v,i.d=a.d,i}function d(a,i){var l=new r(a),f=i&&i.state,c=function(){return(l.next()>>>0)/4294967296};return c.double=function(){do var h=l.next()>>>11,y=(l.next()>>>0)/4294967296,p=(h+y)/(1<<21);while(p===0);return p},c.int32=l.next,c.quick=c,f&&(typeof f=="object"&&o(f,l),c.state=function(){return o(l,{})}),c}e&&e.exports?e.exports=d:n&&n.amd?n(function(){return d}):this.xorwow=d})(pt,s,!1)})(Ge);var Ue={exports:{}};(function(s){(function(t,e,n){function r(a){var i=this;i.next=function(){var f=i.x,c=i.i,h,y;return h=f[c],h^=h>>>7,y=h^h<<24,h=f[c+1&7],y^=h^h>>>10,h=f[c+3&7],y^=h^h>>>3,h=f[c+4&7],y^=h^h<<7,h=f[c+7&7],h=h^h<<13,y^=h^h<<9,f[c]=y,i.i=c+1&7,y};function l(f,c){var h,y=[];if(c===(c|0))y[0]=c;else for(c=""+c,h=0;h<c.length;++h)y[h&7]=y[h&7]<<15^c.charCodeAt(h)+y[h+1&7]<<13;for(;y.length<8;)y.push(0);for(h=0;h<8&&y[h]===0;++h);for(h==8&&(y[7]=-1),f.x=y,f.i=0,h=256;h>0;--h)f.next()}l(i,a)}function o(a,i){return i.x=a.x.slice(),i.i=a.i,i}function d(a,i){a==null&&(a=+new Date);var l=new r(a),f=i&&i.state,c=function(){return(l.next()>>>0)/4294967296};return c.double=function(){do var h=l.next()>>>11,y=(l.next()>>>0)/4294967296,p=(h+y)/(1<<21);while(p===0);return p},c.int32=l.next,c.quick=c,f&&(f.x&&o(f,l),c.state=function(){return o(l,{})}),c}e&&e.exports?e.exports=d:n&&n.amd?n(function(){return d}):this.xorshift7=d})(pt,s,!1)})(Ue);var Xe={exports:{}};(function(s){(function(t,e,n){function r(a){var i=this;i.next=function(){var f=i.w,c=i.X,h=i.i,y,p;return i.w=f=f+1640531527|0,p=c[h+34&127],y=c[h=h+1&127],p^=p<<13,y^=y<<17,p^=p>>>15,y^=y>>>12,p=c[h]=p^y,i.i=h,p+(f^f>>>16)|0};function l(f,c){var h,y,p,P,U,R=[],H=128;for(c===(c|0)?(y=c,c=null):(c=c+"\0",y=0,H=Math.max(H,c.length)),p=0,P=-32;P<H;++P)c&&(y^=c.charCodeAt((P+32)%c.length)),P===0&&(U=y),y^=y<<10,y^=y>>>15,y^=y<<4,y^=y>>>13,P>=0&&(U=U+1640531527|0,h=R[P&127]^=y+U,p=h==0?p+1:0);for(p>=128&&(R[(c&&c.length||0)&127]=-1),p=127,P=4*128;P>0;--P)y=R[p+34&127],h=R[p=p+1&127],y^=y<<13,h^=h<<17,y^=y>>>15,h^=h>>>12,R[p]=y^h;f.w=U,f.X=R,f.i=p}l(i,a)}function o(a,i){return i.i=a.i,i.w=a.w,i.X=a.X.slice(),i}function d(a,i){a==null&&(a=+new Date);var l=new r(a),f=i&&i.state,c=function(){return(l.next()>>>0)/4294967296};return c.double=function(){do var h=l.next()>>>11,y=(l.next()>>>0)/4294967296,p=(h+y)/(1<<21);while(p===0);return p},c.int32=l.next,c.quick=c,f&&(f.X&&o(f,l),c.state=function(){return o(l,{})}),c}e&&e.exports?e.exports=d:n&&n.amd?n(function(){return d}):this.xor4096=d})(pt,s,!1)})(Xe);var Ye={exports:{}};(function(s){(function(t,e,n){function r(a){var i=this,l="";i.next=function(){var c=i.b,h=i.c,y=i.d,p=i.a;return c=c<<25^c>>>7^h,h=h-y|0,y=y<<24^y>>>8^p,p=p-c|0,i.b=c=c<<20^c>>>12^h,i.c=h=h-y|0,i.d=y<<16^h>>>16^p,i.a=p-c|0},i.a=0,i.b=0,i.c=-1640531527,i.d=1367130551,a===Math.floor(a)?(i.a=a/4294967296|0,i.b=a|0):l+=a;for(var f=0;f<l.length+20;f++)i.b^=l.charCodeAt(f)|0,i.next()}function o(a,i){return i.a=a.a,i.b=a.b,i.c=a.c,i.d=a.d,i}function d(a,i){var l=new r(a),f=i&&i.state,c=function(){return(l.next()>>>0)/4294967296};return c.double=function(){do var h=l.next()>>>11,y=(l.next()>>>0)/4294967296,p=(h+y)/(1<<21);while(p===0);return p},c.int32=l.next,c.quick=c,f&&(typeof f=="object"&&o(f,l),c.state=function(){return o(l,{})}),c}e&&e.exports?e.exports=d:n&&n.amd?n(function(){return d}):this.tychei=d})(pt,s,!1)})(Ye);var Ve={exports:{}};(function(s){(function(t,e,n){var r=256,o=6,d=52,a="random",i=n.pow(r,o),l=n.pow(2,d),f=l*2,c=r-1,h;function y(x,T,F){var _=[];T=T==!0?{entropy:!0}:T||{};var M=R(U(T.entropy?[x,X(e)]:x==null?H():x,3),_),A=new p(_),z=function(){for(var Z=A.g(o),V=i,N=0;Z<l;)Z=(Z+N)*r,V*=r,N=A.g(1);for(;Z>=f;)Z/=2,V/=2,N>>>=1;return(Z+N)/V};return z.int32=function(){return A.g(4)|0},z.quick=function(){return A.g(4)/4294967296},z.double=z,R(X(A.S),e),(T.pass||F||function(Z,V,N,k){return k&&(k.S&&P(k,A),Z.state=function(){return P(A,{})}),N?(n[a]=Z,V):Z})(z,M,"global"in T?T.global:this==n,T.state)}function p(x){var T,F=x.length,_=this,M=0,A=_.i=_.j=0,z=_.S=[];for(F||(x=[F++]);M<r;)z[M]=M++;for(M=0;M<r;M++)z[M]=z[A=c&A+x[M%F]+(T=z[M])],z[A]=T;(_.g=function(Z){for(var V,N=0,k=_.i,nt=_.j,Y=_.S;Z--;)V=Y[k=c&k+1],N=N*r+Y[c&(Y[k]=Y[nt=c&nt+V])+(Y[nt]=V)];return _.i=k,_.j=nt,N})(r)}function P(x,T){return T.i=x.i,T.j=x.j,T.S=x.S.slice(),T}function U(x,T){var F=[],_=typeof x,M;if(T&&_=="object")for(M in x)try{F.push(U(x[M],T-1))}catch{}return F.length?F:_=="string"?x:x+"\0"}function R(x,T){for(var F=x+"",_,M=0;M<F.length;)T[c&M]=c&(_^=T[c&M]*19)+F.charCodeAt(M++);return X(T)}function H(){try{var x;return h&&(x=h.randomBytes)?x=x(r):(x=new Uint8Array(r),(t.crypto||t.msCrypto).getRandomValues(x)),X(x)}catch{var T=t.navigator,F=T&&T.plugins;return[+new Date,t,F,t.screen,X(e)]}}function X(x){return String.fromCharCode.apply(0,x)}if(R(n.random(),e),s.exports){s.exports=y;try{h=require("crypto")}catch{}}else n["seed"+a]=y})(typeof self!="undefined"?self:pt,[],Math)})(Ve);var En=$e.exports,xn=qe.exports,wn=Ge.exports,On=Ue.exports,Tn=Xe.exports,Cn=Ye.exports,It=Ve.exports;It.alea=En;It.xor128=xn;It.xorwow=wn;It.xorshift7=On;It.xor4096=Tn;It.tychei=Cn;var Te=It;class Mn{constructor(t){m(this,"width");m(this,"height");m(this,"map");m(this,"fillRatio");m(this,"threshold");this.width=t.width,this.height=t.height,this.map=Array.from(Array(this.width),()=>new Array(this.height)),this.fillRatio=t.fillRatio,this.threshold=(this.width+this.height)/2}generateMap(t,e=!1,n=""){console.log("Generate Map");const r=new URL(window.location.href),o=r.searchParams.get("seed");let d=null;if(e&&o!=null)d=Te(o);else{if(e)return;{const a=Math.random().toString(36).slice(2,7);d=Te(n!=""?n:a),r.searchParams.set("seed",n!=""?n:a)}}console.log(d()),window.history.pushState({path:r.href},"",r.href),this.randomFillMap(d);for(let a=0;a<15;a++)this.smoothMap();this.addBorderWalls(),this.processMap();for(let a=0;a<t.width;a++)for(let i=0;i<t.height;i++)t.cells[t.getIndexFromCoords(a,i)].wall=this.map[a][i]?1:0}randomFillMap(t){for(let e=0;e<this.width;e++)for(let n=0;n<this.height;n++)this.map[e][n]=pn(0,1,t)<this.fillRatio?1:0}smoothMap(){const t=[];for(let e=0;e<this.map.length;e++)t[e]=this.map[e].slice();for(let e=0;e<this.width;e++)for(let n=0;n<this.height;n++){const r=this.getNeighbourWallCount(e,n);r>4?t[e][n]=1:r<4&&(t[e][n]=0)}this.map=t}getNeighbourWallCount(t,e){let n=0;for(let r=t-1;r<=t+1;r++)for(let o=e-1;o<=e+1;o++)r>=0&&r<this.width&&o>=0&&o<this.height?(r!==t||o!==e)&&(n+=this.map[r][o]):n++;return n}addBorderWalls(){const t=fe.BORDER_SIZE;for(let e=0;e<this.width;e++)for(let n=0;n<t;n++)this.map[e][n]=1,this.map[e][this.height-n-1]=1;for(let e=0;e<t;e++)for(let n=0;n<this.height;n++)this.map[e][n]=1,this.map[this.width-e-1][n]=1}processMap(){const t=this.getRegions(1);if(!t)return;const e=this.threshold;for(const o of t)if(o.length<e)for(const d of o)this.map[d.x][d.y]=0;const n=this.getRegions(0);if(!n)return;const r=this.threshold;for(const o of n)if(o.length<r)for(const d of o)this.map[d.x][d.y]=1}getRegions(t){const e=[],n=Array.from(Array(this.width),()=>new Array(this.height).fill(0));for(let r=0;r<this.width;r++)for(let o=0;o<this.height;o++)if(n[r][o]===0&&this.map[r][o]===t){const d=this.getRegionCells(r,o);if(!d)return;e.push(d);for(const a of d)n[a.x][a.y]=1}return e}getRegionCells(t,e){const n=[],r=Array.from(Array(this.width),()=>new Array(this.height).fill(0)),o=this.map[t][e],d=[];for(d.push({x:t,y:e}),r[t][e]=1;d.length>0;){const a=d.shift();if(!a)return;n.push(a);for(let i=a.x-1;i<=a.x+1;i++)for(let l=a.y-1;l<=a.y+1;l++)i>=0&&i<this.width&&l>=0&&l<this.height&&(l===a.y||i===a.x)&&r[i][l]===0&&this.map[i][l]===o&&(r[i][l]=1,d.push({x:i,y:l}))}return n}}class An{constructor(t){m(this,"measurementArray");m(this,"sampleSize");m(this,"isMeasuring");m(this,"modes");m(this,"mode");this.measurementArray=new Map,this.sampleSize=60,this.isMeasuring=!0,this.modes=[],this.mode=0,this.getModes(t),this.createMeasurementArray(t)}getModes(t){for(const e of t)this.modes.push(e.mode)}changeMode(){this.mode==this.modes.length-1?(this.isMeasuring=!1,this.mode=-1):(this.isMeasuring=!0,this.mode++),this.toggleDisplayVisibility()}toggleDisplayVisibility(){for(const t of this.measurementArray.values()){if(!t.element)return;this.isMeasuring&&t.mode<=this.mode?t.element.style.display="block":t.element.style.display="none"}}createMeasurementArray(t){for(const e of t)for(const n of e.stats)this.measurementArray.set(n.name,{performanceArray:[],title:n.title,mode:e.mode,index:0})}createPerformanceDisplay(t){const e=[];for(const[n,r]of this.measurementArray){const o=document.createElement("span");o.dataset[n.toString()]="",o.title=r.title,this.isMeasuring&&r.mode<=this.mode?o.style.display="block":o.style.display="none",r.element=t.appendChild(o),e.push(r.element)}return e}startMeasurement(t){const e=this.measurementArray.get(t);e&&e.mode<=this.mode&&(e.startTime=performance.now())}endMeasurement(t){const e=this.measurementArray.get(t);e&&e.startTime&&e.mode<=this.mode&&(e.performanceArray[e.index]=performance.now()-e.startTime)}setPerformance(t,e){const n=this.measurementArray.get(t);n&&n.mode<=this.mode&&(n.performanceArray[n.index]=e)}update(){const t=new Map;for(const e of this.measurementArray.keys())t.set(e,0);for(const[e,n]of this.measurementArray)for(let r=0;r<n.performanceArray.length;r++)t.set(e,t.get(e)+n.performanceArray[r]);for(const[e,n]of this.measurementArray){if(n.performanceArray.length===0)break;t.set(e,t.get(e)/n.performanceArray.length),n.mode<=this.mode&&(n.index++,n.index===this.sampleSize&&(n.index=0))}return t}}class Et{constructor(t,e){m(this,"canvas");m(this,"width");m(this,"height");m(this,"cellSize");this.canvas=t,this.width=e.width,this.height=e.height,this.cellSize=e.cellSize}create(){return this.canvas.width=this.width,this.canvas.height=this.height,console.log(`Created canvas with size: ${this.width} x ${this.height}`),this.canvas.getContext("2d")}}function Sn(s){let t=Math.floor(s.width/s.cellSize),e=Math.floor(s.height/s.cellSize);t%2===0&&t--,e%2===0&&e--;const n=t*s.cellSize,r=e*s.cellSize;return console.log(`Calculate sizes:
${s.width==n?n:`${s.width} -> ${n}`} x ${s.height==r?r:`${s.height} -> ${r}`}`),[n,r]}class Pn{constructor(t){m(this,"quantity");m(this,"changed");this.quantity=t,this.changed=!0}draw(t,e,n){t.clearRect(e*D.SIZE,n*D.SIZE,D.SIZE,D.SIZE);const r=e*D.SIZE+D.SIZE/2,o=n*D.SIZE+D.SIZE/2;t.fillStyle=`hsl(120, 40%, 43%, ${this.quantity/100})`,W(t,r,o,D.SIZE/2,!0),this.changed=!1}pick(){if(this.changed=!0,this.quantity===0)return 0;let t=0;return this.quantity<D.PICK_AMOUNT?t=this.quantity:t=D.PICK_AMOUNT,this.quantity=Math.max(this.quantity-D.PICK_AMOUNT,0),t}}class _n{constructor(t){m(this,"intensity");this.intensity=t}getToHomeIntensity(){return this.intensity[0]}getToFoodIntensity(){return this.intensity[1]}getMixedColor(){if(this.intensity[0]===0&&this.intensity[1]===0)return[0,0,0];const[t,e,n]=xe.TO_HOME,[r,o,d]=xe.TO_FOOD,a=[this.intensity[0]*t,this.intensity[0]*e,this.intensity[0]*n];if(this.intensity[1]===0)return[Math.round(a[0]),Math.round(a[1]),Math.round(a[2])];const i=[this.intensity[1]*r,this.intensity[1]*o,this.intensity[1]*d];if(this.intensity[0]===0)return[Math.round(i[0]),Math.round(i[1]),Math.round(i[2])];let l=[a[0]+i[0],a[1]+i[1],a[2]+i[2]];return l=[Math.round(Math.min(l[0],255)),Math.round(Math.min(l[1],255)),Math.round(Math.min(l[2],255))],l}update(){this.intensity[0]>.01?this.intensity[0]-=we:this.intensity[0]=0,this.intensity[1]>.01?this.intensity[1]-=we:this.intensity[1]=0}}class Rn{constructor(){m(this,"marker");m(this,"food");m(this,"wall");m(this,"density");m(this,"colony");this.marker=new _n([0,0]),this.food=new Pn(0),this.wall=0,this.density=[0,0,0],this.colony=!1}update(){this.marker.update()}pick(){return this.food.pick()}drawWall(t,e,n){t.fillRect(e,n,1,1)}addDensity(t=!1,e=!1){!t&&!e?this.density[0]++:e?this.density[2]++:this.density[1]++}}class bn{constructor(t){m(this,"width");m(this,"height");m(this,"cellSize");m(this,"cells");this.width=t.width,this.height=t.height,this.cellSize=t.cellSize,this.cells=[];for(let e=0;e<this.width*this.height;e++)this.cells.push(new Rn)}addBorderWalls(){const t=fe.BORDER_SIZE;for(let e=0;e<this.width;e++)for(let n=0;n<t;n++){const r=this.cells[this.getIndexFromCoords(e,n)],o=this.cells[this.getIndexFromCoords(e,this.height-n-1)];r.wall=1,o.wall=1}for(let e=0;e<t;e++)for(let n=0;n<this.height;n++){const r=this.cells[this.getIndexFromCoords(e,n)],o=this.cells[this.getIndexFromCoords(this.width-e-1,n)];r.wall=1,o.wall=1}}update(){for(const t of this.cells)this.updateCell(t)}updateCell(t){t.marker.update();for(let e=0;e<3;e++)t.density[e]>.01?t.density[e]*=.99:t.density[e]=0}addMarker(t,e,n,r){const o=this.cells[this.getIndexFromCoords(t,e)];n===Tt.TO_HOME?o.marker.intensity[0]=Math.min(1,Math.max(o.marker.getToHomeIntensity(),r)):n===Tt.TO_FOOD&&(o.marker.intensity[1]=Math.min(1,Math.max(o.marker.getToFoodIntensity(),r)))}addFood(t,e,n){const r=this.getIndexFromCoords(t,e);if(r>this.cells.length||r<0)return;const o=this.cells[r];o.food.quantity=Math.min(o.food.quantity+n,100),o.food.changed=!0}drawMarkers(t,e,n=!0){for(let r=0;r<e.data.length;r+=4){const o=this.cells[r/4];e.data[r+0]=o.marker.getToHomeIntensity()*255,e.data[r+1]=o.marker.getToFoodIntensity()*255,e.data[r+2]=0,e.data[r+3]=255,n&&this.updateCell(o)}t.putImageData(e,0,0)}drawFood(t){for(let e=0;e<this.cells.length;e++)if(this.cells[e].food.changed){const[n,r]=this.getCoordsFromIndex(e);this.cells[e].food.draw(t,n,r)}}drawWalls(t){t.fillStyle="rgb(163, 163, 163)";for(let e=0;e<this.width;e++)for(let n=0;n<this.height;n++){const r=this.cells[this.getIndexFromCoords(e,n)];r.wall===1&&r.drawWall(t,e,n)}}drawDensity(t,e,n=!0,r=!1){for(let o=0;o<e.data.length;o+=4){const d=this.cells[o/4],a=d.density;if(r)e.data[o+0]=4*a[0],e.data[o+1]=4*a[1],e.data[o+2]=4*a[2],e.data[o+3]=255;else{const i=a[0]+a[1]+a[2];e.data[o+0]=4*i,e.data[o+1]=i,e.data[o+2]=i,e.data[o+3]=255}n&&this.updateCell(d)}t.putImageData(e,0,0)}isOnFood(t,e){return this.cells[this.getIndexFromCoords(t,e)].food.quantity>0}getIndexFromCoords(t,e){return t+e*this.width}getCoordsFromIndex(t){const e=t%this.width,n=Math.floor(t/this.width);return[e,n]}getCellCoords(t,e){const n=Math.floor(t/C.SIZE),r=Math.floor(e/C.SIZE);return[n,r]}getCellFromCoords(t,e,n=!1){return n||([t,e]=this.getCellCoords(t,e)),this.cells[this.getIndexFromCoords(t,e)]}getCellFromCoordsSafe(t,e){const[n,r]=this.getCellCoords(t,e);return this.checkCoords(n,r)?this.getCellFromCoords(n,r,!0):null}checkCoords(t,e){return t>-1&&t<this.width&&e>-1&&e<this.height}}const dt=document.getElementById("canvas-container"),vn=document.getElementById("camera-container"),Fn=document.getElementById("btn-fullscreen"),Nn=document.getElementById("btn-pan"),Ln=document.getElementById("canvas"),Ke=document.getElementById("canvas-markers"),je=document.getElementById("canvas-food"),Dn=document.getElementById("canvas-colony"),Je=document.getElementById("canvas-walls"),vt=document.getElementById("canvas-edit"),Ft=document.getElementById("canvas-edit-preview"),Ce=document.getElementById("antIcon"),Ht=document.getElementById("btn-ant-panel"),ue=document.getElementById("antPanel"),Me=document.querySelector("[data-id]"),Ae=document.querySelector("[data-pos]"),Se=document.querySelector("[data-vel]"),Pe=document.querySelector("[data-state]"),Kt=document.querySelector("[data-lifespan-preview]"),_e=document.querySelector("[data-lifespan]"),se=document.getElementById("btn-track"),kn=document.getElementById("btn-remove"),ie=document.getElementById("btn-cell-panel"),Qe=document.getElementById("cellPanel"),Re=document.querySelector("[data-cell-preview]"),be=document.querySelector("[data-intensity-home]"),ve=document.querySelector("[data-intensity-food]"),Fe=document.querySelector("[data-cell-food]"),Ne=document.querySelector("[data-density]"),oe=document.getElementById("btn-colony-panel"),tn=document.getElementById("colonyPanel"),Le=document.querySelector("[data-colony-preview]"),De=document.querySelector("[data-colony-pop]"),ke=document.querySelector("[data-colony-food]"),He=document.querySelector("[data-pause]"),en=document.getElementById("btn-play"),nn=document.getElementById("btn-pause"),re=document.getElementById("btn-edit-mode"),sn=document.getElementById("editPanel"),ze=document.querySelector("[data-brush-preview]"),Hn=document.querySelector("[data-brush-size]"),ft=document.getElementById("brushSizeInput"),zt=document.getElementById("btn-wall-brush"),ae=document.getElementById("btn-food-brush"),zn=document.getElementById("btn-save"),Zn=document.getElementById("btn-controls"),Bn=document.getElementById("btn-close-controls"),Gt=document.getElementById("controlsPanel"),Wn=document.querySelector("[data-performance-display]"),Mt=document.getElementById("mapPanel"),$n=document.getElementById("btn-close-map"),qn=document.getElementById("btn-cancel-map"),Gn=document.getElementById("btn-map-panel"),Un=document.getElementById("btn-generate-seed"),Xn=document.getElementById("map-form"),ye=document.getElementById("map-seed");let K=!1,Ct=!0,ot=!1,rt=!1,ut=!1,kt=!1,ct=!1,le=!1,ce=!1,at=!1,yt=!1,jt=!1,Zt=!0,Bt=!1,Rt=!1,lt=!1,j=!1,L=!1,Jt=0;const b=new An([{mode:0,stats:[{name:"fps",title:"Frames per second"},{name:"ms",title:"Milliseconds to render a frame"}]},{mode:1,stats:[{name:"clear",title:"Milliseconds to clear the screen"},{name:"grid",title:"Milliseconds to draw markers/density and update cells"},{name:"food",title:"Milliseconds to draw food"},{name:"ants",title:"Milliseconds to draw and update ants"},{name:"panels",title:"Milliseconds to update info panels"},{name:"all",title:"Milliseconds needed for main loop"}]}]),[Yn,Qt,Vn,Kn,jn,Jn,Qn,ts]=b.createPerformanceDisplay(Wn),B=dt.getBoundingClientRect().top;let Ut=0,Xt=0,g=1,Ot=!1,Wt=!1,te=0;const Q={x:0,y:0},O={x:0,y:0},I={x:0,y:0};let St=0,he=!1,J=5;const es=new URL(window.location.href),ee=es.searchParams.get("seed");let Pt=ee!=null?ee:"";ye.value=Pt;let on=window.innerWidth,rn=window.innerHeight;window.addEventListener("resize",()=>{on=window.innerWidth,rn=window.innerHeight;const s={x:0,y:0};s.x=window.innerWidth/2/g-O.x,s.y=window.innerHeight/2/g-O.y,O.x=window.innerWidth/2/g-s.x,O.y=window.innerHeight/2/g-s.y,I.x=(window.innerWidth/2-window.innerWidth/2)/g-s.x,I.y=(window.innerHeight/2-window.innerHeight/2)/g-s.y,I.x=I.x<0?Math.abs(I.x):I.x*-1,I.y=I.y<0?Math.abs(I.y):I.y*-1,xt()});const[q,G]=Sn({width:Ee.WIDTH,height:Ee.HEIGHT,cellSize:C.SIZE}),ns=new Et(Ke,{width:q/C.SIZE,height:G/C.SIZE,cellSize:1});Ke.style.transform=`scale(${C.SIZE})`;const $=ns.create(),ss=new Et(je,{width:q/(C.SIZE/D.SIZE),height:G/(C.SIZE/D.SIZE),cellSize:C.SIZE/D.SIZE});je.style.transform=`scale(${C.SIZE/D.SIZE})`;const $t=ss.create(),is=new Et(Ln,{width:q,height:G,cellSize:C.SIZE}),ht=is.create(),os=new We({width:u.IMG_WIDTH,height:u.IMG_HEIGHT}),rs=new We({width:u.FOOD_SIZE,height:u.FOOD_SIZE}),as=new Et(Dn,{width:q,height:G,cellSize:C.SIZE}),de=as.create(),ls=new Et(Je,{width:q/C.SIZE,height:G/C.SIZE,cellSize:1});Je.style.transform=`scale(${C.SIZE})`;const et=ls.create(),cs=new Et(vt,{width:q/C.SIZE,height:G/C.SIZE,cellSize:1});vt.style.transform=`scale(${C.SIZE})`;const tt=cs.create(),hs=new Et(Ft,{width:q/C.SIZE,height:G/C.SIZE,cellSize:1});Ft.style.transform=`scale(${C.SIZE})`;const _t=hs.create(),w=new bn({width:q/C.SIZE,height:G/C.SIZE,cellSize:1}),an=new Mn({width:w.width,height:w.height,fillRatio:fe.FILL_RATIO}),qt=$==null?void 0:$.createImageData(w.width,w.height),Lt=$==null?void 0:$.createImageData(w.width,w.height),S=new In({id:1,pos:{x:q/2,y:G/2}});window.addEventListener("keydown",s=>{switch(console.log(s),s.code){case"Space":s.preventDefault(),ge();break;case"KeyM":us();break;case"KeyN":ys();break;case"KeyA":gs();break;case"KeyD":ms();break;case"KeyT":cn();break;case"KeyC":pe();break;case"Delete":hn();break;case"Insert":for(let t=0;t<(s.ctrlKey?10:s.shiftKey?100:1);t++)Is();break;case"KeyF":b.changeMode();break;case"ArrowUp":Dt(0,Nt);break;case"ArrowDown":Dt(0,-Nt);break;case"ArrowLeft":Dt(Nt,0);break;case"ArrowRight":Dt(-Nt,0);break;case"Minus":Be(!1);break;case"Equal":Be(!0);break;case"Comma":Ze(-mt.STEP);break;case"Period":Ze(mt.STEP);break;case"Escape":j&&(j=v(j,Gt)),L&&(L=v(L,Mt));break}});dt.addEventListener("mousemove",s=>{Ut=s.pageX,Xt=s.pageY-B});dt.addEventListener("click",()=>{if(Wt){Wt=!1;return}ps(),ut&&ln()});dt.addEventListener("contextmenu",s=>{if(s.preventDefault(),ct)return;const t=gt(Math.floor((Ut/g-O.x)/C.SIZE),Math.floor((Xt/g-O.y)/C.SIZE));ut&&console.log(`Placed food at: ${t.x}:${t.y}`),w.addFood(t.x,t.y,10)});dt.addEventListener("wheel",s=>{Cs(s)});Fn.addEventListener("click",()=>{pe()});se.addEventListener("click",()=>{cn()});kn.addEventListener("click",()=>{hn()});en.addEventListener("click",()=>{ge()});nn.addEventListener("click",()=>{ge()});oe.addEventListener("click",()=>{Bt=v(Bt,tn,oe)});Bt=v(Bt,tn,oe);ie.addEventListener("click",()=>{Rt=v(Rt,Qe,ie)});Ht.addEventListener("click",()=>{lt=v(lt,ue,Ht)});Zn.addEventListener("click",()=>{j=v(j,Gt),L=!0,L=v(L,Mt)});Bn.addEventListener("click",()=>{j=!0,j=v(j,Gt)});Gn.addEventListener("click",()=>{L=v(L,Mt),j=!0,j=v(j,Gt)});$n.addEventListener("click",()=>{L=!0,L=v(L,Mt)});qn.addEventListener("click",()=>{L=!0,L=v(L,Mt)});Un.addEventListener("click",()=>{const s=Math.random().toString(36).slice(2,7);console.log(s),ye.value=s});Xn.addEventListener("submit",s=>{console.log("submit",s),Pt=ye.value,console.log(Pt),L=!0,L=v(L,Mt),et&&Pt&&(et.clearRect(0,0,w.width,w.height),an.generateMap(w,!1,Pt),w.drawWalls(et)),s.preventDefault()});re.addEventListener("click",()=>{ct=v(ct,sn,re),ct?(vt.style.display="block",Ft.style.display="block"):(vt.style.display="none",Ft.style.display="none")});zt.addEventListener("click",()=>{at=bt(at,zt),at&&(yt=!0,yt=bt(at,ae))});ae.addEventListener("click",()=>{yt=bt(yt,ae),yt&&(at=!0,at=bt(yt,zt))});zn.addEventListener("click",()=>{if(tt&&et){const s=tt.getImageData(0,0,w.width,w.height);et.clearRect(0,0,w.width,w.height);for(let t=0;t<s.data.length;t+=4){const e=w.cells[t/4],n=s.data[t+0],r=s.data[t+1],o=s.data[t+2],d=s.data[t+3];r<=160&&r>0&&r>n&&r>o?e.wall!==1?(e.food.quantity=Math.min(100,Math.round(100*(d/255))+e.food.quantity),e.food.changed=!0):e.wall=1:n>10&&r>10&&o>10&&n===r&&r===o?(e.wall=1,e.food.quantity=0,e.food.changed=!0):d>0&&n<5&&r<5&&o<5&&(e.food.quantity=0,e.food.changed=!0,e.wall=0)}w.addBorderWalls(),w.drawWalls(et),tt.clearRect(0,0,w.width,w.height),ct=v(ct,sn,re),vt.style.display="none",Ft.style.display="none"}});ft.addEventListener("input",()=>{J=parseInt(ft.value),me()});function ds(){ft.min=mt.MIN_SIZE.toString(),ft.max=mt.MAX_SIZE.toString(),ft.step=mt.STEP.toString(),ft.value=J.toString()}function me(){ze.style.width=`${J}px`,ze.style.height=`${J}px`,Hn.textContent=`${J} px`}function Ze(s){J=Math.min(mt.MAX_SIZE,Math.max(mt.MIN_SIZE,J+s)),ft.value=J.toString(),me()}ds();me();at=bt(at,zt);fs();Ts();pe();window.requestAnimationFrame(dn);function fs(){if(!($==null||$t==null||ht==null||de==null||et==null||tt==null||_t==null)){if(qt&&(w.drawMarkers($,qt),w.drawFood($t)),Ce){const s=new XMLSerializer().serializeToString(Ce),t=btoa(s),n="data:image/svg+xml;base64,"+t,r=new Image;r.src=n,r.onload=()=>{const o=os.createInstance(a=>{a.drawImage(r,0,0)}),d=rs.createInstance(a=>{const i=u.FOOD_SIZE/2;a.fillStyle="hsl(120, 40%, 43%)",W(a,i,i,u.FOOD_SIZE/2)});S.initialize(r,o,d,ht,w)}}S.drawColony(de),w.addBorderWalls(),w.drawWalls(et),an.generateMap(w,!0),w.drawWalls(et)}}function ge(){Zt&&(S.isDrawingAnts=!0,Zt=!1),He&&(K=!K,S.isRunning=K,He.style.display=K?"none":"block",en.style.display=K?"none":"flex",nn.style.display=K?"flex":"none")}function us(){Ct=!Ct,Ct&&(ot=!1,rt=!1)}function ys(){rt=ot?!rt:rt,ot=rt?ot:!ot,(ot||rt)&&(Ct=!1),console.log(ot,rt,Ct)}function ms(){ut=!ut,S.isDebugMode=ut,ln(),ut&&(Rt=!1),Rt=v(Rt,Qe,ie)}function ln(){S.toggleAntDebug()}function cn(){S.selectedAnt!=null&&(kt=!kt,kt&&(g=3),se.classList.toggle("border-green-500"),se.classList.toggle("border-red-500"))}function ne(){jt=!jt,jt?document.body.classList.add("cursor-grabbing"):document.body.classList.remove("cursor-grabbing"),Nn.classList.toggle("bg-neutral-600")}function gs(){if(Zt){Zt=!1,S.isDrawingAnts=!1;return}S.isDrawingAnts=!S.isDrawingAnts}function ps(){const s=gt(Ut/g-O.x,Xt/g-O.y);S.selectAnt(s),S.selectedAnt?lt=!1:lt=!0,lt=v(lt,ue,Ht)}function hn(){S.removeAnt()&&(lt=!0,lt=v(lt,ue,Ht))}function Is(){S.createAnt(!0)}function Es(){const s=S.selectedAnt;if(!s||!Me||!Ae||!Se||!Pe||!Kt||!_e)return;Me.textContent=s.id.toString(),Ae.textContent=`${s.pos.x.toFixed(2)} : ${s.pos.y.toFixed(2)}`,Se.textContent=`${s.vel.x.toFixed(2)} : ${s.vel.y.toFixed(2)}`;let t="";switch(s.state){case E.TO_HOME:t="To Home";break;case E.TO_FOOD:t="To Food";break;case E.REFILL:t="Refill";break}Pe.textContent=t;const e=u.AUTONOMY_REFILL/s.maxAutonomy,n=s.internalClock/s.maxAutonomy;Kt.style.setProperty("--left",`${e*100}%`),Kt.style.setProperty("--width",`${n*100}%`),_e.textContent=`${s.internalClock.toFixed(2)} | ${s.maxAutonomy.toFixed(2)}`}function xs(s,t){const e=w.getCellFromCoordsSafe(s,t);if(!e||!be||!ve||!Fe||!Ne||!Re)return;be.textContent=e.marker.getToHomeIntensity().toFixed(2),ve.textContent=e.marker.getToFoodIntensity().toFixed(2),Fe.textContent=e.food.quantity.toString(),Ne.textContent=(e.density[0]+e.density[1]+e.density[2]).toFixed(2);const n=e.marker.getMixedColor();Re.style.backgroundColor=`rgb(${n[0]}, ${n[1]}, ${n[2]})`}function ws(){if(!S||!De||!ke||!Le)return;De.textContent=`${S.ants.length} | ${S.totalAnts}`,ke.textContent=`${S.food.toFixed(2)} | ${S.totalFood}`;const s=S.colonyColor;Le.style.backgroundColor=`rgb(${s[0]}, ${s[1]}, ${s[2]})`}function Os(){const s=b.update();Yn.textContent=`${Math.round(s.get("fps")*100)/100} fps`,Qt.textContent=`${Math.round(s.get("ms")*100)/100} ms`,Vn.textContent=`${Math.round(s.get("clear")*100)/100} ms`,Kn.textContent=`${Math.round(s.get("grid")*100)/100} ms`,jn.textContent=`${Math.round(s.get("food")*100)/100} ms`,Jn.textContent=`${Math.round(s.get("ants")*100)/100} ms`,Qn.textContent=`${Math.round(s.get("panels")*100)/100} ms`,ts.textContent=`${Math.round(s.get("all")*100)/100} ms`,s.get("ms")>16.7?Qt.classList.add("text-red-500"):Qt.classList.remove("text-red-500")}function Ts(){dt.addEventListener("mousedown",s=>{if(clearTimeout(te),s.buttons==Vt&&ct)ce=!0;else if(s.buttons==Vt)return;if(s.buttons==mn)Ot=!0,Wt=!1,ne(),Q.x=s.clientX/g-O.x,Q.y=(s.clientY-B)/g-O.y;else{if(ct){le=!0;return}Ot=!1,te=setTimeout(()=>{Ot=!0,Wt=!0,ne(),Q.x=s.clientX/g-O.x,Q.y=(s.clientY-B)/g-O.y},100)}}),dt.addEventListener("mousemove",s=>{!Ot||s.buttons==Vt||Ms(s)}),dt.addEventListener("mouseup",()=>{clearTimeout(te),le=!1,ce=!1,Ot&&(Ot=!1,ne())})}function Cs(s){const t={x:0,y:0};t.x=s.clientX/g-O.x,t.y=(s.clientY-B)/g-O.y,g*=.999**s.deltaY,g=Math.min(Math.max(.15,g),16),O.x=s.clientX/g-t.x,O.y=(s.clientY-B)/g-t.y,I.x=(s.clientX-window.innerWidth/2)/g-t.x,I.y=(s.clientY-B-window.innerHeight/2)/g-t.y,I.x=I.x<0?Math.abs(I.x):I.x*-1,I.y=I.y<0?Math.abs(I.y):I.y*-1,xt()}function Ms(s){console.log(s),O.x=s.clientX/g-Q.x,O.y=(s.clientY-B)/g-Q.y;const t={x:window.innerWidth/2-q/2,y:window.innerHeight/2-G/2},e={x:0,y:0};e.x=(s.clientX-t.x)/g-Q.x,e.y=(s.clientY-B-t.y)/g-Q.y,console.log("--- START ---"),console.log(O),console.log(t),console.log(g),console.log(e);const n={x:0,y:0};n.x=s.clientX/g-O.x,n.y=(s.clientY-B)/g-O.y,console.log(n),console.log(s.clientX,s.clientY),I.x=(s.clientX-window.innerWidth/2)/g-Q.x,I.y=(s.clientY-B-window.innerHeight/2)/g-Q.y,console.log(I),console.log(window.innerWidth,window.innerHeight),I.x=I.x<0?Math.abs(I.x):I.x*-1,I.y=I.y<0?Math.abs(I.y):I.y*-1,console.log("--- END ---"),xt()}function Dt(s,t){O.x+=s,O.y+=t,I.x-=s,I.y-=t,xt()}function Be(s){const t={x:0,y:0};t.x=window.innerWidth/2/g-O.x,t.y=window.innerHeight/2/g-O.y,g*=.999**(s?-100:100),g=Math.min(Math.max(.15,g),16),O.x=window.innerWidth/2/g-t.x,O.y=window.innerHeight/2/g-t.y,I.x=(window.innerWidth/2-window.innerWidth/2)/g-t.x,I.y=(window.innerHeight/2-window.innerHeight/2)/g-t.y,I.x=I.x<0?Math.abs(I.x):I.x*-1,I.y=I.y<0?Math.abs(I.y):I.y*-1,xt()}function pe(){const s={x:window.innerWidth/2-q/2,y:window.innerHeight/2-G/2};g=1,O.x=s.x,O.y=s.y,I.x=q/2,I.y=G/2,xt()}function As(s,t){const e={x:window.innerWidth/2/g-s,y:window.innerHeight/2/g-t};O.x=e.x,O.y=e.y,I.x=window.innerWidth/2/g-e.x,I.y=window.innerHeight/2/g-e.y,xt()}function xt(){vn.style.transform=`scale(${g}) translate(${O.x}px, ${O.y}px)`,he=!0}function dn(s){if($==null||$t==null||ht==null||de==null||et==null||tt==null||_t==null)return;window.requestAnimationFrame(dn),b.startMeasurement("all");const t=(s-Jt)/1e3;St+=t;const e=(he||K)&&St>Yt/g||St>Yt*10/g;b.isMeasuring&&(b.setPerformance("fps",1/t),b.setPerformance("ms",s-Jt)),b.startMeasurement("clear"),e&&ht.clearRect(0,0,q,G),$.clearRect(0,0,w.width,w.height),b.endMeasurement("clear"),b.startMeasurement("grid"),Ct&&qt?w.drawMarkers($,qt,K):ot&&!rt&&Lt?w.drawDensity($,Lt,K):ot&&rt&&Lt?w.drawDensity($,Lt,K,!0):K&&w.update(),b.endMeasurement("grid"),b.startMeasurement("food"),w.drawFood($t),b.endMeasurement("food");const n=gt(Ut/g-O.x,Xt/g-O.y),r=gt(I.x>0?Math.abs(I.x):I.x*-1,I.y>0?Math.abs(I.y):I.y*-1);if(ct){_t.clearRect(0,0,w.width,w.height),_t.fillStyle="grey";const o=w.getCellCoords(n.x,n.y);W(_t,o[0],o[1],J),ce?(tt.fillStyle="black",W(tt,o[0],o[1],J)):le&&(at?tt.fillStyle="rgb(163, 163, 163)":yt&&(tt.fillStyle="rgb(66, 153, 66, 0.25)"),W(tt,o[0],o[1],J))}if(S.updateColony(t),b.startMeasurement("ants"),e?S.updateAndDrawAnts(w,t):S.updateAndDrawAnts(w,t,!1),b.endMeasurement("ants"),b.startMeasurement("panels"),Es(),kt&&S.selectedAnt&&As(S.selectedAnt.pos.x,S.selectedAnt.pos.y),ut&&e&&(ht.fillStyle="red",W(ht,n.x,n.y,4),xs(n.x,n.y),St>Yt/g)){ht.fillStyle="rgb(255, 0, 0, 0.1)";const o={x:u.IMG_HEIGHT*g,y:u.IMG_HEIGHT*g},d={x:(window.innerWidth+o.x)/g,y:(window.innerHeight-B+o.y)/g};gn(ht,r.x-d.x/2,r.y-B/2/g-d.y/2,d.x,d.y)}ws(),b.endMeasurement("panels"),b.isMeasuring&&(b.endMeasurement("all"),Os()),e&&(he=!1,St=0),Jt=s}
