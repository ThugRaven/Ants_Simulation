var wn=Object.defineProperty;var On=(s,t,e)=>t in s?wn(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var m=(s,t,e)=>(On(s,typeof t!="symbol"?t+"":t,e),e);const Tn=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function e(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerpolicy&&(o.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?o.credentials="include":r.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=e(r);fetch(r.href,o)}};Tn();const Se={WIDTH:1600*3,HEIGHT:1200*3},pe={FILL_RATIO:.47,BORDER_SIZE:1};var At=(s=>(s[s.TO_HOME=0]="TO_HOME",s[s.TO_FOOD=1]="TO_FOOD",s))(At||{});const Pe={TO_HOME:[255,0,0],TO_FOOD:[43,255,0]},M={WIDTH:16,HEIGHT:16,SIZE:16},_e=2e-4,rt={COLONY_RADIUS:50,COLONY_STARTING_ANTS:50,COLONY_MAX_ANTS:5e3,COLONY_MAX_FOOD:3e5,ANT_CREATION_PERIOD:.15,ANT_COST:30,ANT_REFILL_FOOD_AMOUNT:.25};var E=(s=>(s[s.TO_HOME=0]="TO_HOME",s[s.TO_FOOD=1]="TO_FOOD",s[s.REFILL=2]="REFILL",s))(E||{});const u={IMG_WIDTH:24,IMG_HEIGHT:34,WANDER_DISPLACE_RANGE:.5,WANDER_POINT_MAGNITUDE:100,WANDER_POINT_RADIUS:50,PERCEPTION_RADIUS:80,PERCEPTION_START_ANGLE:7/6*Math.PI,PERCEPTION_END_ANGLE:11/6*Math.PI,PERCEPTION_POINTS_HORIZONTAL:8,PERCEPTION_POINTS_VERTICAL:5,DIRECTION_PERIOD:.1,MARKER_PERIOD:.15,MARKER_DEFAULT_INTENSITY:1,AUTONOMY_MAX:300,AUTONOMY_REFILL:150,FOOD_SIZE:16},te=.005,k={SIZE:15,PICK_AMOUNT:2},ee=2,Cn=4,zt=M.SIZE,gt={MIN_SIZE:1,MAX_SIZE:75,STEP:1};function $(s,t,e,n,r=!0,o=!1){s.beginPath(),s.arc(t,e,n,0,Math.PI*2),r&&s.fill(),o&&s.stroke()}function Ct(s,t,e,n,r){s.beginPath(),s.moveTo(t,e),s.lineTo(n,r),s.stroke(),s.closePath()}function Mn(s,t,e,n,r){s.rect(t,e,n,r),s.fill()}function Pt(s,t){return Math.random()*(t-s)+s}function An(s,t,e){return e()*(t-s)+s}function v(s,t,e){return s=!s,s?(t.style.display="block",e==null||e.classList.add("border-green-500"),e==null||e.classList.remove("border-red-500")):(t.style.display="none",e==null||e.classList.add("border-red-500"),e==null||e.classList.remove("border-green-500")),s}function b(s,t){return s=!s,s?(t.classList.add("border-green-500"),t.classList.remove("border-red-500")):(t.classList.add("border-red-500"),t.classList.remove("border-green-500")),s}class at{constructor(t,e,n){m(this,"x");m(this,"y");m(this,"z");this.x=t||0,this.y=e||0,this.z=n||0}set(t,e,n){return t instanceof at?(this.x=t.x||0,this.y=t.y||0,this.z=t.z||0,this):t instanceof Array?(this.x=t[0]||0,this.y=t[1]||0,this.z=t[2]||0,this):(this.x=t||0,this.y=e||0,this.z=n||0,this)}copy(){return new at(this.x,this.y,this.z)}add(t,e,n){return t instanceof at?(this.x+=t.x||0,this.y+=t.y||0,this.z+=t.z||0,this):t instanceof Array?(this.x+=t[0]||0,this.y+=t[1]||0,this.z+=t[2]||0,this):(this.x+=t||0,this.y+=e||0,this.z+=n||0,this)}sub(t,e,n){return t instanceof at?(this.x-=t.x||0,this.y-=t.y||0,this.z-=t.z||0,this):t instanceof Array?(this.x-=t[0]||0,this.y-=t[1]||0,this.z-=t[2]||0,this):(this.x-=t||0,this.y-=e||0,this.z-=n||0,this)}mult(t,e,n){if(t instanceof at)return Number.isFinite(t.x)&&Number.isFinite(t.y)&&Number.isFinite(t.z)&&typeof t.x=="number"&&typeof t.y=="number"&&typeof t.z=="number"?(this.x*=t.x,this.y*=t.y,this.z*=t.z):console.warn("Vector.mult:","x contains components that are either undefined or not finite numbers"),this;if(t instanceof Array)return t.every(o=>Number.isFinite(o))&&t.every(o=>typeof o=="number")?t.length===1?(this.x*=t[0],this.y*=t[0],this.z*=t[0]):t.length===2?(this.x*=t[0],this.y*=t[1]):t.length===3&&(this.x*=t[0],this.y*=t[1],this.z*=t[2]):console.warn("Vector.mult:","x contains elements that are either undefined or not finite numbers"),this;const r=[...arguments];return r.every(o=>Number.isFinite(o))&&r.every(o=>typeof o=="number")?(arguments.length===1&&(this.x*=t,this.y*=t,this.z*=t),arguments.length===2&&(this.x*=t,this.y*=e||0),arguments.length===3&&(this.x*=t,this.y*=e||0,this.z*=n||0)):console.warn("Vector.mult:","x, y, or z arguments are either undefined or not a finite number"),this}div(t,e,n){if(t instanceof at){if(Number.isFinite(t.x)&&Number.isFinite(t.y)&&Number.isFinite(t.z)&&typeof t.x=="number"&&typeof t.y=="number"&&typeof t.z=="number"){if(t.x===0||t.y===0||t.z===0)return console.warn("Vector.div:","divide by 0"),this;this.x/=t.x,this.y/=t.y,this.z/=t.z}else console.warn("Vector.div:","x contains components that are either undefined or not finite numbers");return this}if(t instanceof Array){if(t.every(o=>Number.isFinite(o))&&t.every(o=>typeof o=="number")){if(t.some(o=>o===0))return console.warn("Vector.div:","divide by 0"),this;t.length===1?(this.x/=t[0],this.y/=t[0],this.z/=t[0]):t.length===2?(this.x/=t[0],this.y/=t[1]):t.length===3&&(this.x/=t[0],this.y/=t[1],this.z/=t[2])}else console.warn("Vector.div:","x contains components that are either undefined or not finite numbers");return this}const r=[...arguments];if(r.every(o=>Number.isFinite(o))&&r.every(o=>typeof o=="number")){if(r.some(o=>o===0))return console.warn("Vector.div:","divide by 0"),this;arguments.length===1&&(this.x/=t,this.y/=t,this.z/=t),arguments.length===2&&(this.x/=t,this.y/=e||0),arguments.length===3&&(this.x/=t,this.y/=e||0,this.z/=n||0)}else console.warn("Vector.div:","x, y, or z arguments are either undefined or not a finite number");return this}mag(){return Math.sqrt(this.magSq())}magSq(){const t=this.x,e=this.y,n=this.z;return t*t+e*e+n*n}dist(t){return t.copy().sub(this).mag()}normalize(){const t=this.mag();return t!==0&&(this.x*=1/t,this.y*=1/t,this.z*=1/t),this}limit(t){const e=this.magSq();return e>t*t&&(this.x/=Math.sqrt(e),this.y/=Math.sqrt(e),this.z/=Math.sqrt(e),this.x*=t,this.y*=t,this.z*=t),this}setMag(t){const e=this.normalize();return e.x*=t,e.y*=t,e.z*=t,e}heading(){return Math.atan2(this.y,this.x)}setHeading(t){let e=this.mag();return this.x=e*Math.cos(t),this.y=e*Math.sin(t),this}rotate(t){let e=this.heading()+t;const n=this.mag();return this.x=Math.cos(e)*n,this.y=Math.sin(e)*n,this}equals(t,e,n){let r,o,d;return t instanceof at?(r=t.x||0,o=t.y||0,d=t.z||0):t instanceof Array?(r=t[0]||0,o=t[1]||0,d=t[2]||0):(r=t||0,o=e||0,d=n||0),this.x===r&&this.y===o&&this.z===d}}function It(s,t,e){return new at(s,t,e)}class be{constructor(t,e,n,r,o){m(this,"ctx");m(this,"antImageInstance");m(this,"antFoodImageInstance");m(this,"antIcon");m(this,"id");m(this,"pos");m(this,"vel");m(this,"acc");m(this,"maxSpeed");m(this,"maxForce");m(this,"state");m(this,"debug");m(this,"wanderTheta");m(this,"perceptionDraw");m(this,"internalClock");m(this,"markerClock");m(this,"directionClock");m(this,"isDead");m(this,"freedomCoef");m(this,"foodAmount");m(this,"maxAutonomy");this.ctx=t,this.antImageInstance=e,this.antFoodImageInstance=n,this.antIcon=r,this.id=o.id,this.pos=It(o.pos.x,o.pos.y),this.vel=It(0,0),this.acc=It(0,0),this.maxSpeed=3,this.maxForce=.25,this.state=E.TO_FOOD,this.debug=o.debug||!1,this.wanderTheta=Pt(0,Math.PI*2),this.perceptionDraw=new Set,this.internalClock=0,this.markerClock=Pt(0,u.MARKER_PERIOD),this.directionClock=0,this.isDead=!1,this.freedomCoef=Pt(.01,.1),this.foodAmount=0,this.maxAutonomy=u.AUTONOMY_MAX-Pt(0,50)}seek(t){this.debug&&(this.ctx.strokeStyle="white",Ct(this.ctx,t.x,t.y,this.pos.x,this.pos.y));const e=t.copy().sub(this.pos);e.setMag(this.maxSpeed),e.sub(this.vel),e.limit(this.maxForce),this.applyForce(e)}wander(){const t=this.vel.copy();t.setMag(u.WANDER_POINT_MAGNITUDE),t.add(this.pos);const e=u.WANDER_POINT_RADIUS;this.debug&&(this.ctx.fillStyle="red",$(this.ctx,t.x,t.y,4),this.ctx.strokeStyle="white",$(this.ctx,t.x,t.y,e,!1,!0),Ct(this.ctx,this.pos.x,this.pos.y,t.x,t.y));const n=this.wanderTheta+this.vel.heading(),r=e*Math.cos(n),o=e*Math.sin(n);t.add(r,o),this.debug&&(this.ctx.fillStyle="green",$(this.ctx,t.x,t.y,8),Ct(this.ctx,this.pos.x,this.pos.y,t.x,t.y));const d=t.sub(this.pos);d.setMag(this.maxForce),d.limit(this.maxForce),this.applyForce(d);const a=u.WANDER_DISPLACE_RANGE;this.wanderTheta+=Pt(-a,a)}applyForce(t){this.acc.add(t)}update(t){this.internalClock+=t,this.directionClock+=t,this.internalClock>=u.AUTONOMY_REFILL&&this.state===E.TO_FOOD&&(this.state=E.REFILL),this.internalClock>=this.maxAutonomy&&(this.isDead=!0),this.vel.add(this.acc),this.vel.limit(this.maxSpeed),this.pos.add(this.vel),this.acc.set(0,0)}draw(){this.ctx.translate(this.pos.x,this.pos.y),this.ctx.rotate(this.vel.heading()+Math.PI/2);const t=-u.IMG_WIDTH/2,e=-u.IMG_HEIGHT/2;if(this.state===E.TO_HOME&&this.ctx.drawImage(this.antFoodImageInstance,-u.FOOD_SIZE/2,e-u.FOOD_SIZE/2),this.ctx.drawImage(this.antImageInstance,t,e),this.debug){this.ctx.strokeStyle="#FF0000",this.ctx.lineWidth=2,this.ctx.strokeRect(t,e,u.IMG_WIDTH,u.IMG_HEIGHT),this.ctx.fillStyle="red",$(this.ctx,0,0,4),this.ctx.beginPath(),this.ctx.arc(0,0,u.PERCEPTION_RADIUS,u.PERCEPTION_START_ANGLE,u.PERCEPTION_END_ANGLE),this.ctx.stroke(),this.ctx.strokeStyle="white",this.ctx.beginPath(),this.ctx.arc(0,0,u.PERCEPTION_RADIUS,u.PERCEPTION_END_ANGLE,u.PERCEPTION_START_ANGLE),this.ctx.stroke();const n=u.PERCEPTION_START_ANGLE,r=u.PERCEPTION_END_ANGLE,o=u.PERCEPTION_RADIUS*Math.cos(n),d=u.PERCEPTION_RADIUS*Math.sin(n),a=u.PERCEPTION_RADIUS*Math.cos(r),i=u.PERCEPTION_RADIUS*Math.sin(r);this.ctx.strokeStyle="red",Ct(this.ctx,0,0,o,d),Ct(this.ctx,0,0,a,i);const l=(u.PERCEPTION_END_ANGLE-u.PERCEPTION_START_ANGLE)/(u.PERCEPTION_POINTS_HORIZONTAL-1),f=u.PERCEPTION_RADIUS/u.PERCEPTION_POINTS_VERTICAL;for(let c=0;c<u.PERCEPTION_POINTS_HORIZONTAL;c++)for(let h=1;h<=u.PERCEPTION_POINTS_VERTICAL;h++){const y=l*c+u.PERCEPTION_START_ANGLE,I=f*h*Math.cos(y),P=f*h*Math.sin(y);this.perceptionDraw.has(h*u.PERCEPTION_POINTS_VERTICAL+c)?(this.ctx.strokeStyle="white",this.ctx.fillStyle="white"):(this.ctx.strokeStyle="red",this.ctx.fillStyle="green"),$(this.ctx,I,P,4),h===u.PERCEPTION_POINTS_VERTICAL&&Ct(this.ctx,0,0,I,P)}}this.debug&&(this.ctx.fillStyle="white",$(this.ctx,this.pos.x,this.pos.y,3)),this.ctx.resetTransform()}search(t,e){this.debug&&(this.perceptionDraw=new Set);const n=this.vel.copy();n.setMag(u.IMG_HEIGHT/2),n.add(this.pos);const r=t.getCellFromCoordsSafe(n.x,n.y),o=t.getCellFromCoordsSafe(this.pos.x,this.pos.y);if(o==null||o.addDensity(this.state===E.TO_HOME,this.state===E.REFILL),r&&r.food.quantity>0&&(this.state===E.TO_FOOD||this.state===E.REFILL)){this.state=E.TO_HOME,this.foodAmount=r.pick(),this.vel.setHeading(this.vel.heading()+Math.PI),this.internalClock=0;return}if(o&&o.colony&&(this.state===E.REFILL||this.state===E.TO_HOME)){if(this.state===E.TO_HOME&&(this.vel.setHeading(this.vel.heading()+Math.PI),e.addFood(this.foodAmount)),this.state===E.REFILL&&!e.useFood(rt.ANT_REFILL_FOOD_AMOUNT))return;this.state=E.TO_FOOD,this.internalClock=0;return}if(Math.random()<this.freedomCoef)return;const d=(u.PERCEPTION_END_ANGLE-u.PERCEPTION_START_ANGLE)/(u.PERCEPTION_POINTS_HORIZONTAL-1),a=u.PERCEPTION_RADIUS/u.PERCEPTION_POINTS_VERTICAL;let i=u.PERCEPTION_POINTS_VERTICAL+1,l=null,f=0,c=null;const h=this.vel.heading(),y=-u.IMG_WIDTH/2,I=Math.PI/4+h+Math.PI,P=-Math.PI/4+h+Math.PI,Y=y*Math.cos(I),F=y*Math.sin(I),z=y*Math.cos(P),V=y*Math.sin(P),w=this.pos.copy().add(Y,F),T=this.pos.copy().add(z,V),L=t.getCellFromCoordsSafe(w.x,w.y),_=t.getCellFromCoordsSafe(T.x,T.y);if(L&&L.wall===1||_&&_.wall===1){const S=(L?w:T).sub(this.pos);S.sub(this.vel),S.mult(-1),this.applyForce(S);return}if(this.directionClock>=u.DIRECTION_PERIOD){for(let A=0;A<u.PERCEPTION_POINTS_HORIZONTAL;A++)for(let S=1;S<=u.PERCEPTION_POINTS_VERTICAL;S++){const Z=d*A+u.PERCEPTION_START_ANGLE+h+Math.PI/2,B=a*S*Math.cos(Z),Q=a*S*Math.sin(Z),D=this.pos.copy().add(B,Q),H=t.getCellFromCoordsSafe(D.x,D.y);if(H){if(H.wall===1&&(S===1||S===2)){const K=D.sub(this.pos),Ae=A+1>u.PERCEPTION_POINTS_HORIZONTAL/2?u.PERCEPTION_POINTS_HORIZONTAL-A:A+1;K.setMag(this.maxSpeed),K.sub(this.vel),S===1?K.limit(this.maxForce*Ae):S===2&&K.limit(this.maxForce*.5*Ae),K.mult(-1),this.applyForce(K);break}if(H.colony&&(this.state===E.REFILL||this.state===E.TO_HOME)){this.seek(D);return}if(H.food.quantity>0&&(this.state===E.TO_FOOD||this.state===E.REFILL)){this.debug&&this.perceptionDraw.add(S*u.PERCEPTION_POINTS_VERTICAL+A),S<i&&(i=S,l=D);break}let ot=0;this.state===E.TO_HOME||this.state===E.REFILL?ot=H.marker.intensity[0]:(this.state===E.TO_FOOD||this.state===E.REFILL)&&(ot=H.marker.intensity[1]),ot>f&&(f=ot,c=D)}}if(l){this.seek(l);return}if(c){this.seek(c);return}this.directionClock=0}this.wander()}perception(t){const e=(u.PERCEPTION_END_ANGLE-u.PERCEPTION_START_ANGLE)/(u.PERCEPTION_POINTS_HORIZONTAL-1),n=u.PERCEPTION_RADIUS/u.PERCEPTION_POINTS_VERTICAL;let r=u.PERCEPTION_POINTS_VERTICAL+1,o=null,d=0,a=null;const i=this.vel.heading(),l=this.vel.copy().add(this.acc).limit(this.maxSpeed),f=this.pos.copy().add(l),c=t.getCellFromCoordsSafe(f.x,f.y);if((c==null?void 0:c.wall)===1){const h=f.sub(this.pos);this.debug&&console.log(h),h.x*=h.x!=0?-1:1,h.y*=h.y!=0?-1:1,h.sub(this.vel),this.applyForce(h);return}if(this.directionClock>=u.DIRECTION_PERIOD){for(let h=0;h<u.PERCEPTION_POINTS_HORIZONTAL;h++){const y=e*h+u.PERCEPTION_START_ANGLE+i+Math.PI/2;for(let I=1;I<=u.PERCEPTION_POINTS_VERTICAL;I++){const P=n*I*Math.cos(y),Y=n*I*Math.sin(y),F=this.pos.copy().add(P,Y),z=t.getCellFromCoordsSafe(F.x,F.y);if(z){if(z.wall===1&&(I===1||I===2)){const w=F.sub(this.pos),T=h+1>u.PERCEPTION_POINTS_HORIZONTAL/2?u.PERCEPTION_POINTS_HORIZONTAL-h:h+1;w.setMag(this.maxSpeed),w.sub(this.vel),I===1?w.limit(this.maxForce*T):I===2&&w.limit(this.maxForce*.5*T),w.mult(-1),this.applyForce(w);break}if(z.colony&&(this.state===E.REFILL||this.state===E.TO_HOME)){this.seek(F);return}if(z.food.quantity>0&&(this.state===E.TO_FOOD||this.state===E.REFILL)){this.debug&&this.perceptionDraw.add(I*u.PERCEPTION_POINTS_VERTICAL+h),I<r&&(r=I,o=F);break}let V=0;this.state===E.TO_HOME||this.state===E.REFILL?V=z.marker.getToHomeIntensity():(this.state===E.TO_FOOD||this.state===E.REFILL)&&(V=z.marker.getToFoodIntensity()),V>d&&(d=V,a=F)}}}if(o){this.seek(o);return}if(a){this.seek(a);return}this.directionClock=0}}searchSimple(t,e){this.debug&&(this.perceptionDraw=new Set);const n=t.getCellFromCoordsSafe(this.pos.x,this.pos.y);if(n==null||n.addDensity(this.state===E.TO_HOME,this.state===E.REFILL),n&&n.food.quantity>0&&(this.state===E.TO_FOOD||this.state===E.REFILL)){this.state=E.TO_HOME,this.foodAmount=n.pick(),this.vel.setHeading(this.vel.heading()+Math.PI),this.internalClock=0;return}if(n&&n.colony&&(this.state===E.REFILL||this.state===E.TO_HOME)){if(this.state===E.TO_HOME&&(this.vel.setHeading(this.vel.heading()+Math.PI),e.addFood(this.foodAmount)),this.state===E.REFILL&&!e.useFood(rt.ANT_REFILL_FOOD_AMOUNT))return;this.state=E.TO_FOOD,this.internalClock=0;return}Math.random()<this.freedomCoef||(this.perception(t),this.wander())}addMarker(t,e){if(this.markerClock+=e,this.markerClock>=u.MARKER_PERIOD){const[n,r]=t.getCellCoords(this.pos.x,this.pos.y);if(!t.checkCoords(n,r))return;const o=u.MARKER_DEFAULT_INTENSITY*Math.exp(-.15*this.internalClock);let d=-1;switch(this.state){case E.TO_HOME:d=At.TO_FOOD;break;case E.TO_FOOD:d=At.TO_HOME;break;case E.REFILL:d=At.TO_HOME;break}t.addMarker(n,r,d,o),this.markerClock=0}}}class Sn{constructor(t){m(this,"id");m(this,"x");m(this,"y");m(this,"startingAntsCount");m(this,"maxAntsCount");m(this,"ants");m(this,"totalAnts");m(this,"colonyColor");m(this,"antIcon");m(this,"antImageInstance");m(this,"antFoodImageInstance");m(this,"antId");m(this,"isRunning");m(this,"isDrawingAnts");m(this,"isDebugMode");m(this,"colonyClock");m(this,"antsCtx");m(this,"selectedAnt");m(this,"food");m(this,"totalFood");m(this,"maxFood");this.id=t.id,this.x=t.pos.x,this.y=t.pos.y,this.startingAntsCount=rt.COLONY_STARTING_ANTS,this.maxAntsCount=rt.COLONY_MAX_ANTS,this.ants=[],this.totalAnts=0,this.colonyColor=t.colonyColor||[255,255,255],this.antIcon=null,this.antImageInstance=null,this.antFoodImageInstance=null,this.antId=0,this.isRunning=!1,this.isDrawingAnts=!1,this.isDebugMode=!1,this.colonyClock=0,this.antsCtx=null,this.selectedAnt=null,this.food=0,this.totalFood=0,this.maxFood=rt.COLONY_MAX_FOOD}initialize(t,e,n,r,o){this.antIcon=t,this.antImageInstance=e,this.antFoodImageInstance=n,this.antsCtx=r;for(let a=0;a<this.startingAntsCount;a++){const i=new be(r,e,n,t,{id:this.antId+1,pos:{x:this.x,y:this.y}});this.ants.push(i),this.antId++,this.totalAnts++}const d=Math.floor(rt.COLONY_RADIUS/M.SIZE);for(let a=0;a<d;a++){const i=o.getCellFromCoordsSafe(this.x-d/2*M.SIZE+a*M.SIZE,this.y),l=o.getCellFromCoordsSafe(this.x,this.y-d/2*M.SIZE+a*M.SIZE);i&&l&&(i.colony=!0,l.colony=!0)}}updateAndDrawAnts(t,e,n=!0){let r=!1;for(let o=0;o<this.ants.length;o++){this.isRunning&&(this.ants[o].searchSimple(t,this),this.ants[o].update(e),this.ants[o].addMarker(t,e),this.ants[o].isDead&&(r=!0));let d=!1;if(n){const a={x:u.IMG_HEIGHT*g,y:u.IMG_HEIGHT*g},i=(un+a.x)/g,l=(yn-W+a.y)/g,f=p.x-i/2,c=p.y-W/2/g-l/2;this.ants[o].pos.x>=f&&this.ants[o].pos.x<=f+i&&this.ants[o].pos.y>=c&&this.ants[o].pos.y<=c+l&&(d=!0),this.isDrawingAnts&&d&&this.ants[o].draw()}r&&(console.log("Removed ant: ",this.ants[o]),this.ants.splice(o,1),r=!1)}}updateColony(t){!this.isRunning||(this.colonyClock+=t,this.colonyClock>=rt.ANT_CREATION_PERIOD&&this.ants.length<this.maxAntsCount&&this.useFood(rt.ANT_COST)&&(this.createAnt(),this.colonyClock=0))}createAnt(t=!1){if((this.ants.length<this.maxAntsCount||t)&&this.antIcon&&this.antImageInstance&&this.antFoodImageInstance&&this.antsCtx){const e=new be(this.antsCtx,this.antImageInstance,this.antFoodImageInstance,this.antIcon,{id:this.antId+1,pos:{x:this.x,y:this.y}});this.ants.push(e),this.antId++,this.totalAnts++,this.isDebugMode&&console.log("Created ant: ",e)}else this.isDebugMode&&console.log("Can't create new ant - max count reached")}selectAnt(t){if(this.ants.length<=0)return null;let e=null,n=1/0;const r=u.IMG_HEIGHT/2;for(const o of this.ants){const d=o.pos.dist(t);d<n&&d<r&&(n=d,e=o)}return this.selectedAnt=e,e}removeAnt(){if(this.selectedAnt==null||this.ants.length<=0)return!1;const t=this.ants.findIndex(e=>e.id===this.selectedAnt.id);return t!=-1?(this.ants.splice(t,1),this.selectedAnt=null,!0):!1}toggleAntDebug(){if(this.ants.length>0)for(const t of this.ants)this.selectedAnt&&t.id===this.selectedAnt.id?t.debug=this.isDebugMode:t.debug=!1}drawColony(t){t.fillStyle=`rgb(${this.colonyColor[0]}, ${this.colonyColor[1]}, ${this.colonyColor[2]})`,$(t,this.x,this.y,rt.COLONY_RADIUS)}addFood(t){this.food=Math.min(this.food+t,this.maxFood),this.totalFood+=t}useFood(t){return this.food>=t?(this.food-=t,!0):!1}}class Ke{constructor(t){m(this,"width");m(this,"height");this.width=t.width,this.height=t.height}createInstance(t){const e=document.createElement("canvas");e.width=this.width,e.height=this.height,console.log(`Created canvas image instance with size: ${this.width} x ${this.height}`);const n=e.getContext("2d");return n&&t(n,e),e}}var Et=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},je={exports:{}};(function(s){(function(t,e,n){function r(i){var l=this,f=a();l.next=function(){var c=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=c-(l.c=c|0)},l.c=1,l.s0=f(" "),l.s1=f(" "),l.s2=f(" "),l.s0-=f(i),l.s0<0&&(l.s0+=1),l.s1-=f(i),l.s1<0&&(l.s1+=1),l.s2-=f(i),l.s2<0&&(l.s2+=1),f=null}function o(i,l){return l.c=i.c,l.s0=i.s0,l.s1=i.s1,l.s2=i.s2,l}function d(i,l){var f=new r(i),c=l&&l.state,h=f.next;return h.int32=function(){return f.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,c&&(typeof c=="object"&&o(c,f),h.state=function(){return o(f,{})}),h}function a(){var i=4022871197,l=function(f){f=String(f);for(var c=0;c<f.length;c++){i+=f.charCodeAt(c);var h=.02519603282416938*i;i=h>>>0,h-=i,h*=i,i=h>>>0,h-=i,i+=h*4294967296}return(i>>>0)*23283064365386963e-26};return l}e&&e.exports?e.exports=d:n&&n.amd?n(function(){return d}):this.alea=d})(Et,s,!1)})(je);var Je={exports:{}};(function(s){(function(t,e,n){function r(a){var i=this,l="";i.x=0,i.y=0,i.z=0,i.w=0,i.next=function(){var c=i.x^i.x<<11;return i.x=i.y,i.y=i.z,i.z=i.w,i.w^=i.w>>>19^c^c>>>8},a===(a|0)?i.x=a:l+=a;for(var f=0;f<l.length+64;f++)i.x^=l.charCodeAt(f)|0,i.next()}function o(a,i){return i.x=a.x,i.y=a.y,i.z=a.z,i.w=a.w,i}function d(a,i){var l=new r(a),f=i&&i.state,c=function(){return(l.next()>>>0)/4294967296};return c.double=function(){do var h=l.next()>>>11,y=(l.next()>>>0)/4294967296,I=(h+y)/(1<<21);while(I===0);return I},c.int32=l.next,c.quick=c,f&&(typeof f=="object"&&o(f,l),c.state=function(){return o(l,{})}),c}e&&e.exports?e.exports=d:n&&n.amd?n(function(){return d}):this.xor128=d})(Et,s,!1)})(Je);var Qe={exports:{}};(function(s){(function(t,e,n){function r(a){var i=this,l="";i.next=function(){var c=i.x^i.x>>>2;return i.x=i.y,i.y=i.z,i.z=i.w,i.w=i.v,(i.d=i.d+362437|0)+(i.v=i.v^i.v<<4^(c^c<<1))|0},i.x=0,i.y=0,i.z=0,i.w=0,i.v=0,a===(a|0)?i.x=a:l+=a;for(var f=0;f<l.length+64;f++)i.x^=l.charCodeAt(f)|0,f==l.length&&(i.d=i.x<<10^i.x>>>4),i.next()}function o(a,i){return i.x=a.x,i.y=a.y,i.z=a.z,i.w=a.w,i.v=a.v,i.d=a.d,i}function d(a,i){var l=new r(a),f=i&&i.state,c=function(){return(l.next()>>>0)/4294967296};return c.double=function(){do var h=l.next()>>>11,y=(l.next()>>>0)/4294967296,I=(h+y)/(1<<21);while(I===0);return I},c.int32=l.next,c.quick=c,f&&(typeof f=="object"&&o(f,l),c.state=function(){return o(l,{})}),c}e&&e.exports?e.exports=d:n&&n.amd?n(function(){return d}):this.xorwow=d})(Et,s,!1)})(Qe);var tn={exports:{}};(function(s){(function(t,e,n){function r(a){var i=this;i.next=function(){var f=i.x,c=i.i,h,y;return h=f[c],h^=h>>>7,y=h^h<<24,h=f[c+1&7],y^=h^h>>>10,h=f[c+3&7],y^=h^h>>>3,h=f[c+4&7],y^=h^h<<7,h=f[c+7&7],h=h^h<<13,y^=h^h<<9,f[c]=y,i.i=c+1&7,y};function l(f,c){var h,y=[];if(c===(c|0))y[0]=c;else for(c=""+c,h=0;h<c.length;++h)y[h&7]=y[h&7]<<15^c.charCodeAt(h)+y[h+1&7]<<13;for(;y.length<8;)y.push(0);for(h=0;h<8&&y[h]===0;++h);for(h==8&&(y[7]=-1),f.x=y,f.i=0,h=256;h>0;--h)f.next()}l(i,a)}function o(a,i){return i.x=a.x.slice(),i.i=a.i,i}function d(a,i){a==null&&(a=+new Date);var l=new r(a),f=i&&i.state,c=function(){return(l.next()>>>0)/4294967296};return c.double=function(){do var h=l.next()>>>11,y=(l.next()>>>0)/4294967296,I=(h+y)/(1<<21);while(I===0);return I},c.int32=l.next,c.quick=c,f&&(f.x&&o(f,l),c.state=function(){return o(l,{})}),c}e&&e.exports?e.exports=d:n&&n.amd?n(function(){return d}):this.xorshift7=d})(Et,s,!1)})(tn);var en={exports:{}};(function(s){(function(t,e,n){function r(a){var i=this;i.next=function(){var f=i.w,c=i.X,h=i.i,y,I;return i.w=f=f+1640531527|0,I=c[h+34&127],y=c[h=h+1&127],I^=I<<13,y^=y<<17,I^=I>>>15,y^=y>>>12,I=c[h]=I^y,i.i=h,I+(f^f>>>16)|0};function l(f,c){var h,y,I,P,Y,F=[],z=128;for(c===(c|0)?(y=c,c=null):(c=c+"\0",y=0,z=Math.max(z,c.length)),I=0,P=-32;P<z;++P)c&&(y^=c.charCodeAt((P+32)%c.length)),P===0&&(Y=y),y^=y<<10,y^=y>>>15,y^=y<<4,y^=y>>>13,P>=0&&(Y=Y+1640531527|0,h=F[P&127]^=y+Y,I=h==0?I+1:0);for(I>=128&&(F[(c&&c.length||0)&127]=-1),I=127,P=4*128;P>0;--P)y=F[I+34&127],h=F[I=I+1&127],y^=y<<13,h^=h<<17,y^=y>>>15,h^=h>>>12,F[I]=y^h;f.w=Y,f.X=F,f.i=I}l(i,a)}function o(a,i){return i.i=a.i,i.w=a.w,i.X=a.X.slice(),i}function d(a,i){a==null&&(a=+new Date);var l=new r(a),f=i&&i.state,c=function(){return(l.next()>>>0)/4294967296};return c.double=function(){do var h=l.next()>>>11,y=(l.next()>>>0)/4294967296,I=(h+y)/(1<<21);while(I===0);return I},c.int32=l.next,c.quick=c,f&&(f.X&&o(f,l),c.state=function(){return o(l,{})}),c}e&&e.exports?e.exports=d:n&&n.amd?n(function(){return d}):this.xor4096=d})(Et,s,!1)})(en);var nn={exports:{}};(function(s){(function(t,e,n){function r(a){var i=this,l="";i.next=function(){var c=i.b,h=i.c,y=i.d,I=i.a;return c=c<<25^c>>>7^h,h=h-y|0,y=y<<24^y>>>8^I,I=I-c|0,i.b=c=c<<20^c>>>12^h,i.c=h=h-y|0,i.d=y<<16^h>>>16^I,i.a=I-c|0},i.a=0,i.b=0,i.c=-1640531527,i.d=1367130551,a===Math.floor(a)?(i.a=a/4294967296|0,i.b=a|0):l+=a;for(var f=0;f<l.length+20;f++)i.b^=l.charCodeAt(f)|0,i.next()}function o(a,i){return i.a=a.a,i.b=a.b,i.c=a.c,i.d=a.d,i}function d(a,i){var l=new r(a),f=i&&i.state,c=function(){return(l.next()>>>0)/4294967296};return c.double=function(){do var h=l.next()>>>11,y=(l.next()>>>0)/4294967296,I=(h+y)/(1<<21);while(I===0);return I},c.int32=l.next,c.quick=c,f&&(typeof f=="object"&&o(f,l),c.state=function(){return o(l,{})}),c}e&&e.exports?e.exports=d:n&&n.amd?n(function(){return d}):this.tychei=d})(Et,s,!1)})(nn);var sn={exports:{}};(function(s){(function(t,e,n){var r=256,o=6,d=52,a="random",i=n.pow(r,o),l=n.pow(2,d),f=l*2,c=r-1,h;function y(w,T,L){var _=[];T=T==!0?{entropy:!0}:T||{};var A=F(Y(T.entropy?[w,V(e)]:w==null?z():w,3),_),S=new I(_),Z=function(){for(var B=S.g(o),Q=i,D=0;B<l;)B=(B+D)*r,Q*=r,D=S.g(1);for(;B>=f;)B/=2,Q/=2,D>>>=1;return(B+D)/Q};return Z.int32=function(){return S.g(4)|0},Z.quick=function(){return S.g(4)/4294967296},Z.double=Z,F(V(S.S),e),(T.pass||L||function(B,Q,D,H){return H&&(H.S&&P(H,S),B.state=function(){return P(S,{})}),D?(n[a]=B,Q):B})(Z,A,"global"in T?T.global:this==n,T.state)}function I(w){var T,L=w.length,_=this,A=0,S=_.i=_.j=0,Z=_.S=[];for(L||(w=[L++]);A<r;)Z[A]=A++;for(A=0;A<r;A++)Z[A]=Z[S=c&S+w[A%L]+(T=Z[A])],Z[S]=T;(_.g=function(B){for(var Q,D=0,H=_.i,ot=_.j,K=_.S;B--;)Q=K[H=c&H+1],D=D*r+K[c&(K[H]=K[ot=c&ot+Q])+(K[ot]=Q)];return _.i=H,_.j=ot,D})(r)}function P(w,T){return T.i=w.i,T.j=w.j,T.S=w.S.slice(),T}function Y(w,T){var L=[],_=typeof w,A;if(T&&_=="object")for(A in w)try{L.push(Y(w[A],T-1))}catch{}return L.length?L:_=="string"?w:w+"\0"}function F(w,T){for(var L=w+"",_,A=0;A<L.length;)T[c&A]=c&(_^=T[c&A]*19)+L.charCodeAt(A++);return V(T)}function z(){try{var w;return h&&(w=h.randomBytes)?w=w(r):(w=new Uint8Array(r),(t.crypto||t.msCrypto).getRandomValues(w)),V(w)}catch{var T=t.navigator,L=T&&T.plugins;return[+new Date,t,L,t.screen,V(e)]}}function V(w){return String.fromCharCode.apply(0,w)}if(F(n.random(),e),s.exports){s.exports=y;try{h=require("crypto")}catch{}}else n["seed"+a]=y})(typeof self!="undefined"?self:Et,[],Math)})(sn);var Pn=je.exports,_n=Je.exports,bn=Qe.exports,Rn=tn.exports,vn=en.exports,Fn=nn.exports,xt=sn.exports;xt.alea=Pn;xt.xor128=_n;xt.xorwow=bn;xt.xorshift7=Rn;xt.xor4096=vn;xt.tychei=Fn;var Re=xt;class Nn{constructor(t){m(this,"width");m(this,"height");m(this,"map");m(this,"fillRatio");m(this,"threshold");this.width=t.width,this.height=t.height,this.map=Array.from(Array(this.width),()=>new Array(this.height)),this.fillRatio=t.fillRatio,this.threshold=(this.width+this.height)/2}generateMap(t,e=!1,n=""){console.log("Generate Map");const r=new URL(window.location.href),o=r.searchParams.get("seed");let d=null;if(e&&o!=null)d=Re(o);else{if(e)return;{const a=Math.random().toString(36).slice(2,7);d=Re(n!=""?n:a),r.searchParams.set("seed",n!=""?n:a)}}console.log(d()),window.history.pushState({path:r.href},"",r.href),this.randomFillMap(d);for(let a=0;a<15;a++)this.smoothMap();this.addBorderWalls(),this.processMap();for(let a=0;a<t.width;a++)for(let i=0;i<t.height;i++)t.cells[t.getIndexFromCoords(a,i)].wall=this.map[a][i]?1:0}randomFillMap(t){for(let e=0;e<this.width;e++)for(let n=0;n<this.height;n++)this.map[e][n]=An(0,1,t)<this.fillRatio?1:0}smoothMap(){const t=[];for(let e=0;e<this.map.length;e++)t[e]=this.map[e].slice();for(let e=0;e<this.width;e++)for(let n=0;n<this.height;n++){const r=this.getNeighbourWallCount(e,n);r>4?t[e][n]=1:r<4&&(t[e][n]=0)}this.map=t}getNeighbourWallCount(t,e){let n=0;for(let r=t-1;r<=t+1;r++)for(let o=e-1;o<=e+1;o++)r>=0&&r<this.width&&o>=0&&o<this.height?(r!==t||o!==e)&&(n+=this.map[r][o]):n++;return n}addBorderWalls(){const t=pe.BORDER_SIZE;for(let e=0;e<this.width;e++)for(let n=0;n<t;n++)this.map[e][n]=1,this.map[e][this.height-n-1]=1;for(let e=0;e<t;e++)for(let n=0;n<this.height;n++)this.map[e][n]=1,this.map[this.width-e-1][n]=1}processMap(){const t=this.getRegions(1);if(!t)return;const e=this.threshold;for(const o of t)if(o.length<e)for(const d of o)this.map[d.x][d.y]=0;const n=this.getRegions(0);if(!n)return;const r=this.threshold;for(const o of n)if(o.length<r)for(const d of o)this.map[d.x][d.y]=1}getRegions(t){const e=[],n=Array.from(Array(this.width),()=>new Array(this.height).fill(0));for(let r=0;r<this.width;r++)for(let o=0;o<this.height;o++)if(n[r][o]===0&&this.map[r][o]===t){const d=this.getRegionCells(r,o);if(!d)return;e.push(d);for(const a of d)n[a.x][a.y]=1}return e}getRegionCells(t,e){const n=[],r=Array.from(Array(this.width),()=>new Array(this.height).fill(0)),o=this.map[t][e],d=[];for(d.push({x:t,y:e}),r[t][e]=1;d.length>0;){const a=d.shift();if(!a)return;n.push(a);for(let i=a.x-1;i<=a.x+1;i++)for(let l=a.y-1;l<=a.y+1;l++)i>=0&&i<this.width&&l>=0&&l<this.height&&(l===a.y||i===a.x)&&r[i][l]===0&&this.map[i][l]===o&&(r[i][l]=1,d.push({x:i,y:l}))}return n}}class Ln{constructor(t){m(this,"measurementArray");m(this,"sampleSize");m(this,"isMeasuring");m(this,"modes");m(this,"mode");this.measurementArray=new Map,this.sampleSize=60,this.isMeasuring=!0,this.modes=[],this.mode=0,this.getModes(t),this.createMeasurementArray(t)}getModes(t){for(const e of t)this.modes.push(e.mode)}changeMode(){this.mode==this.modes.length-1?(this.isMeasuring=!1,this.mode=-1):(this.isMeasuring=!0,this.mode++),this.toggleDisplayVisibility()}toggleDisplayVisibility(){for(const t of this.measurementArray.values()){if(!t.element)return;this.isMeasuring&&t.mode<=this.mode?t.element.style.display="block":t.element.style.display="none"}}createMeasurementArray(t){for(const e of t)for(const n of e.stats)this.measurementArray.set(n.name,{performanceArray:[],title:n.title,mode:e.mode,index:0})}createPerformanceDisplay(t){const e=[];for(const[n,r]of this.measurementArray){const o=document.createElement("span");o.dataset[n.toString()]="",o.title=r.title,this.isMeasuring&&r.mode<=this.mode?o.style.display="block":o.style.display="none",r.element=t.appendChild(o),e.push(r.element)}return e}startMeasurement(t){const e=this.measurementArray.get(t);e&&e.mode<=this.mode&&(e.startTime=performance.now())}endMeasurement(t){const e=this.measurementArray.get(t);e&&e.startTime&&e.mode<=this.mode&&(e.performanceArray[e.index]=performance.now()-e.startTime)}setPerformance(t,e){const n=this.measurementArray.get(t);n&&n.mode<=this.mode&&(n.performanceArray[n.index]=e)}update(){const t=new Map;for(const e of this.measurementArray.keys())t.set(e,0);for(const[e,n]of this.measurementArray)for(let r=0;r<n.performanceArray.length;r++)t.set(e,t.get(e)+n.performanceArray[r]);for(const[e,n]of this.measurementArray){if(n.performanceArray.length===0)break;t.set(e,t.get(e)/n.performanceArray.length),n.mode<=this.mode&&(n.index++,n.index===this.sampleSize&&(n.index=0))}return t}}class wt{constructor(t,e){m(this,"canvas");m(this,"width");m(this,"height");m(this,"cellSize");this.canvas=t,this.width=e.width,this.height=e.height,this.cellSize=e.cellSize}create(){return this.canvas.width=this.width,this.canvas.height=this.height,console.log(`Created canvas with size: ${this.width} x ${this.height}`),this.canvas.getContext("2d")}}function Dn(s){let t=Math.floor(s.width/s.cellSize),e=Math.floor(s.height/s.cellSize);t%2===0&&t--,e%2===0&&e--;const n=t*s.cellSize,r=e*s.cellSize;return console.log(`Calculate sizes:
${s.width==n?n:`${s.width} -> ${n}`} x ${s.height==r?r:`${s.height} -> ${r}`}`),[n,r]}class kn{constructor(t){m(this,"quantity");m(this,"changed");this.quantity=t,this.changed=!0}draw(t,e,n){t.clearRect(e*k.SIZE,n*k.SIZE,k.SIZE,k.SIZE);const r=e*k.SIZE+k.SIZE/2,o=n*k.SIZE+k.SIZE/2;t.fillStyle=`hsl(120, 40%, 43%, ${this.quantity/100})`,$(t,r,o,k.SIZE/2,!0),this.changed=!1}pick(){if(this.changed=!0,this.quantity===0)return 0;let t=0;return this.quantity<k.PICK_AMOUNT?t=this.quantity:t=k.PICK_AMOUNT,this.quantity=Math.max(this.quantity-k.PICK_AMOUNT,0),t}}class Hn{constructor(t){m(this,"intensity");this.intensity=t}getToHomeIntensity(){return this.intensity[0]}getToFoodIntensity(){return this.intensity[1]}getMixedColor(){if(this.intensity[0]===0&&this.intensity[1]===0)return[0,0,0];const[t,e,n]=Pe.TO_HOME,[r,o,d]=Pe.TO_FOOD,a=[this.intensity[0]*t,this.intensity[0]*e,this.intensity[0]*n];if(this.intensity[1]===0)return[Math.round(a[0]),Math.round(a[1]),Math.round(a[2])];const i=[this.intensity[1]*r,this.intensity[1]*o,this.intensity[1]*d];if(this.intensity[0]===0)return[Math.round(i[0]),Math.round(i[1]),Math.round(i[2])];let l=[a[0]+i[0],a[1]+i[1],a[2]+i[2]];return l=[Math.round(Math.min(l[0],255)),Math.round(Math.min(l[1],255)),Math.round(Math.min(l[2],255))],l}update(){this.intensity[0]>.01?this.intensity[0]-=_e:this.intensity[0]=0,this.intensity[1]>.01?this.intensity[1]-=_e:this.intensity[1]=0}}class zn{constructor(){m(this,"marker");m(this,"food");m(this,"wall");m(this,"density");m(this,"colony");this.marker=new Hn([0,0]),this.food=new kn(0),this.wall=0,this.density=[0,0,0],this.colony=!1}update(){this.marker.update()}pick(){return this.food.pick()}drawWall(t,e,n){t.fillRect(e,n,1,1)}addDensity(t=!1,e=!1){!t&&!e?this.density[0]++:e?this.density[2]++:this.density[1]++}}class Zn{constructor(t){m(this,"width");m(this,"height");m(this,"cellSize");m(this,"cells");this.width=t.width,this.height=t.height,this.cellSize=t.cellSize,this.cells=[];for(let e=0;e<this.width*this.height;e++)this.cells.push(new zn)}addBorderWalls(){const t=pe.BORDER_SIZE;for(let e=0;e<this.width;e++)for(let n=0;n<t;n++){const r=this.cells[this.getIndexFromCoords(e,n)],o=this.cells[this.getIndexFromCoords(e,this.height-n-1)];r.wall=1,o.wall=1}for(let e=0;e<t;e++)for(let n=0;n<this.height;n++){const r=this.cells[this.getIndexFromCoords(e,n)],o=this.cells[this.getIndexFromCoords(this.width-e-1,n)];r.wall=1,o.wall=1}}update(){for(const t of this.cells)this.updateCell(t)}updateCell(t){t.marker.update();for(let e=0;e<3;e++)t.density[e]>.01?t.density[e]*=.99:t.density[e]=0}addMarker(t,e,n,r){const o=this.cells[this.getIndexFromCoords(t,e)];n===At.TO_HOME?o.marker.intensity[0]=Math.min(1,Math.max(o.marker.getToHomeIntensity(),r)):n===At.TO_FOOD&&(o.marker.intensity[1]=Math.min(1,Math.max(o.marker.getToFoodIntensity(),r)))}addFood(t,e,n){const r=this.getIndexFromCoords(t,e);if(r>this.cells.length||r<0)return;const o=this.cells[r];o.food.quantity=Math.min(o.food.quantity+n,100),o.food.changed=!0}drawMarkers(t,e,n=!0){for(let r=0;r<e.data.length;r+=4){const o=this.cells[r/4];e.data[r+0]=o.marker.getToHomeIntensity()*255,e.data[r+1]=o.marker.getToFoodIntensity()*255,e.data[r+2]=0,e.data[r+3]=255,n&&this.updateCell(o)}t.putImageData(e,0,0)}drawFood(t){for(let e=0;e<this.cells.length;e++)if(this.cells[e].food.changed){const[n,r]=this.getCoordsFromIndex(e);this.cells[e].food.draw(t,n,r)}}drawWalls(t){t.fillStyle="rgb(163, 163, 163)";for(let e=0;e<this.width;e++)for(let n=0;n<this.height;n++){const r=this.cells[this.getIndexFromCoords(e,n)];r.wall===1&&r.drawWall(t,e,n)}}drawDensity(t,e,n=!0,r=!1){for(let o=0;o<e.data.length;o+=4){const d=this.cells[o/4],a=d.density;if(r)e.data[o+0]=4*a[0],e.data[o+1]=4*a[1],e.data[o+2]=4*a[2],e.data[o+3]=255;else{const i=a[0]+a[1]+a[2];e.data[o+0]=4*i,e.data[o+1]=i,e.data[o+2]=i,e.data[o+3]=255}n&&this.updateCell(d)}t.putImageData(e,0,0)}isOnFood(t,e){return this.cells[this.getIndexFromCoords(t,e)].food.quantity>0}getIndexFromCoords(t,e){return t+e*this.width}getCoordsFromIndex(t){const e=t%this.width,n=Math.floor(t/this.width);return[e,n]}getCellCoords(t,e){const n=Math.floor(t/M.SIZE),r=Math.floor(e/M.SIZE);return[n,r]}getCellFromCoords(t,e,n=!1){return n||([t,e]=this.getCellCoords(t,e)),this.cells[this.getIndexFromCoords(t,e)]}getCellFromCoordsSafe(t,e){const[n,r]=this.getCellCoords(t,e);return this.checkCoords(n,r)?this.getCellFromCoords(n,r,!0):null}checkCoords(t,e){return t>-1&&t<this.width&&e>-1&&e<this.height}}const ft=document.getElementById("canvas-container"),Bn=document.getElementById("camera-container"),Wn=document.getElementById("btn-fullscreen"),$n=document.getElementById("btn-pan"),qn=document.getElementById("canvas"),on=document.getElementById("canvas-markers"),rn=document.getElementById("canvas-food"),Gn=document.getElementById("canvas-colony"),an=document.getElementById("canvas-walls"),Ft=document.getElementById("canvas-edit"),Nt=document.getElementById("canvas-edit-preview"),ve=document.getElementById("antIcon"),qt=document.getElementById("btn-ant-panel"),Ee=document.getElementById("antPanel"),Fe=document.querySelector("[data-id]"),Ne=document.querySelector("[data-pos]"),Le=document.querySelector("[data-vel]"),De=document.querySelector("[data-state]"),ne=document.querySelector("[data-lifespan-preview]"),ke=document.querySelector("[data-lifespan]"),ce=document.getElementById("btn-track"),Un=document.getElementById("btn-remove"),he=document.getElementById("btn-cell-panel"),ln=document.getElementById("cellPanel"),He=document.querySelector("[data-cell-preview]"),ze=document.querySelector("[data-intensity-home]"),Ze=document.querySelector("[data-intensity-food]"),Be=document.querySelector("[data-cell-food]"),We=document.querySelector("[data-density]"),de=document.getElementById("btn-colony-panel"),cn=document.getElementById("colonyPanel"),$e=document.querySelector("[data-colony-preview]"),qe=document.querySelector("[data-colony-pop]"),Ge=document.querySelector("[data-colony-food]"),Ue=document.querySelector("[data-pause]"),hn=document.getElementById("btn-play"),dn=document.getElementById("btn-pause"),fe=document.getElementById("btn-edit-mode"),fn=document.getElementById("editPanel"),Xe=document.querySelector("[data-brush-preview]"),Xn=document.querySelector("[data-brush-size]"),ut=document.getElementById("brushSizeInput"),Gt=document.getElementById("btn-wall-brush"),ue=document.getElementById("btn-food-brush"),Yn=document.getElementById("btn-save"),Vn=document.getElementById("btn-controls"),Kn=document.getElementById("btn-close-controls"),jt=document.getElementById("controlsPanel"),jn=document.querySelector("[data-performance-display]"),Ot=document.getElementById("mapPanel"),Jn=document.getElementById("btn-close-map"),Qn=document.getElementById("btn-cancel-map"),ts=document.getElementById("btn-map-panel"),es=document.getElementById("btn-generate-seed"),ns=document.getElementById("btn-generate-save-map"),ss=document.getElementById("map-form"),St=document.getElementById("map-seed"),Lt=document.getElementById("btn-ants-layer"),Dt=document.getElementById("btn-density-layer"),kt=document.getElementById("btn-density-all-layer"),Ht=document.getElementById("btn-markers-layer");let tt=!1,pt=!0,j=!1,J=!1,Wt=!1,yt=!1,$t=!1,ht=!1,ye=!1,me=!1,lt=!1,mt=!1,se=!1,Ut=!0,xe=!1,Xt=!1,vt=!1,ct=!1,et=!1,R=!1,ie=0;const N=new Ln([{mode:0,stats:[{name:"fps",title:"Frames per second"},{name:"ms",title:"Milliseconds to render a frame"}]},{mode:1,stats:[{name:"clear",title:"Milliseconds to clear the screen"},{name:"grid",title:"Milliseconds to draw markers/density and update cells"},{name:"food",title:"Milliseconds to draw food"},{name:"ants",title:"Milliseconds to draw and update ants"},{name:"panels",title:"Milliseconds to update info panels"},{name:"all",title:"Milliseconds needed for main loop"}]}]),[is,oe,os,rs,as,ls,cs,hs]=N.createPerformanceDisplay(jn),W=ft.getBoundingClientRect().top;let Jt=0,Qt=0,g=1,Mt=!1,Yt=!1,re=0;const st={x:0,y:0},O={x:0,y:0},p={x:0,y:0};let _t=0,ge=!1,nt=5;const ds=new URL(window.location.href),ae=ds.searchParams.get("seed");let bt=ae!=null?ae:"";St.value=bt;let un=window.innerWidth,yn=window.innerHeight;window.addEventListener("resize",()=>{un=window.innerWidth,yn=window.innerHeight;const s={x:0,y:0};s.x=window.innerWidth/2/g-O.x,s.y=window.innerHeight/2/g-O.y,O.x=window.innerWidth/2/g-s.x,O.y=window.innerHeight/2/g-s.y,p.x=(window.innerWidth/2-window.innerWidth/2)/g-s.x,p.y=(window.innerHeight/2-window.innerHeight/2)/g-s.y,p.x=p.x<0?Math.abs(p.x):p.x*-1,p.y=p.y<0?Math.abs(p.y):p.y*-1,Tt()});const[U,X]=Dn({width:Se.WIDTH,height:Se.HEIGHT,cellSize:M.SIZE}),fs=new wt(on,{width:U/M.SIZE,height:X/M.SIZE,cellSize:1});on.style.transform=`scale(${M.SIZE})`;const q=fs.create(),us=new wt(rn,{width:U/(M.SIZE/k.SIZE),height:X/(M.SIZE/k.SIZE),cellSize:M.SIZE/k.SIZE});rn.style.transform=`scale(${M.SIZE/k.SIZE})`;const Vt=us.create(),ys=new wt(qn,{width:U,height:X,cellSize:M.SIZE}),dt=ys.create(),ms=new Ke({width:u.IMG_WIDTH,height:u.IMG_HEIGHT}),gs=new Ke({width:u.FOOD_SIZE,height:u.FOOD_SIZE}),Is=new wt(Gn,{width:U,height:X,cellSize:M.SIZE}),Ie=Is.create(),ps=new wt(an,{width:U/M.SIZE,height:X/M.SIZE,cellSize:1});an.style.transform=`scale(${M.SIZE})`;const G=ps.create(),Es=new wt(Ft,{width:U/M.SIZE,height:X/M.SIZE,cellSize:1});Ft.style.transform=`scale(${M.SIZE})`;const it=Es.create(),xs=new wt(Nt,{width:U/M.SIZE,height:X/M.SIZE,cellSize:1});Nt.style.transform=`scale(${M.SIZE})`;const Rt=xs.create(),x=new Zn({width:U/M.SIZE,height:X/M.SIZE,cellSize:1}),we=new Nn({width:x.width,height:x.height,fillRatio:pe.FILL_RATIO}),Kt=q==null?void 0:q.createImageData(x.width,x.height),Zt=q==null?void 0:q.createImageData(x.width,x.height),C=new Sn({id:1,pos:{x:U/2,y:X/2}});window.addEventListener("keydown",s=>{if(console.log(s),!xe)switch(s.code){case"Space":s.preventDefault(),Te();break;case"KeyM":mn();break;case"KeyN":Ce();break;case"KeyA":pn();break;case"KeyD":Ts();break;case"KeyT":In();break;case"KeyC":Me();break;case"Delete":En();break;case"Insert":for(let t=0;t<(s.ctrlKey?10:s.shiftKey?100:1);t++)Ms();break;case"KeyF":N.changeMode();break;case"ArrowUp":Bt(0,zt);break;case"ArrowDown":Bt(0,-zt);break;case"ArrowLeft":Bt(zt,0);break;case"ArrowRight":Bt(-zt,0);break;case"Minus":Ve(!1);break;case"Equal":Ve(!0);break;case"Comma":Ye(-gt.STEP);break;case"Period":Ye(gt.STEP);break;case"Escape":et&&(et=v(et,jt)),R&&(R=v(R,Ot));break}});ft.addEventListener("mousemove",s=>{Jt=s.pageX,Qt=s.pageY-W});ft.addEventListener("click",()=>{if(Yt){Yt=!1;return}Cs(),yt&&gn()});ft.addEventListener("contextmenu",s=>{if(s.preventDefault(),ht)return;const t=It(Math.floor((Jt/g-O.x)/M.SIZE),Math.floor((Qt/g-O.y)/M.SIZE));yt&&console.log(`Placed food at: ${t.x}:${t.y}`),x.addFood(t.x,t.y,10)});ft.addEventListener("wheel",s=>{Rs(s)});Wn.addEventListener("click",()=>{Me()});ce.addEventListener("click",()=>{In()});Un.addEventListener("click",()=>{En()});hn.addEventListener("click",()=>{Te()});dn.addEventListener("click",()=>{Te()});de.addEventListener("click",()=>{Xt=v(Xt,cn,de)});Xt=v(Xt,cn,de);he.addEventListener("click",()=>{vt=v(vt,ln,he)});qt.addEventListener("click",()=>{ct=v(ct,Ee,qt)});Vn.addEventListener("click",()=>{et=v(et,jt),R=!0,R=v(R,Ot)});Kn.addEventListener("click",()=>{et=!0,et=v(et,jt)});ts.addEventListener("click",()=>{R=v(R,Ot),et=!0,et=v(et,jt)});Jn.addEventListener("click",()=>{R=!0,R=v(R,Ot)});Qn.addEventListener("click",()=>{R=!0,R=v(R,Ot)});es.addEventListener("click",()=>{const s=Math.random().toString(36).slice(2,7);console.log(s),St.value=s});Lt.addEventListener("click",()=>{b(C.isDrawingAnts,Lt),pn()});Dt.addEventListener("click",()=>{b(C.isDrawingAnts,Dt),Ce(!0,!1)});kt.addEventListener("click",()=>{b(C.isDrawingAnts,kt),Ce(!1,!0)});Ht.addEventListener("click",()=>{b(C.isDrawingAnts,Ht),mn()});St.addEventListener("focus",()=>{xe=!0});St.addEventListener("blur",()=>{xe=!1});ss.addEventListener("submit",s=>{console.log("submit",s),bt=St.value,console.log(bt),R=!0,R=v(R,Ot),G&&bt&&(G.clearRect(0,0,x.width,x.height),we.generateMap(x,!1,bt),x.drawWalls(G)),s.preventDefault()});ns.addEventListener("click",()=>{var s;R=!0,R=v(R,Ot),G&&(G.clearRect(0,0,x.width,x.height),we.generateMap(x,!1),x.drawWalls(G),St.value=(s=new URL(window.location.href).searchParams.get("seed"))!=null?s:"")});fe.addEventListener("click",()=>{ht=v(ht,fn,fe),ht?(Ft.style.display="block",Nt.style.display="block"):(Ft.style.display="none",Nt.style.display="none")});Gt.addEventListener("click",()=>{lt=b(lt,Gt),lt&&(mt=!0,mt=b(lt,ue))});ue.addEventListener("click",()=>{mt=b(mt,ue),mt&&(lt=!0,lt=b(mt,Gt))});Yn.addEventListener("click",()=>{if(it&&G){const s=it.getImageData(0,0,x.width,x.height);G.clearRect(0,0,x.width,x.height);for(let t=0;t<s.data.length;t+=4){const e=x.cells[t/4],n=s.data[t+0],r=s.data[t+1],o=s.data[t+2],d=s.data[t+3];r<=160&&r>0&&r>n&&r>o?e.wall!==1?(e.food.quantity=Math.min(100,Math.round(100*(d/255))+e.food.quantity),e.food.changed=!0):e.wall=1:n>10&&r>10&&o>10&&n===r&&r===o?(e.wall=1,e.food.quantity=0,e.food.changed=!0):d>0&&n<5&&r<5&&o<5&&(e.food.quantity=0,e.food.changed=!0,e.wall=0)}x.addBorderWalls(),x.drawWalls(G),it.clearRect(0,0,x.width,x.height),ht=v(ht,fn,fe),Ft.style.display="none",Nt.style.display="none"}});ut.addEventListener("input",()=>{nt=parseInt(ut.value),Oe()});function ws(){ut.min=gt.MIN_SIZE.toString(),ut.max=gt.MAX_SIZE.toString(),ut.step=gt.STEP.toString(),ut.value=nt.toString()}function Oe(){Xe.style.width=`${nt}px`,Xe.style.height=`${nt}px`,Xn.textContent=`${nt} px`}function Ye(s){nt=Math.min(gt.MAX_SIZE,Math.max(gt.MIN_SIZE,nt+s)),ut.value=nt.toString(),Oe()}ws();Oe();lt=b(lt,Gt);Os();bs();Me();window.requestAnimationFrame(xn);function Os(){if(!(q==null||Vt==null||dt==null||Ie==null||G==null||it==null||Rt==null)){if(Kt&&(x.drawMarkers(q,Kt),x.drawFood(Vt)),ve){const s=new XMLSerializer().serializeToString(ve),t=btoa(s),n="data:image/svg+xml;base64,"+t,r=new Image;r.src=n,r.onload=()=>{const o=ms.createInstance(a=>{a.drawImage(r,0,0)}),d=gs.createInstance(a=>{const i=u.FOOD_SIZE/2;a.fillStyle="hsl(120, 40%, 43%)",$(a,i,i,u.FOOD_SIZE/2)});C.initialize(r,o,d,dt,x)}}C.drawColony(Ie),x.addBorderWalls(),x.drawWalls(G),we.generateMap(x,!0),x.drawWalls(G),b(!1,Lt),b(!j,Dt),b(!J,kt),b(!pt,Ht)}}function Te(){Ut&&(C.isDrawingAnts=!0,Ut=!1),Ue&&(tt=!tt,C.isRunning=tt,Ue.style.display=tt?"none":"block",hn.style.display=tt?"none":"flex",dn.style.display=tt?"flex":"none")}function mn(){pt=b(pt,Ht),pt&&(j=!1,J=!1,Wt=!1,b(!0,Dt),b(!0,kt))}function Ce(s,t){!s&&!t?(J=!!j,j=!(J||Wt),Wt=!j&&J):s?(j=!j,J=!1):t&&(J=!J,j=!1),(j||J)&&(pt=!1,b(!0,Ht)),console.log(j,J,Wt,pt),b(!j,Dt),b(!J,kt)}function Ts(){yt=!yt,C.isDebugMode=yt,gn(),yt&&(vt=!1),vt=v(vt,ln,he)}function gn(){C.toggleAntDebug()}function In(){C.selectedAnt!=null&&($t=!$t,$t&&(g=3),ce.classList.toggle("border-green-500"),ce.classList.toggle("border-red-500"))}function le(){se=!se,se?document.body.classList.add("cursor-grabbing"):document.body.classList.remove("cursor-grabbing"),$n.classList.toggle("bg-neutral-600")}function pn(){if(Ut){Ut=!1,C.isDrawingAnts=!1,b(!C.isDrawingAnts,Lt);return}C.isDrawingAnts=b(C.isDrawingAnts,Lt)}function Cs(){const s=It(Jt/g-O.x,Qt/g-O.y);C.selectAnt(s),C.selectedAnt?ct=!1:ct=!0,ct=v(ct,Ee,qt)}function En(){C.removeAnt()&&(ct=!0,ct=v(ct,Ee,qt))}function Ms(){C.createAnt(!0)}function As(){const s=C.selectedAnt;if(!s||!Fe||!Ne||!Le||!De||!ne||!ke)return;Fe.textContent=s.id.toString(),Ne.textContent=`${s.pos.x.toFixed(2)} : ${s.pos.y.toFixed(2)}`,Le.textContent=`${s.vel.x.toFixed(2)} : ${s.vel.y.toFixed(2)}`;let t="";switch(s.state){case E.TO_HOME:t="To Home";break;case E.TO_FOOD:t="To Food";break;case E.REFILL:t="Refill";break}De.textContent=t;const e=u.AUTONOMY_REFILL/s.maxAutonomy,n=s.internalClock/s.maxAutonomy;ne.style.setProperty("--left",`${e*100}%`),ne.style.setProperty("--width",`${n*100}%`),ke.textContent=`${s.internalClock.toFixed(2)} | ${s.maxAutonomy.toFixed(2)}`}function Ss(s,t){const e=x.getCellFromCoordsSafe(s,t);if(!e||!ze||!Ze||!Be||!We||!He)return;ze.textContent=e.marker.getToHomeIntensity().toFixed(2),Ze.textContent=e.marker.getToFoodIntensity().toFixed(2),Be.textContent=e.food.quantity.toString(),We.textContent=(e.density[0]+e.density[1]+e.density[2]).toFixed(2);const n=e.marker.getMixedColor();He.style.backgroundColor=`rgb(${n[0]}, ${n[1]}, ${n[2]})`}function Ps(){if(!C||!qe||!Ge||!$e)return;qe.textContent=`${C.ants.length} | ${C.totalAnts}`,Ge.textContent=`${C.food.toFixed(2)} | ${C.totalFood}`;const s=C.colonyColor;$e.style.backgroundColor=`rgb(${s[0]}, ${s[1]}, ${s[2]})`}function _s(){const s=N.update();is.textContent=`${Math.round(s.get("fps")*100)/100} fps`,oe.textContent=`${Math.round(s.get("ms")*100)/100} ms`,os.textContent=`${Math.round(s.get("clear")*100)/100} ms`,rs.textContent=`${Math.round(s.get("grid")*100)/100} ms`,as.textContent=`${Math.round(s.get("food")*100)/100} ms`,ls.textContent=`${Math.round(s.get("ants")*100)/100} ms`,cs.textContent=`${Math.round(s.get("panels")*100)/100} ms`,hs.textContent=`${Math.round(s.get("all")*100)/100} ms`,s.get("ms")>16.7?oe.classList.add("text-red-500"):oe.classList.remove("text-red-500")}function bs(){ft.addEventListener("mousedown",s=>{if(clearTimeout(re),s.buttons==ee&&ht)me=!0;else if(s.buttons==ee)return;if(s.buttons==Cn)Mt=!0,Yt=!1,le(),st.x=s.clientX/g-O.x,st.y=(s.clientY-W)/g-O.y;else{if(ht){ye=!0;return}Mt=!1,re=setTimeout(()=>{Mt=!0,Yt=!0,le(),st.x=s.clientX/g-O.x,st.y=(s.clientY-W)/g-O.y},100)}}),ft.addEventListener("mousemove",s=>{!Mt||s.buttons==ee||vs(s)}),ft.addEventListener("mouseup",()=>{clearTimeout(re),ye=!1,me=!1,Mt&&(Mt=!1,le())})}function Rs(s){const t={x:0,y:0};t.x=s.clientX/g-O.x,t.y=(s.clientY-W)/g-O.y,g*=.999**s.deltaY,g=Math.min(Math.max(.15,g),16),O.x=s.clientX/g-t.x,O.y=(s.clientY-W)/g-t.y,p.x=(s.clientX-window.innerWidth/2)/g-t.x,p.y=(s.clientY-W-window.innerHeight/2)/g-t.y,p.x=p.x<0?Math.abs(p.x):p.x*-1,p.y=p.y<0?Math.abs(p.y):p.y*-1,Tt()}function vs(s){console.log(s),O.x=s.clientX/g-st.x,O.y=(s.clientY-W)/g-st.y;const t={x:window.innerWidth/2-U/2,y:window.innerHeight/2-X/2},e={x:0,y:0};e.x=(s.clientX-t.x)/g-st.x,e.y=(s.clientY-W-t.y)/g-st.y,console.log("--- START ---"),console.log(O),console.log(t),console.log(g),console.log(e);const n={x:0,y:0};n.x=s.clientX/g-O.x,n.y=(s.clientY-W)/g-O.y,console.log(n),console.log(s.clientX,s.clientY),p.x=(s.clientX-window.innerWidth/2)/g-st.x,p.y=(s.clientY-W-window.innerHeight/2)/g-st.y,console.log(p),console.log(window.innerWidth,window.innerHeight),p.x=p.x<0?Math.abs(p.x):p.x*-1,p.y=p.y<0?Math.abs(p.y):p.y*-1,console.log("--- END ---"),Tt()}function Bt(s,t){O.x+=s,O.y+=t,p.x-=s,p.y-=t,Tt()}function Ve(s){const t={x:0,y:0};t.x=window.innerWidth/2/g-O.x,t.y=window.innerHeight/2/g-O.y,g*=.999**(s?-100:100),g=Math.min(Math.max(.15,g),16),O.x=window.innerWidth/2/g-t.x,O.y=window.innerHeight/2/g-t.y,p.x=(window.innerWidth/2-window.innerWidth/2)/g-t.x,p.y=(window.innerHeight/2-window.innerHeight/2)/g-t.y,p.x=p.x<0?Math.abs(p.x):p.x*-1,p.y=p.y<0?Math.abs(p.y):p.y*-1,Tt()}function Me(){const s={x:window.innerWidth/2-U/2,y:window.innerHeight/2-X/2};g=1,O.x=s.x,O.y=s.y,p.x=U/2,p.y=X/2,Tt()}function Fs(s,t){const e={x:window.innerWidth/2/g-s,y:window.innerHeight/2/g-t};O.x=e.x,O.y=e.y,p.x=window.innerWidth/2/g-e.x,p.y=window.innerHeight/2/g-e.y,Tt()}function Tt(){Bn.style.transform=`scale(${g}) translate(${O.x}px, ${O.y}px)`,ge=!0}function xn(s){if(q==null||Vt==null||dt==null||Ie==null||G==null||it==null||Rt==null)return;window.requestAnimationFrame(xn),N.startMeasurement("all");const t=(s-ie)/1e3;_t+=t;const e=(ge||tt)&&_t>te/g||_t>te*10/g;N.isMeasuring&&(N.setPerformance("fps",1/t),N.setPerformance("ms",s-ie)),N.startMeasurement("clear"),e&&dt.clearRect(0,0,U,X),q.clearRect(0,0,x.width,x.height),N.endMeasurement("clear"),N.startMeasurement("grid"),pt&&Kt?x.drawMarkers(q,Kt,tt):j&&Zt?x.drawDensity(q,Zt,tt):J&&Zt?x.drawDensity(q,Zt,tt,!0):tt&&x.update(),N.endMeasurement("grid"),N.startMeasurement("food"),x.drawFood(Vt),N.endMeasurement("food");const n=It(Jt/g-O.x,Qt/g-O.y),r=It(p.x>0?Math.abs(p.x):p.x*-1,p.y>0?Math.abs(p.y):p.y*-1);if(ht){Rt.clearRect(0,0,x.width,x.height),Rt.fillStyle="grey";const o=x.getCellCoords(n.x,n.y);$(Rt,o[0],o[1],nt),me?(it.fillStyle="black",$(it,o[0],o[1],nt)):ye&&(lt?it.fillStyle="rgb(163, 163, 163)":mt&&(it.fillStyle="rgb(66, 153, 66, 0.25)"),$(it,o[0],o[1],nt))}if(C.updateColony(t),N.startMeasurement("ants"),e?C.updateAndDrawAnts(x,t):C.updateAndDrawAnts(x,t,!1),N.endMeasurement("ants"),N.startMeasurement("panels"),As(),$t&&C.selectedAnt&&Fs(C.selectedAnt.pos.x,C.selectedAnt.pos.y),yt&&e&&(dt.fillStyle="red",$(dt,n.x,n.y,4),Ss(n.x,n.y),_t>te/g)){dt.fillStyle="rgb(255, 0, 0, 0.1)";const o={x:u.IMG_HEIGHT*g,y:u.IMG_HEIGHT*g},d={x:(window.innerWidth+o.x)/g,y:(window.innerHeight-W+o.y)/g};Mn(dt,r.x-d.x/2,r.y-W/2/g-d.y/2,d.x,d.y)}Ps(),N.endMeasurement("panels"),N.isMeasuring&&(N.endMeasurement("all"),_s()),e&&(ge=!1,_t=0),ie=s}
